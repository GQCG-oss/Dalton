\chapter{Getting started with {\lsdalton}}\label{ch:starting}

In this chapter we give an introduction to the two input files needed
for doing a calculation with the {\lsdalton} program
(MOLECULE.INP and LSDALTON.INP), as well as the
shell script file that is supplied with the program for moving
relevant files to the scratch-directory and back to the home directory
after a calculation has completed. A couple of examples of
input files  are also provided. Finally, the different output files
generated by the program are discussed.

\textbf{Note! The {\dalton} and {\lsdalton} programs use different input keywords! Some MOLECULE.INP files used for {\lsdalton} can also be used for 
 {\dalton} -- but NOT vice versa! The DALTON.INP input file of  {\dalton} is different from the LSDALTON.INP input file of {\lsdalton}.
Thus, {\dalton} keywords CANNOT be assumed to work in {\lsdalton} or vice versa.}

Before going into detail with the 
MOLECULE.INP and LSDALTON.INP files in chapters \ref{molfile} and \ref{sec:daltoninp},
we provide a simple input example for the impatient reader. The example below
will yield the HF energy for water and the
two lowest lying excitation energies and their associated transition strengths:

\vspace{1 cm}

{\noindent \textbf{MOLECULE.INP:}}
\begin{verbatim}
BASIS
cc-pVDZ Aux=Ahlrichs-Coulomb-Fit
water R(OH) = 0.95Aa , <HOH = 109 deg.
Distance in Aangstroms
Atomtypes=2 Angstrom
Charge=8.0 Atoms=1
O      0.00000   0.00000   0.00000
Charge=1.0 Atoms=2
H      0.55168   0.77340   0.00000
H      0.55168  -0.77340   0.00000
\end{verbatim} 

\vspace{1 cm}

{\noindent \textbf{LSDALTON.INP}:}
\begin{verbatim}
**WAVE FUNCTIONS
.HF
**RESPONS
.NEXCIT
2
*END OF INPUT
\end{verbatim}

To run this simple example, you may (i) create a new directory, (ii) copy the two files above into this directory,
and (iii) run the calculation from your newly created directory using the lsdalton.x executable located in your build directory (as mentioned above, installation details are given at 
\verb|http://daltonprogram.org/installation/2014/|).

The converged HF energy can be found in the output file LSDALTON.OUT by grepping for "Final HF energy":
\begin{verbatim}
Final HF energy:                   -76.026476337669
\end{verbatim}
while the two excitation energies and associated transition strengths are given at the end of LSDALTON.OUT:
\begin{verbatim}
 ***********************************************************************************
 *                     ONE-PHOTON ABSORPTION RESULTS (in a.u.)                     *
 ***********************************************************************************
   Excitation                 Transition Dipole Moments                  Oscillator
    Energies              x                y                z            Strengths
 ====================================================================================
   0.33897330      -0.94893963E-15  -0.30390933E-15   0.36349099       0.29858056E-01
   0.42634048       0.57831041      -0.15070410E-14  -0.14539976E-14   0.95057706E-01
\end{verbatim}
Note that if you run this test your results may vary slightly from the above due to 
numerical inaccuracies.


\section{The \mol\ input file}
\label{molfile}

Basically, the \mol\ file contains the following information:
\begin{itemize}
\item The Cartesian coordinates and nuclear charges of all atoms
\item The basis set(s) to be used
\end{itemize}

Please note the following:
\begin{itemize}
\item Supplying the molecular geometry in the form of a Z-matrix 
is not supported
by \lsdalton\, since this format is ill suited for large scale 
calculations.
\item Molecular symmetry is not exploited by \lsdalton\, (since
the target systems of the program are large biomolecules, which
hardly ever contains any symmetry). 
\item The {\lsdalton} program does not support the use of effective core potentials.

\end{itemize}

There are two different types of molecule files, using either BASIS or ATOMBASIS.
ATOMBASIS is relevant only if different basis sets on individual atoms are required.
In the first two subsections, we describe these two types of \mol\ files using simple examples.
The basis can be selected from the provided basis-set library or can be specified by 
the user (as described under section \ref{sub:USERDEFINER}).

\subsection{BASIS}


Here we describe our example water molecule input file line by line using the BASIS \mol\ format:
\begin{verbatim}
1     BASIS
2     cc-pVDZ Aux=Ahlrichs-Coulomb-Fit
3     water R(OH) = 0.95Aa , <HOH = 109 deg.
4     Distance in Aangstroms
5     Atomtypes=2 Angstrom
6     Charge=8.0 Atoms=1
7     O      0.00000   0.00000   0.00000
8     Charge=1.0 Atoms=2
9     H      0.55168   0.77340   0.00000
10    H      0.55168  -0.77340   0.00000
\end{verbatim} 

\begin{itemize}
\item Line 1: The word "BASIS", indicating that the same basis set should be used for all 
atoms.
\item Line 2: The name of the basis set, in this case cc-pVDZ. Optional: The name
of the auxiliary basis set, in this case Ahlrichs-Coulomb-Fit
(only referenced if density-fitting is requested in LSDALTON.INP)
\item Lines 3-4: Comments (may be left blank)
\item Line 5: {\bf Atomtypes=} Number of different atoms - in the case of H$_2$O, there are two different
atom types, H and O. {\bf Angstrom} If this keyword is omitted, the program will assume that coordinates
are given in atomic units (1bohr=0.5291772083{\AA}). Other options in this line are:
{\bf Charge=} Molecular charge - assumed to be zero if omitted. 
{\bf Nosymmetry} This have no effect as no pointgroup symmetry have been implemented. 
{\bf SubSystems} Use Subsystem labels for doing Counter Poise Corrected interaction energies
\item Lines 6 and 8: A line of this type has to come before the Cartesian coordinates of each atom
type, indicating a) {\bf Charge=} the nuclear charge of the atom type, and b) {\bf Atoms=} the number of atoms of this type.
Other options in this line are:
{\bf SubSystem=A} Use Subsystem label A for these atoms
{\bf phantom} Place Phantom atom (add Basis functions but no actual atom)
{\bf pointcharge} place pointcharge without Basis functions
\item Lines 7, 9-10: Cartesian coordinates of the atoms (in Angstrom, since this was specified 
in line 5). An atom name (1-4 characters long) must be placed at the beginning of these lines.
\end{itemize}

\subsection{ATOMBASIS}
Our example water molecule may also be specified as an ATOMBASIS \mol\ file :
\begin{verbatim}
1     ATOMBASIS
2     water R(OH) = 0.95Aa , <HOH = 109 deg.
3     Distance in Aangstroms
4     Atomtypes=2 Angstrom
5     Charge=8.0 Atoms=1 Basis=cc-pVDZ Aux=Ahlrichs-Coulomb-Fit
6     O      0.00000   0.00000   0.00000
7     Charge=1.0 Atoms=2 Basis=cc-pVDZ Aux=Ahlrichs-Coulomb-Fit
8     H      0.55168   0.77340   0.00000
9     H      0.55168  -0.77340   0.00000
\end{verbatim} 
As seen from the example, there is little difference between the two
formats. Line 2 in the BASIS file has been removed, and instead the basis
sets (and optionally, the auxiliary basis sets) are now given for each
atom. In this example they are the same, as it would probably not make
much sense to use different basis sets for the atoms in water. This can
make sense, though, for larger molecules. An example could be a biomocule containing
an active site with one or more transition metal atoms. In may be useful to
describe such an active site with a more sophisticated basis set than the surroundings. 

\subsection{User defined basis sets}
\label{sub:USERDEFINER}

The user may supply his or her own basis set in two ways. Both ways require that the MOLECULE.INP file is argumented with a basis as in the following two examples

\begin{verbatim}
1     BASIS
2     USERDEFINED
3     water R(OH) = 0.95Aa , <HOH = 109 deg.
4     Distance in Aangstroms
5     Atomtypes=2 Angstrom
6     Charge=8.0 Atoms=1
7     O      0.00000   0.00000   0.00000
8     Charge=1.0 Atoms=2
9     H      0.55168   0.77340   0.00000
10    H      0.55168  -0.77340   0.00000
11 
12    USERDEFINED BASIS
13    a 1
14    $ HYDROGEN     (4s,1p) -> [2s,1p]
15    $ HYDROGEN     segmented contracted
16    $ S-TYPE FUNCTIONS
17        4    2    0
18         18.7311370  0.03349460  0.00000000
19          2.8253937  0.23472695  0.00000000
20          0.6401217  0.81375733  0.00000000
21          0.1612778  0.00000000  1.00000000
22    $ P-TYPE FUNCTIONS
23        1    1    0
24          1.1000000  1.00000000
25    a 8
26    $ OXYGEN       (10s,4p) -> [3s,2p]                               
27    $ S-TYPE FUNCTIONS
28       10    3    0
29       5484.6717000  0.00183110  0.00000000  0.00000000
30        825.2349500  0.01395010  0.00000000  0.00000000
31        188.0469600  0.06844510  0.00000000  0.00000000
32         52.9645000  0.23271430  0.00000000  0.00000000
33         16.8975700  0.47019300  0.00000000  0.00000000
34          5.7996353  0.35852090  0.00000000  0.00000000
35         15.5396160  0.00000000 -0.11077750  0.00000000
36          3.5999336  0.00000000 -0.14802630  0.00000000
37          1.0137618  0.00000000  1.13076700  0.00000000
38          0.2700058  0.00000000  0.00000000  1.00000000
39    $ P-TYPE FUNCTIONS
40        4    2    0
41         15.5396160  0.07087430  0.00000000
42          3.5999336  0.33975280  0.00000000
43          1.0137618  0.72715860  0.00000000
44          0.2700058  0.00000000  1.00000000
45    $ D-TYPE FUNCTIONS
46        1    1    0
47          0.8000000  1.00000000
\end{verbatim} 
Line 13 to 24 contain the Basis set information for the Hydrogen atom. 
Line 13 denote the nuclear charge. Line 14 through 16 are comments. Line 17 states 
that there are 4 primitive functions and 2 contracted functions.
Lines 18 to 21 contain information about the primitive functions. The first number is the exponent 
and the next 2 numbers are the coefficients for the 2 contracted functions.
Line 22-24 contain info about p orbitals on hydrogen, while Line 25-47 contain similar information 
about oxygen.

Alternative the userdefined basis may be used in connection with the ATOMBASIS
\begin{verbatim}
ATOMBASIS
water R(OH) = 0.95Aa , <HOH = 109 deg.
Distance in Aangstroms
Atomtypes=2 Angstrom
Charge=8.0 Atoms=1 Basis=cc-pVDZ
O      0.00000   0.00000   0.00000
Charge=1.0 Atoms=2 Basis=USERDEFINED
H      0.55168   0.77340   0.00000
H      0.55168  -0.77340   0.00000

USERDEFINED BASIS
a 1
$ HYDROGEN     (4s) -> [2s]                                      
$ HYDROGEN     (1p)                                              
$ S-TYPE FUNCTIONS
    4    2    0
     18.7311370  0.03349460  0.00000000
      2.8253937  0.23472695  0.00000000
      0.6401217  0.81375733  0.00000000
      0.1612778  0.00000000  1.00000000
$ P-TYPE FUNCTIONS
    1    1    0
      1.1000000  1.00000000
\end{verbatim}

Finally the basis set files from the Basis Set exchange (EMSL) 
https://bse.pnl.gov/bse/portal may be downloaded and put into 
the basis set directory (the directory called "basis" located at the root of the Dalton library) and used directly. The name specified by 
the input should match the name of the file in the basis set directory
(see testcase {LSDALTON/test/linsca/linsca\_emsl} for an example).

\section{The LSDALTON.INP file}
\label{sec:daltoninp}
In this section, we show two typical examples of a LSDALTON.INP file, one
for small molecules and one for large molecules. Many other examples
of input files for requesting e.g. specific molecular properties may be found
at \verb|http://daltonprogram.org|, and
a complete reference manual of all keywords is found in Chapter \ref{ch:keywords}.

In general, the LSDALTON.INP is divided in different sections under
the headlines (see Section \ref{ch:keywords} for details):
\begin{itemize}
\item **GENERAL contains general settings (optional)
\item **INTEGRAL contains settings for the calculation of integrals (optional)
\item **WAVE FUNCTION contains information about the wave function (e.g. HF/DFT) and settings
for the optimization of the wave function (mandatory)
\item **OPTIMIZE contains settings for geometry optimization (optional)
\item **DYNAMI contains settings for Born-Oppenheimer molecular dynamics (optional)
\item **LOCALIZE ORBITALS contains settings for orbital localization procedure (optional)
\item **RESPONS contains information about requested molecular properties for HF and DFT (optional)
\item **DEC \emph{or} **CC contains info about MP2 and coupled-cluster calculations (optional)
\item **PLT contains information about construction of *.plt files which may be used to visualize densities and orbitals using e.g. the Chimera program~\cite{chimera} (optional).
\item **PLTGRID contains information about grid used for construction of *.plt files (optional).
\end{itemize}
Each of these sections may contain subsections, indicated by a single asterisk.
The LSDALTON.INP file should always end with \verb|*END OF INPUT|. 

A typical example of LSDALTON.INP for a {\bf small molecule} could look like:
\begin{verbatim}
**WAVE FUNCTIONS
.HF
*DENSOPT
.RH
.DIIS
.CONVTHR
1.0D-6
**RESPONS
.NEXCIT
5
*END OF INPUT
\end{verbatim}
Here, we have requested a Hartree-Fock optimization under **WAVE FUNCTION. The subsection
*DENSOPT contains setting for how the density should be optimized. The .RH (.i.e. Roothaan-Hall)
and .DIIS keywords request a standard diagonalization combined with the DIIS scheme for convergence
acceleration. With the keyword .CONVTHR (i.e. convergence threshold) 
it is requested that iterations are terminated when the 
Frobenius norm of the SCF gradient, divided by the square root of the number of occupied orbitals, 
is smaller than 10$^{-6}$. Finally, we have under **RESPONS requested
the calculation of the five lowest excitation energies with .NEXCIT (i.e. number of excitation energies).

A typical example of LSDALTON.INP for a {\bf large molecule} could look like: 
\begin{verbatim}
**INTEGRAL
.DENSFIT
**WAVE FUNCTIONS
.DFT
 BP86
*DENSOPT
.START
 TRILEVEL
.ARH
.CONVDYN
 STANDARD
*END OF INPUT
\end{verbatim}
Under **INTEGRAL, we have requested the use of density-fitting to speed up the calculation (the use of J-engine is default). 
Under **WAVE FUNCTIONS, we have requested a DFT
calculation using the BP86 exchange-correlation functional.

Since this is a calculation on a large molecule, 
we request the trilevel starting guess (atomic, valence, and then full
optimization) and the Augmented Rothaan-Hall (ARH) method for density optimization. 
Note that ARH is default, so this keyword is actually unnecessary.
ARH is more robust than the standard diagonalization/DIIS scheme. 
Furthermore, the ARH scaling with system size is asymptotically linear 
provided sparse-matrix algebra is employed. You may use sparse-matrix algebra by 
putting .CSR (i.e. Compressed-Sparse Row) under *DENSOPT (NB: requires linking 
to the MKL library). 
We have used a dynamic SCF convergence threshold (.COVNDYN, see \ref{subsec:densopt}). This is suitable for calculations on large molecules, since the standard SCF
convergence threshold is based on the Frobenius norm of the SCF gradient, which is not size-extensive.
The use of the STANDARD dynamic threshold corresponds to  $10^{-5}$ times the square root of the number of electrons in the system.


