
\chapter{List of \lsdalton\ keywords}\label{ch:keywords}

In this chapter, we describe all keywords for the different sections
of the LSDALTON.INP file. In general, LSDALTON.INP is divided into the following sections under
the headlines:
\begin{itemize}
\item **GENERAL contains general settings (optional)
\item **INTEGRAL contains settings for the calculation of integrals (optional)
\item **WAVE FUNCTION contains information about the wave function (e.g. HF/DFT) and settings
for the optimization of the wave function (mandatory)
\item **OPTIMIZE contains settings for geometry optimization (optional)
\item **DYNAMI contains settings for Born-Oppenheimer molecular dynamics (optional)
\item **LOCALIZE ORBITALS contains settings for orbital localization procedure (optional)
\item **RESPONS contains information about requested molecular properties for HF and DFT (optional)
\item **DEC \emph{or} **CC contains info about MP2 and coupled-cluster calculations (optional)
\item **PLT contains information about construction of *.plt files which may be used to visualize densities and orbitals using e.g. the Chimera program~\cite{chimera} (optional).
\item **PLTGRID contains information about grid used for construction of *.plt files (optional).
\end{itemize}
Each of these sections may contain subsections, indicated by a single asterisk. LSDALTON.INP
should always end with *END OF INPUT. 

\section{**GENERAL}\label{sec:general}

This input module contains general settings.
\begin{description}

\item[\Key{INTERACTIONENERGY}] Calculation of the Counter Poise Corrected Interaction energy (Hartree-Fock, DFT, DEC-MP2 and CCSD). \newline
NB: Requires the use of SubSystem labels in the MOLECULE.INP file
\item[\Key{SAMESUBSYSTEMS}] Assumes that the two subsystems of the Counter Poise Corrected Interaction energy calculation is identical.
\item[\Key{SUBSYSTEMDENSITY}] Constructs a density matrix for the subsystems of the Counter Poise Corrected Interaction energy calculation using the full system density matrix.  
\item[\Key{SCALAPACK}] Use SCALAPACK matrices. \newline
NB: Requires linking to the scalapack lib (provided by MKL) and the use of the --scalapack keyword during installation.
\item[\Key{SCALAPACKBLOCKSIZE}] the blocksize used in SCALAPACK matrices
\item[\Key{CSR}] Use Compressed-Sparse Row matrices. NB: Requires linking to MKL library and the use of the --csr keyword during installation!
\item[\Key{TIME}] Activate the printout of timings.
\item[\Key{NOGCBASIS}] Deactivate the use of the Grand Canonical basis \cite{trilevel1, trilevel2}
\item[\Key{FORCEGCBASIS}] The Grand Canonical basis \cite{trilevel1, trilevel2} is deactivated when the program
detects the use of a Dunning basis set like (cc-pVXZ) but the calculation will force the use of the Grand Canonical basis using this keyword.

\end{description}
\section{**INTEGRAL basic keywords}\label{sec:integral}

This input module defines the way the integrals should be calculated.
\begin{description}

\item[\Key{ADMM}] Use the Auxiliary Density Matrix Method (ADMM)~\cite{ADMM:2010} 
to approximate the exact-exchange contribution; by projecting the density to a smaller
basis for calculation of the exact exchange, and by including a GGA exchange correction 
between the regular and smaller auxiliary basis. When using this keyword, an auxiliary 
basis set has to be specified in the \mol\ file such as:
\begin{verbatim}
1     BASIS
2     6-31+G* Aux=df-def2 ADMM=3-21G
      ...
\end{verbatim} 
where the "ADMM" basis is used as an auxiliary basis set for ADMM (and where "Aux" 
specify the auxiliary basis for density fitting (optional)). 
The \Key{ADMM} keyword defaults to ADMM2 with Becke type exchange for the GGA 
correction term (identical to using \Key{ADMM2} together with \Key{ADMM-FUNC} 
specified to B88X).

\item[\Key{ADMM1}] Use the ADMM1 approximation of Ref.~\cite{ADMM:2010}. Note: This 
approximation does not work for gradients or response theory!

\item[\Key{ADMM2}] Use the ADMM2 approximation of Ref.~\cite{ADMM:2010}. Default.

\item[\Key{ADMMS}] Use the ADMMS approximation of Merlot~\emph{et.al} (under review). 
Reccomended.

\item[\Key{ADMMP}] Use the ADMMP approximation of Merlot~\emph{et.al} (under review).

\item[\Key{ADMMQ}] Use the ADMMQ approximation of Merlot~\emph{et.al} (under review). 
Not reccomended.

\item[\Key{ADMM-FUNC}] Reads a GGA exchange functional from the next input line. 
Specifies the GGA exchange functional to use for the correction 
term. List of possible functionals: B88X, PBEX, RPBEX, REVPBEX, MPBEX, PW91X, 
KT1X, KT2X, KT3X, G96X, LG93X and OPTX. KT3X together with ADMMS works well for 
basis-set combinations 6-31G**/3-21G and cc-pVTZ/3-21G (to be published).

LDAX is also implemented, but is currently not working as expected. Its use is
therefore discouraged.

\item[\Key{AOPRINT}] 
\verb| | \newline
\verb|<Print level>|\newline
Print the Atomic Orbital information. The higher the print level, the more information will be printed. Default value is 0.
\item[\Key{BASPRINT}] 
\verb| | \newline
\verb|<Print level>|\newline
Print the basis set information. The higher the print level, the more information will be printed.
Using a print level of 6 will print the input exponents and contraction coefficients read from file as well as the normalized basis used in \lsdalton.  
\item[\Key{DENSFIT}] Use density-fitting for the Coulomb contribution (no exact exchange density-fitting method have been introduced). 
When using this keyword, an auxiliary basis set has to be 
specified in the \mol\ file. For the Poples basis sets we recommend df-def2 and for
Dunnings basis sets use the corresponding cc-pV$X$Zdenfit basis sets, with $X=$T$,$Q$,5$.
%\item[\Key{INTPRINT}] 
%\verb| | \newline
%\verb|<Print level>|\newline
%Print information about the actual integral evaluation. The higher the print level, the more information will be printed. Default value is 0.
\item[\Key{LINSCAPRINT}] 
\verb| | \newline
\verb|<Print level>|\newline
Print level in the integral code. The higher the print level, the more information will be printed. This keyword corresponds to 
\begin{verbatim}
.AOPRINT
<Print level>
.BASPRINT
<Print level>
.MOLPRINT
<Print level>
\end{verbatim} 
%.INTPRINT
%<Print level>
See the individual keywords for more details. Default value is 0.
\item[\Key{MOLPRINT}] 
\verb| | \newline
\verb|<Print level>|\newline
Print information about the molecule. The higher the print level, the more information will be printed. Default value is 0.
\item[\Key{NOJENGINE}] Turn off J-engine algorithm (which is default) for the calculation of the Coulomb matrix 
(see Refs. \cite{shao:425} and \cite{shao:6572}). Compute instead Coulomb-like contributions from the explicitly calculated integrals.
\item[\Key{NOLINK}] Turn off the LinK algorithm (which is default) for the calculation of the exchange matrix (see Ref. \cite{ochsenfeld:1663}).
\item[\Key{NO SCREEN}] Deactivate the use of all screening methods.
\item[\Key{NOFAMILY}] Deactivate the exploitation of family type basis set, basis set sharing exponents for different angular momentums.  
\item[\Key{PARI}] Use the Pair-Atomic Resolution-of-the-Identity
approximation \cite{PARI:2013} for the Coulomb and exact Exchange contribution.
When using this keyword, an auxiliary basis set has to be 
specified in the \mol\ file.\newline
\emph{We do not recommend to use this method for any production runs, and have included it 
in case other method developers would like to explore it (see the reference for details).}
\item[\Key{RUNMM}] Use the (Fast) Multipole Method.
\item[\Key{THRESH}]
\verb| | \newline
\verb|<Threshold>|\newline
An overall screening threshold for integral evaluation. The default value is $10^{-8}$

The various integral-evaluation thresholds (below) are set according to this Threshold. 
\begin{itemize}
\item The Cauchy-Schwarz screening threshold is set equal to Threshold (can be set separately by \Key{THR\_CS})
\begin{itemize}
  \item The Screening threshold used for Coulomb is Threshold $\cdot 10^{-2}$ (Default: $10^{-10}$) 
  \item The Screening threshold used for Exchange is Threshold $\cdot 10^{-0}$ (Default: $10^{-8}$)
  \item The Screening threshold used for One-electron operators is Threshold $\cdot 10^{-7}$ (Default: $10^{-15}$)
\end{itemize}
\item The Primitve Cauchy-Schwarz screening threshold is set equal to Threshold$\cdot 10^{-1}$  (can be set separately by \Key{THR\_PS})
\item The Overlap-distribution distance-screening threshold is set equal to 
      Threshold $\cdot 10^{-1}$.
      When calculating overlap integrals, this threshold 
      is used for setting up AO extents. Overlap distributions (ODs) for which the 
      distance between the two AOs are larger than the sum of the extents are 
      screened away. %(OD screening)
\item The Overlap-distribution extent-screening threshold is set equal to 
      Threshold $\cdot 10^{-1}$. When calculating overlap integrals, this threshold 
      is used for setting up OD extents. Overlap integrals between two ODs separated
      by more than the sum of the extents are screened away. %(OE screening)
\item The FMM threshold is used to distinguish the Coulomb repulsion into classical and non-classical interactions, based on
      the non-classical extent of the continuous charge distribution (orbitals or orbital products). By default this threshold 
      is set equal to Threshold $\cdot 10^{-1}$ (can be set separately by \Key{SCREEN} under *FMM)
\end{itemize}
\end{description}

\section{**INTEGRAL advanced keywords}\label{sec:integral:adv}

This input module defines the way the integrals should be calculated. 
This section contains some advanced keywords which is mostly useful
for debugging or comparisons with other codes. 
\begin{description}

\item[\Key{NO CS}] Deactivate the use of Cauchy-Schwarz screening. 
Note that this does not deactivate the Primitive Cauchy-Schwarz screening. 
\item[\Key{NO PS}] Deactivate the use of primitive Cauchy-Schwarz screening.
\item[\Key{THR\_CS}] 
\verb| | \newline
\verb|<CS_Threshold>|\newline
Cauchy-Schwarz screening threshold. The default value is $10^{-8}$. Note that 
\begin{itemize}
  \item The Screening threshold used for Coulomb is CS\_Threshold $\cdot 10^{-2}$ (Default: $10^{-10}$) 
  \item The Screening threshold used for Exchange is CS\_Threshold $\cdot 10^{-0}$ (Default: $10^{-8}$)
  \item The Screening threshold used for One-electron operators is CS\_Threshold $\cdot 10^{-7}$ (Default: $10^{-15}$)
\end{itemize}
\item[\Key{THR\_PS}] 
\verb| | \newline
\verb|<PS_Threshold>|\newline
Primitive Cauchy-Schwarz screening threshold. The default value is $10^{-9}$
\item[\Key{CART-E}] Use cartesian E-coefficients instead of hermite E-coefficients for the McMurchie-Davidson
integral-evaluation scheme \cite{McMurchie1978} used in \lsdalton. The use of Cartesian E-coefficients is 
default in most integral programs. We however use hermite E-coefficients according to ref.~\cite{reine:4771}.
\item[\Key{FTUVMAXPRIM}] 
\verb| | \newline
\verb|<Maxprim>|\newline
Sets the maximum number of primitives used in the FTUV batches in the J-engine algorithm.
\item[\Key{LOW RJ000 ACCURACY}] Use a decreased accuracy for the calculation of the Boys function.
\item[\Key{MAXPASSES}] 
\verb| | \newline
\verb|<maxpass>|\newline
Change the maximum number of collected overlap distributions (default is 40).
\item[\Key{NO PASS}] Deactivate the use of Passes, the collection of overlap distributions which is used as default in order to increase efficiency. 
\item[\Key{NOSEGMENT}] Deactivate the use of segments. The use of segments is used to reduced the number of primitive functions in the calculation of integrals. The basis is considered to be a general contracted basis where all primitives contribute to all contracted functions. 
\item[\Key{NSETUV}] Use non-spherical E-coefficients.
\item[\Key{OVERLAP-DF-J}] Use the Overlap density fitting algorithm for the calculation of the Coulomb matrix.
%\item[\Key{PARI}] Use pair-atomic-resolution-of-the-identity algorithm for the calculation of the Fock matrix
\item[\Key{UNCONT}] Treat the basis functions (given by input) as fully uncontracted basis functions (i.e. ignore
any contraction coefficients given in the basis and treat instead all the primitives as separate basis functions).
\end{description}

\subsection{*FMM}\label{subsec:denfit}

This input block is used to specify settings for the (continuous) fast multipole moment (FMM) treatment of 
classical Coulomb interactions.\newline
% comment by A. Krapp for FMM gradients. 
%
% Meant as a reminder to those who will rewrite/restructure/optimise the FMM code
%
For gradients OpenMP parallelization is turned off. The reason for this is that a continuous counter used 
to identify moments for orbital products has to be the same in both moments and derivative moments. 
For the same reason screening [only during writing (see printmm routines)!!] is turned off both for the serial 
and parallel cases. As a consequence of the screening been turned off the moments have to be recalculated for the gradient and can not be reused from the preceding energy evaluation. 
%
% a solution to these problems could be to calculate moments and derivatives moments at the same time as was
% done in the FCK3 code.
%
The gradient implementation has been tested both for regular and density fitting Coulomb interactions. 
It works for the combined N-e +  e-e + N-N interactions (default), 
and for the e-e interaction only (invoked by \Key{NOONE}).
It has however not been tested for speed and efficiency.
%
% end of comment 
\begin{description}
\item[\Key{LMAX}] \verb| |\newline
\verb|<Lmax>|\newline
The maximum multipole-moment expansion order of a given orbital product. Default Value is 8.
\item[\Key{TLMAX}] \verb| |\newline
\verb|<TLmax>|\newline
The maximum order used for translated multipole-moments. Default Value is 20.
\item[\Key{SCREEN}] \verb| |\newline
\verb|<Threshold>|\newline
The FMM threshold is used to distinguish the Coulomb repulsion into classical and non-classical interactions, based on the non-classical extent of the contineous charge distribution (orbitals or orbital products). 
By default this threshold is set equal to $\cdot 10^{-9}$ 
Defines the threshold used to determine if a contribution can be calculated classically or non-classically.
\item[\Key{NOONE}] Do not use FMM for the nuclear-electron attraction.
\item[\Key{NOMMBU}] Do not use io-buffers for interfacing multipole-moments to the FMM driver.
\end{description}

\section{**WAVE FUNCTION}\label{sec:wavefunc}
\begin{description}
\item[\Key{HF}] Hartree-Fock calculation.
\item[\Key{DFT}] \verb| | \newline
\verb|<FUNCTIONAL>|\newline
DFT calculation.

The exchange---correlation functionals in \lsdalton\ can be divided into two groups: 
generic and combined functionals. 
A number of generic functionals are included within \lsdalton. 
The combined functionals are linear combinations of generic ones.

It should be noted that the input is not case sensitive, although the notation
employed in this manual makes use of case to emphasise exchange or correlation 
functional properties and to reflect the original literature sources.

%Supported functionals are: 
\subsubsection{Exchange Functionals}
\providecommand\exfn[1]{#1}

\begin{description}
\item[Slater] Dirac-Slater exchange functional \cite{dft:hohenberg,dft:kohn,dft:slater}.\index{Slater}

\item[Becke] 1988 Becke exchange GGA correction \cite{dft:becke88}. Note that the full Becke88 exchange functional is given as \exfn{Slater} + \exfn{Becke}.\index{Becke}

%\item[mBecke] 1998 modified \exfn{Becke} exchange correction presented in reference \cite{dft:edf1} for use in the EDF1 functional. The $\beta$ value of 0.0042 in \exfn{Becke} is changed to 0.0035.\index{mBecke}\index{EDF1}

%\item[B86] Becke 1986 exchange functional, a divergence free, semi-empirical gradient-corrected exchange functional~\cite{dft:b86,dft:b86r}.\index{B86} This functional corresponds to the B86R functional of the Molpro program.

%\item[B86mx] B86 exchange functional modified with a gradient correction for large density gradients~\cite{dft:b86mgc}.\index{B86mx}

%\item[DBx] Double-Becke exchange functional defined in 1998 by Gill et al.\cite{dft:edf1,dft:edf2} for use in the EDF1 functional. The full DBx functional is defined as 1.030952*\exfn{Slater} - 8.44793*\exfn{Becke} + 10.4017*\exfn{mBecke} \index{EDF1}\index{Double-Becke}\index{Becke}

%\item[DK87x] DePristo and Kress' 1987 rational function GGA exchange functional (equation 7) from Ref. \cite{dft:dk87}.\index{DK87} The full exchange functional is defined as \exfn{Slater} + \exfn{DK87x}.

%\item[G96x] Gill's 1996 GGA correction exchange functional~\cite{dft:g96}.\index{G96} The complete exchange functional is given by \exfn{Slater} + \exfn{G96x}.

%\item[LG93x] 1993 GGA exchange functional~\cite{dft:lg93,dft:g961lyp}.\index{LG93} The full LG93 exchange functional is given by \exfn{Slater} + \exfn{LG93x} 

%\item[LRC95x] 1995 GGA exchange functional with correct asymptotic behavior~\cite{dft:lrc95}.\index{LRC95} The LRC95x exchange functional includes the Slater exchange (Eq 6 from original reference).

%\item[KTx] Keal and Tozer's 2003 GGA exchange functional (With x being 1,2 or 3). Note that the gradient correction pre-factor constant, $\gamma$, is not included in the KT exchange 
%  definition, but rather in the KT1, KT2 and KT3 definitions. The full KT exchange is given by \cite{dft:kt12}\index{KT}, \exfn{Slater} + $\gamma$\exfn{KTx} ($\gamma$ is -0.006 for KT1,KT2 and -0.004 for KT3). 

\item[OPTX] Handy's 2001 exchange functional correction \cite{dft:optx}.\index{OPTX} The full OPTX exchange functional is given by 1.05151*\exfn{Slater} - 1.43169*\exfn{OPTX}.

\item[PBEx] Perdew, Burke and Ernzerhof 1996 exchange functional~\cite{dft:pbe}.\index{PBEx}

%\item[revPBEx] Zhang and Wang's 1998 revised PBEx exchange functional, with $\kappa$ of 1.245 \cite{dft:revpbe}.\index{revPBE}\index{PBE}

%\item[RPBEx] Hammer, Hansen and N{\o}rskov's 1999 revised PBEx exchange functional \cite{dft:revpbe}.\index{RPBE}\index{PBE}

%\item[mPBEx] Adamo and Barone's 2002 modified PBEx exchange functional~\cite{dft:mpbe}.\index{mPBE}\index{PBE}

\item[PW86x] Perdew and Wang 1986 exchange functional (the PWGGA-I functional)\cite{dft:pw86x}.\index{PW86x}

%\item[PW91x] Perdew and Wang 1991 exchange functional (the pwGGA-II functional) and includes Slater exchange \cite{dft:pw91}.\index{PW86x} This functional is also given in a separate parameterization in Refs.~\cite{dft:g96,dft:mpw}, which is labeled PW91x2, and is defined as \exfn{PW91x} = \exfn{Slater} + \exfn{PW91x2}.

%\item[mPW] Adamo and Barone's 1998 modified PW91x GGA correction exchange functional ~\cite{dft:pw91,dft:mpw}. The full exchange functional is given by \exfn{Slater} + \exfn{mPW}.\index{mPW}

\end{description}

\subsubsection{Correlation Functionals}
\providecommand\corfn[1]{#1}
\begin{description}

\item[VWN3] correlation functional of Vosko, Wilk and Nusair, 1980 (equation III) 
  \cite{dft:vwn}. This is the form used in the Gaussian program.\index{VWN3}

\item[VWN5] correlation functional of Vosko, Wilk and Nusair, 1980 (equation
  V -- the recommended one). The VWN keyword is a synonym for VWN5~\cite{dft:vwn}.\index{VWN5}

%\item[FT97c] Filatov and Thiel 1997 (FT97) correlation functional
%  \cite{dft:ft97}.\index{FT97}

\item[LYP] correlation functional by Lee, Yang and Parr, 1988
  \cite{dft:lyp1,dft:lyp2}.\index{LYP}

%\item[LYPr] 1998 modified \corfn{LYP} functional, which is the re-parameterized EDF1 version 
%  with modified parameters (0.055, 0.158, 0.25, 0.3505)
%  \cite{dft:lyp1,dft:lyp2,dft:edf1}.\index{LYPr}\index{EDF1}

\item[P86c] non-local part of the correlation functional of the Perdew 1986 correlation functional
  \cite{dft:p86}. PZ81 (1981 Perdew local) is usually used for the local part of the
  functional, with a total corelation functional of \index{P86}\index{PZ81}
  \corfn{P86c} + \corfn{PZ81}.

\item[PBEc] Perdew, Burke and Ernzerhof 1996 correlation functional, 
  defined as PW91c local and PBEc non-local correlation~\cite{dft:pbe}.\index{PBEc}

\item[PW91c] 1991 correlation functional of Perdew and Wang (the pwGGA-II functional)
  ~\cite{dft:pw91}.\index{PW91} This functional includes both the PW91c non-local and 
  PW91c local (ie PW92c) contributions. The non-local PW91c contribution may be determined
  as \corfn{PW91c} - \corfn{PW92c}.

%\item[PW92c] local correlation functional of Perdew and Wang, 1992~\cite{dft:pw91,dft:pw92}.\index{PW91}
%  This functional is the local contribution to the PW91c correlation functional.

%\item[PW92ac] gradient correction to the PW91c correlation functional of Perdew and Wang,
%  equation 16 from Ref.~\cite{dft:pw91,dft:pw92}.\index{PW91} The PWGGA-IIA functional
%  as defined in the original reference is \corfn{PW91c} + \corfn{PW92ac}. 

\item[PZ81] local correlation functional of Perdew and Zunger, 1981~\cite{dft:pz81}.\index{PZ81}

%\item[Wigner] original 1938 spin-polarized correlation functional~\cite{dft:wigner}.\index{Wigner}

%\item[WL90c] Wilson and Levy's 1990 non-local spin-dependent correlation functional 
%  (equation 15 from Ref.~\cite{dft:wl90}).\index{WL90}

\end{description}

\subsubsection{Standalone Functionals}
\providecommand\onefn[1]{#1}
\begin{description}
\item[LB94] asymptotically correct functional of Leeuwen and
  Baerends 1994~\cite{dft:lb94}. This functional improves description of the
  asymptotic density on the expense of core and inner valence.\index{LB94}

%\item[B97] Becke 1997 functional~\cite{dft:b97}.\index{B97}

%\item[B97-1] Hamprecht et al.'s 1998 re-parameterization of the 
%  B97 functional~\cite{dft:b97-1}.\index{B97}\index{B97-1}

%\item[B97-2] Modification of B97 functional in 2001 by Wilson, Bradley and Tozer 
%  \cite{dft:b97-2}.\index{B97}\index{B97-2}

%\item[B97-K] Boese and Martin 2004 re-parameterization of the 
%  B97-1 functional for kinetics~\cite{dft:b97-1}.\index{B97}\index{B97-K}

%\item[HCTH] is a synonym for the HCTH407 functional (detailed below).
%  \cite{dft:hcth407}.\index{HCTH}\index{HCTH407}

%\item[HCTH93] Original 1998 HCTH functional, parameterized on a set of 
%  93 training systems~\cite{dft:hcth93}.\index{HCTH}\index{HCTH93}

%\item[HCTH120] The HCTH functional parameterized on a set of 120 training systems 
%  in 2000~\cite{dft:hcth120}.\index{HCTH}\index{HCTH120}

%\item[HCTH147] The HCTH functional parameterized on a set of 147 training systems 
%  in 2000~\cite{dft:hcth120}.\index{HCTH}\index{HCTH147}

%\item[HCTH407] The HCTH functional parameterized on a set of 407 training systems 
%  in 2001~\cite{dft:hcth407}.\index{HCTH}\index{HCTH407}

%\item[HCTH407p] The HCTH407 functional re-parameterized in 2003 on a set of 407 
%  training systems and ammonia dimer to incorporate hydrogen bonding 
%  \cite{dft:hcth407p}.\index{HCTH}\index{HCTH407}\index{HCTH407p}

\end{description}

\subsubsection{Combined functionals}
\providecommand\funexample[1]{\\{\tt #1 }}
\begin{description}

\item[GGAKey] is a universal keyword allowing users to manually
  construct arbitrary linear combinations of exchange and correlation 
  functionals from the list above. Even fractional 
  Hartree--Fock exchange can be specified. This keyword is to be 
  followed by a string of functionals with associated weights. 
  The syntax is \verb|NAME=WEIGHT ...|. 
  As an example, B3LYP may be constructed as:
\begin{verbatim}
.DFT
 GGAKey HF=0.2 Slater=0.8 Becke=0.72 LYP=0.81 VWN=0.19
\end{verbatim}

The following GGA and hybrid functional aliases are defined within 
\lsdalton\ and provide further examples of the GGAKey keyword.

\item[SVWN5] is a sum of Slater functional and VWN (or VWN5) correlation
  functional. It is equivalent to
  \funexample{GGAKey Slater=1 VWN5=1}
  \index{SVWN}

\item[SVWN3] is a sum of the Slater exchange functional and VWN3 correlation
  functional. It is equivalent to the Gaussian program LSDA functional 
  and can alternatively be selected by following set of keywords
  \funexample{GGAKey Slater=1 VWN3=1}
  \index{SVWN3}

\item[LDA] A synonym for SVWN5. \index{LDA}

%\item[BVWN] is a sum of the \exfn{Slater} functional, \exfn{Becke} correction and 
%  \corfn{VWN} correlation functional.  It is equivalent to 
%  \funexample{GGAKey Slater=1 Becke=1 VWN=1}
%  \index{BVWN}

\item[BLYP] is a sum of Slater functional, Becke88 correction and LYP
  correlation functional.  It is equivalent to 
  \funexample{GGAKey Slater=1 Becke=1 LYP=1}
  \index{BLYP}

\item[B3LYP] 3-parameter hybrid functional \cite{dft:b3lyp} equivalent to:
  \funexample{GGAKey HF=0.2 Slater=0.8 Becke=0.72 LYP=0.81 VWN=0.19}
  \index{B3LYP}

\item[B3LYP-G] hybrid functional with VWN3 form used for
  correlation---this is the form used by the Gaussian quantum chemistry
  program. Keyword B3LYPGauss is a synonym for B3LYPg.\index{B3LYPG} 
  This functional can be explicitly set up by
  \funexample{GGAKey HF=0.2 Slater=0.8 Becke=0.72 LYP=0.81 VWN3=0.19}
  \index{B3LYP, Gaussian version}

%\item[B1LYP] 1-parameter hybrid functional with 25\% exact exchange \cite{dft:b1lyp}. 
%  Equivalent to: \funexample{GGAKey HF=0.25 Slater=0.75 Becke=0.75 LYP=1}
%  \index{B3LYP}

\item[BP86] Becke88 exchange functional and Perdew86 correlation
  functional (with Perdew81 local correlation). The explicit form is:
  \funexample{GGAKey Slater=1 Becke=1 PZ81=1 P86c=1}
  \index{BP86}

\item[B3P86] variant of \verb|B3LYP| with VWN used for local
  correlation  and P86 for the nonlocal part.
  \funexample{GGAKey HF=0.2 Slater=0.8 Becke=0.72 P86c=0.81 VWN=1}
  \index{B3P86}

\item[B3P86-G] variant of \verb|B3LYP| with VWN3 used for local
  correlation and P86 for the nonlocal part.
  This is the form used by the Gaussian quantum chemistry program.
  \funexample{GGAKey HF=0.2 Slater=0.8 Becke=0.72 P86c=0.81 VWN3=1}
  \index{B3P86}\index{B3P86, Gaussian version}

\item[BPW91] Becke88 exchange functional and PW91 correlation
  functional. The explicit form is:
  \funexample{GGAKey Slater=1 Becke=1 PW91c=1}
  \index{BPW91}

%\item[B3PW91] 3-parameter Becke-PW91 functional, with PW91 correlation 
%  functional. Note that PW91c includes PW92c local correlation, thus only
%  excess PW92c local correlation is required (coefficient of 0.19).
%  \funexample{GGAKey HF=0.2 Slater=0.8 Becke=0.72 PW91c=0.81 PW92c=0.19}
%  \index{B3PW91}

%\item[B1PW91] 1-parameter hybrid functional \cite{dft:b1lyp} equivalent to:
%  \funexample{GGAKey HF=0.25 Slater=0.75 Becke=0.75 PW91c=1}
%  \index{B1PW91}

%\item[B86VWN] is a sum of \exfn{Slater} and \exfn{B86x} exchange functionals and 
%  the \corfn{VWN} correlation functional. It is equivalent to 
%  \funexample{GGAKey Slater=1 B86x=1 VWN=1}
%  \index{B86VWN}

%\item[B86LYP] is a sum of \exfn{Slater} and \exfn{B86x} exchange functionals and 
%  the \corfn{LYP} correlation functional. It is equivalent to 
%  \funexample{GGAKey Slater=1 B86x=1 LYP=1}
%  \index{B86LYP}

%\item[B86P86] is a sum of \exfn{Slater} and \exfn{B86x} exchange functionals and 
%  the \corfn{P86c} correlation functional. It is equivalent to 
%  \funexample{GGAKey Slater=1 B86x=1 P86c=1}
%  \index{B86P86}

%\item[B86PW91] is a sum of \exfn{Slater} and \exfn{B86x} exchange functionals and 
%  the \corfn{PW91c} correlation functional.  It is equivalent to 
%  \funexample{GGAKey Slater=1 B86x=1 PW91c=1}
%  \index{B86PW91}

%\item[BHandH] is an simple Half-and-half functional.
%  \funexample{GGAKey HF=0.5 Slater=0.5 LYP=1}
%  \index{BHandH}

%\item[BHandHLYP] is another simple Half-and-half functional.
%  \funexample{GGAKey HF=0.5 Slater=0.5 Becke=0.5 LYP=1}
%  \index{BHandH}

%\item[BW] is the sum of the Becke exchange and Wigner correlation
%  functionals \cite{dft:wigner,dft:bw}.\index{BW}
%  \funexample{GGAKey Slater=1 Becke=1 Wigner=1}

\item[CAMB3LYP] Coulomb Attenuated Method Functional of Yanai, Tew and
Handy \cite{dft:camb3lyp}. This functional accepts additional arguments
\verb|alpha|, \verb|beta| and \verb|mu| to modify the fraction of HF
exchange for short-range interactions, additional fraction of HF
exchange for long-range interaction and the interaction switching
factor $\mu$. This input can be specified as follows:
\begin{verbatim}
.DFT
 CAMB3LYP alpha=0.190 beta=0.460 mu=0.330
\end{verbatim}
\index{CAMB3LYP}

%\item[DBLYP] is a sum of the Double-Becke exchange functional and
%  the LYP correlation functional 
%  \cite{dft:becke88,dft:edf1,dft:lyp1,dft:lyp2}.\index{Double-Becke}
% \funexample{GGAKey Slater=1.030952 Becke=-8.44793 mBecke=10.4017 LYP=1}

%\item[DBP86] is the sum of the Double-Becke exchange functional and
%  the P86 correlation functional \cite{dft:becke88,dft:edf1,dft:p86}.\index{Double-Becke}
% \funexample{GGAKey Slater=1.030952 Becke=-8.44793 mBecke=10.4017 P86c=1 PZ81=1}

%\item[DBPW91] is a sum of the Double-Becke exchange functional and
%  the PW91 correlation functional \cite{dft:becke88,dft:edf1,dft:pw91}.\index{Double-Becke}
% \funexample{GGAKey Slater=1.030952 Becke=-8.44793 mBecke=10.4017 PW91c=1}

%\item[EDF1] is a fitted functional of Adamson, Gill and Pople \cite{dft:edf1}.
%  It is a linear combination of the Double-Becke exchange functional and the revised LYP
%  functional LYPr.\index{EDF1}
% \funexample{GGAKey Slater=1.030952 Becke=-8.44793 mBecke=10.4017 LYPr=1}

%\item[EDF2] is a linear combination of the Hartree-Fock exchange and the Double-Becke 
%  exchange, Slater exchange, LYP correlation, revised LYPr correlation and VWN 
%  correlation functionals \cite{dft:edf2}\index{EDF2}.
% \funexample{GGAKey HF=0.1695 Slater=0.2811 Becke=0.6227 mBecke=-0.0551 VWN=0.3029 LYP=0.5998 LYPr=-0.0053}

%\item[G96VWN] is the sum of the G96 exchange functional and the VWN 
%  correlation functional \cite{dft:g96}.
% \funexample{GGAKey Slater=1 G96x=1 VWN=1}

%\item[G96LYP] is the sum of the G96 exchange functional and the LYP
%  correlation functional \cite{dft:g96}.
% \funexample{GGAKey Slater=1 G96x=1 LYP=1}

%\item[G96P86] is the sum of the G96 exchange functional and the P86
%  correlation functional \cite{dft:g96}.
% \funexample{GGAKey Slater=1 G96x=1 P86c=1}

%\item[G96PW91] is the sum of the G96 exchange functional and the PW91
%  correlation functional \cite{dft:g96}.
% \funexample{GGAKey Slater=1 G96x=1 PW91c=1}

%\item[G961LYP] is a 1-parameter B1LYP type functional with the exchange gradient 
%  correction provided by the G96x functional \cite{dft:g961lyp}.
% \funexample{GGAKey HF=0.25 Slater=0.75 G96x=0.75 LYP=1}

%\item[KMLYP] Kang and Musgrave 2-parameter hybrid functional with a mixture of
%  Slater and Hartree--Fock exchange and VWN and LYP correlation functionals.
%  \cite{dft:kmlyp}.
% \funexample{GGAKey HF=0.557 Slater=0.443 VWN=0.552 LYP=0.448}

\item[KT1] Slater-VWN5 functional with the KT GGA exchange correction
  \cite{dft:kt12,dft:kt12a}.\index{KT1}
 \funexample{GGAKey Slater=1 VWN=1 KT=-0.006}

\item[KT2] differs from KT1 only in that the weights of the Slater and
  VWN5 functionals are from an empirical fit (not equal to 1.0)
  \cite{dft:kt12,dft:kt12a}.\index{KT2}
  \funexample{GGAKey Slater=1.07173 VWN=0.576727 KT=-0.006}

\item[KT3] a hybrid functional of Slater, OPTX and KT exchange with the
  LYP correlation functional \cite{dft:kt3}. The explicit form is
  \funexample{GGAKey Slater=1.092 KT=-0.004 LYP=0.864409 OPTX=-0.925452}
  \index{KT3}

%\item[LG1LYP] is a 1-parameter B1LYP type functional with the exchange gradient
%  correction provided by the LG93x functional \cite{dft:g961lyp}.
% \funexample{GGAKey HF=0.25 Slater=0.75 LG93x=0.75 LYP=1}

%\item[mPWVWN] is the combination of mPW exchange and VWN correlation functionals 
%   \cite{dft:mpw,dft:vwn}.\index{mPWVWN}
%  \funexample{GGAKey Slater=1 mPW=1 VWN=1}.

%\item[mPWLYP] is the combination of mPW exchange and LYP correlation functionals 
%   \cite{dft:mpw,dft:vwn}.\index{mPWLYP}
%  \funexample{GGAKey Slater=1 mPW=1 LYP=1}.

%\item[mPWP86] is the combination of mPW exchange and P86 correlation functionals 
%   \cite{dft:mpw,dft:vwn}.\index{mPWP86}
%  \funexample{GGAKey Slater=1 mPW=1 P86c=1 PZ81=1}.

%\item[mPWPW91] is the combination of mPW exchange and PW91 correlation functionals 
%   \cite{dft:mpw,dft:pw91}.\index{mPWPW91}
%  \funexample{GGAKey Slater=1 mPW=1 PW91c=1}.

%\item[mPW3PW91] is a 3-parameter combination of mPW exchange and PW91 correlation
%  functionals, with the PW91 (PW92c) local correlation~\cite{dft:mpw}.\index{mPW3PW91}
%  \funexample{GGAKey HF=0.2 Slater=0.8 mPW=0.72 PW91c=0.81 PW92c=0.19}.

%\item[mPW1PW91] is a 1-parameter combination mPW exchange and PW91 correlation
%  functionals with 25\% Hartree--Fock exchange \cite{dft:mpw}.\index{mPW1PW91}
%  \funexample{GGAKey HF=0.25 Slater=0.75 mPW=0.75 PW91c=1}.

%\item[mPW1K] optimizes mPW1PW91 for kinetics of H abstractions, with 42.8\% Hartree--Fock
%  exchange \cite{dft:mpw1k}.\index{mPW1PW91}
%  \funexample{GGAKey HF=0.428 Slater=0.572 mPW=0.572 PW91c=1}.

%\item[mPW1N] optimizes mPW1PW91 for kinetics of H abstractions, with 40.6\% Hartree--Fock
%  exchange \cite{dft:mpw1n}.\index{mPW1N}
%  \funexample{GGAKey HF=0.406 Slater=0.594 mPW=0.594 PW91c=1}.

%\item[mPW1S] optimizes mPW1PW91 for kinetics of H abstractions, with 6\% Hartree--Fock
%  exchange \cite{dft:mpw1s}.\index{mPW1S}
%  \funexample{GGAKey HF=0.06 Slater=0.94 mPW=0.94 PW91c=1}.

\item[OLYP] is the sum of the OPTX exchange functional with the
  LYP correlation functional \cite{dft:optx,dft:lyp1,dft:lyp2}.
  \funexample{GGAKey Slater=1.05151 OPTX=-1.43169 LYP=1}
  \index{OLYP}

%\item[OP86] is the sum of the OPTX exchange functional with the
%  P86 correlation functional \cite{dft:optx,dft:p86}.
%  \funexample{GGAKey Slater=1.05151 OPTX=-1.43169 P86c=1 PZ81=1}
%  \index{OP86}

%\item[OPW91] is the sum of the OPTX exchange functional with the
%  PW91 correlation functional \cite{dft:optx,dft:pw91}.
%  \funexample{GGAKey Slater=1.05151 OPTX=-1.43169 PW91c=1}
%  \index{OPW91}

\item[PBE0] a hybrid functional of Perdew, Burke and Ernzerhof with
  0.25 weight of exact exchange, 0.75 of \verb|PBEx| exchange functional and
  the \verb|PBEc| correlation functional \cite{dft:pbe0}.
  Alternative aliases are PBE1PBE or PBE0PBE.\index{PBE0}
  \funexample{GGAKey HF=0.25 PBEx=0.75 PBEc=1}

\item[PBE] same as above but with exchange estimated exclusively by
  \exfn{PBEx} functional \cite{dft:pbe}.\index{PBE} Alias of PBEPBE. 
  This is the form used by CADPAC and NWChem quantum chemistry programs.
  \funexample{GGAKey PBEx=1 PBEc=1}\\
  Note that the Molpro quantum chemistry program uses the \corfn{PW91c}
  non-local correlation functional instead of \corfn{PBEc}, which is 
  equivalent to the following:
  \funexample{GGAKey PBEx=1 PW91c=1}.

%\item[RPBE] is a revised PBE functional that employs the 
%  \exfn{RPBEx} exchange functional.
%  \funexample{GGAKey RPBEx=1 PBEc=1}

%\item[revPBE] is a revised PBE functional that employs the 
%  \exfn{revPBEx} exchange functional.
%  \funexample{GGAKey revPBEx=1 PBEc=1}

%\item[mPBE] is a revised PBE functional that employs the 
%  \exfn{mPBEx} exchange functional.
%  \funexample{GGAKey mPBEx=1 PBEc=1}

%\item[PW91VWN] is the combination of PW91 exchange and VWN correlation functionals 
%   \cite{dft:pw91,dft:vwn}.\index{PW91}
%  \funexample{GGAKey PW91x=1 VWN=1}.

%\item[PW91LYP] is the combination of PW91 exchange and LYP correlation functionals 
%   \cite{dft:pw91,dft:lyp1,dft:lyp2}.\index{PW91}
%  \funexample{GGAKey PW91x=1 LYP=1}.

%\item[PW91P86] is the combination of PW91 exchange and P86 (with Perdew 1981 local) 
%  correlation functionals \cite{dft:pw91,dft:pw86,dft:pz81}.
%  \funexample{GGAKey PW91x=1 P86c=1 PZ81=1}.

%\item[PW91PW91] is the combination of PW91 exchange and PW91 correlation functionals. 
%  Equivalent to PW91 keyword \cite{dft:pw91}.
%  \funexample{GGAKey PW91x=1 PW91c=1}.

%\item[XLYP] is a linear combination of \exfn{Slater}, \exfn{Becke} and \exfn{PW91x}
%  exchange and \corfn{LYP} correlation functionals \cite{dft:xlyp,dft:x3lyp}.\index{XLYP}
%  \funexample{GGAKey Slater=1 Becke=0.722 PW91x=0.347 LYP=1}.

%\item[X3LYP] is a linear combination of Hartree--Fock, \exfn{Slater}, \exfn{Becke} 
%  and \exfn{PW91x} exchange and \corfn{VWN} and \corfn{LYP} correlation functionals 
%  \cite{dft:xlyp,dft:x3lyp}.\index{X3LYP}
%  \funexample{GGAKey HF=0.218 Slater=0.782 Becke=0.542 PW91x=0.167 VWN=0.129 LYP=0.871}

\end{description}

Note that combinations of local and non-local correlation functionals
can also be generated with the GGAKey keyword. For example,
\verb|GGAKey P86c=1 PZ81=1| combines the PZ81 local and P86c non-local 
correlation functional, whereas \verb|GGAKey VWN=1 P86c=1| 
combines the VWN local and P86 non-local correlation functionals.


Linear combinations of all exchange and correlation functionals listed above
are possible with the \verb|GGAKey| keyword.


\subsubsection{XCFUN functionals}

Recently some support have been added for using the functionals from the XCFUN lib \textbf{fixme: insert proper reference}. Full 
support is expected in the next release, but unfortunately time constraints did not allow for 
full support in this release. 

Currently only LDA and GGA type functionals are currently supported and only upto and including 
linear response. The XCFUN functionals are activated using the .XCFUN keyword under the **INTEGRALS section (see Section \ref{sec:integral})
\begin{verbatim}
**INTEGRALS
.XCFUN
\end{verbatim} 
Linear combinations XCFUN functionals are possible with the \verb|GGAKey| keyword.

\end{description}

\subsection{*DFT INPUT}\label{subsec:dftinput}
Controls the XC-integration grid. 
The grid is generated as follows: 
For each atom a radial grid is created (different radial grids available, see below), 
which is multiplied with an angular grid (Lebedev-grids).
The angular grids are by default pruned for radial points close to the nucleus,  
following Murray, Handy and Laming.~\cite{dft-int:pruning} 
Grid weights for the grid points are calculated following different schemes (see below). 
Grid points with weights below $10^{-20}$ are disregarded. The default settings 
corresponds to \Key{GRID4}, but with the BLOCKSSF rather than the BLOCK partitioning scheme
(see details below).
Please note that the grid construction routines in the \lsdalton\
program changed compared to the \dalton\ program which may result in small deviations in the number of grid points etc.
\begin{description}
\item[\Key{ANGINT}] \verb||\newline
\verb|<ANGINT>|\newline
Determines the quality of the angular Lebedev grid -- the angular
integration of spherical harmonics will be exact up to the specified
order. Default value is $31$. Maximum value is $64$.
Note that the value of \verb|ANGINT| is changed by the following keywords:
\verb|COARSE|, \verb|NORMAL|, \verb|FINE|, \verb|ULTRAFINE|.
The \verb|GRIDX| keywords also imply specific \verb|ANGINT| values.
%%
%%\item[\Key{ANGMIN}] 
%% ANGMIN IS NOT ACTIVE ANYMORE IN \lsdalton\ 
%% 
\item[\Key{COARSE}]
Shortcut keyword for radial integration accuracy $10^{-11}$ and angular expansion order equal to $35$.
\item[\Key{DFTELS}] \verb||\newline
\verb|<DFTELS>|\newline
safety threshold -- stop if the charge integration error becomes larger then this threshold.
\item[\Key{DFTTHR}]\verb||\newline
\verb|<DFTHR0, DFTHRL, DFTHRI, RHOTHR>|
\begin{description}
\item[DFTHR0] is not used 
\item[DFTHRL] is not used 
\item[DFTHRI] threshold for screening product of gaussian atomic orbitals
\item[RHOTHR] threshold for screening of the electron density 
\end{description}
\item[\Key{DISPER}] defaults to .DFT-D3BJ (see below)
\item[\Key{DFT-D2}] switches on Grimmes DFT-D2 empirical dispersion correction~\cite{dft:dftd2}. The code will attempt to assign the correct functional dependent parameters based on the chosen DFT functional. Analytic gradient contributions are available.
\item[\Key{D2PAR}] \kw{READ (LUINP,*) D2\_s6\_inp, D2\_alp\_inp, D2\_rs6\_inp} \\ 
using this keyword user input values of the $s_6$, $\alpha$ and $s_{r,6}$ DFT-D2 parameters may be specified. If supplied these values override any values defined within the code.
\item[\Key{DFT-D3}] switches on Grimmes DFT-D3 empirical dispersion correction~\cite{dft:dftd3}. The code will attempt to assign the correct functional dependent parameters based on the chosen DFT functional. Analytic gradient contributions are available.
\item[\Key{DFT-D3BJ}] switches on Grimmes DFT-D3 empirical dispersion correction with Becke-Johnson damping~\cite{dft:dftd3bj}.  The code will attempt to assign the correct functional dependent parameters based on the chosen DFT functional.  Analytic gradient contributions are available. This is the presently recommended version.
\item[\Key{3BODY}] keyword for adding 3-body terms to the DFT-D3 dispersion energy. Note that gradients are not implemented for these corrections
\item[\Key{D3PAR}] \kw{READ (LUINP,*) D3\_s6\_inp, D3\_alp\_inp, D3\_rs6\_inp, D3\_rs18\_inp, D3\_s18\_inp} \\
  keyword for specifying the $s_6$, $\alpha$, $s_{r,6}$, $s_{r,8}$ and $s_8$ parameters of the DFT-D3 methods. Note, take care to match the parameter values to the correct version of the DFT-D3 correction.
\item[\Key{FINE}]
Shortcut keyword for radial integration accuracy $10^{-13}$ and angular expansion order equal to $42$.
\item[\Key{GRID TYPE}] \verb||\newline
\verb|<GC2 LMG TURBO BECKE BECKEORIG SSF BLOCK BLOCKSSF>|\newline
\verb|GC2|, \verb|LMG|, \verb|TURBO| define radial quadrature schemes, only one can be set.
\verb|BECKE|, \verb|BECKEORIG|, \verb|SSF|, \verb|BLOCK|, \verb|BLOCKSSF| define the grid partitioning schemes, only one can be set. 
\begin{description}
\item[GC2] Gauss-Chebyshev quadrature of second kind. 
\item[LMG] As proposed by Lindh, Malmqvist and Gagliardi (default).~\cite{dft-int:LMG}
\item[TURBO] Treutler-Ahlrichs M4-T2 scheme.~\cite{dft-int:treutler-ahlrichs} Implies also that the angular integration quality becomes Z-dependant (see also \verb|ANGINT|) and that pruning is used (see also \verb|NOPRUN|).
\item[BECKE] Becke partitioning scheme with atomic size correction.~\cite{dft-int:becke}
\item[BECKEORIG] Becke partitioning scheme without atomic size correction (default).~\cite{dft-int:becke}
\item[SSF] Stratmann-Scuseria-Frisch partitioning scheme.~\cite{dft-int:ssf}
\item[BLOCK] Becke partitioning scheme with atomic size correction~\cite{dft-int:becke}
combined with a blockwise handling of grid points~\cite{dft-int:dalton-blocked}. Useful for large molecules.
\item[BLOCKSSF] Stratmann-Scuseria-Frisch partitioning scheme~\cite{dft-int:ssf}
combined with a blockwise handling of grid points~\cite{dft-int:dalton-blocked}. Useful for large molecules.
%\item[CARTESIAN]
\end{description}
\item[\Key{GRID1}]
Shortcut for radial integration accuracy $1.0*10^{-5}$, 
angular expansion order equal to $17$, 
radial quadrature \verb|TURBO|, 
grid partitioning scheme \verb|BLOCK|.
\item[\Key{GRID2}]
Shortcut for radial integration accuracy $2.15447*10^{-7}$, 
angular expansion order equal to $23$, 
radial quadrature \verb|TURBO|, 
grid partitioning scheme \verb|BLOCK|.
\item[\Key{GRID3}]
Shortcut for radial integration accuracy $4.64159*10^{-9}$, 
angular expansion order equal to $29$, 
radial quadrature \verb|TURBO|, 
grid partitioning scheme \verb|BLOCK|.
\item[\Key{GRID4}]
Shortcut for radial integration accuracy $5.01187*10^{-14}$,
angular expansion order equal to $35$,
radial quadrature \verb|TURBO|,
grid partitioning scheme \verb|BLOCK|.
\item[\Key{GRID5}]
Shortcut for radial integration accuracy $2.15443*10^{-17}$,
angular expansion order equal to $47$,
radial quadrature \verb|TURBO|,
grid partitioning scheme \verb|BLOCK|.
%\item[\Key{HARTRE}]
%supresses the addition of the XC-contribution to the Fock-matrix/energy.
\item[\Key{HARDNESS}] \verb||\newline
\verb|<HARDNESS>|\newline
sets the hardness of the partitioning function in the Becke weighting scheme. Only positive integer values allowed. 
The higher the hardness the more stepfunction like the partitioning functions. 
Default value is $3$ as proposed by Becke.~\cite{dft-int:becke}
\item[\Key{NOPRUN}]
Supresses the default pruning of the atomic angular integration grids for radial points close to the nucleus. 
\item[\Key{NORMAL}]
Shortcut keyword for radial integration accuracy $10^{-13}$ and angular expansion order equal to $35$.
\item[\Key{RADINT}] \verb||\newline
\verb|<RADINT>|\newline
Determines the quality of the radial integration grid. Default radial integration accuracy is $10^{-11}$.
Note that the value of \verb|RADINT| is changed by the following keywords:
\verb|NORMAL|, \verb|FINE|, \verb|ULTRAFINE|.
The \verb|GRIDX| keywords also imply specific \verb|RADINT| values.
\item[\Key{ULTRAF}]
Shortcut keyword for radial integration accuracy $10^{-15}$ and angular expansion order equal to $64$.
\item[\Key{LB94}] Uses the van Leeuwen-Baerends asymptotic correction. This correction can be combined with all GGA type functionals
\item[\Key{CS00}] Using the Casida-Salahub asymptotic correction\cite{dixon,CasidaSalahub} 
\begin{eqnarray}
V^{\prime}_{XC}(\textbf{r}) = \max \left(V_{XC} + \Delta , V_{XC} + (1-\mathrm{HFexchange}) \cdot V_{LB94,correction}\right),  
\end{eqnarray}
with a Zhan-Nichols-Dixon shift \cite{dixon,ZND} ($\mathrm{HFexchange}=0.2$ for B3LYP)
\begin{eqnarray}
\Delta = ZND_{1} \cdot \epsilon_{HOMO} - ZND_{2}
\end{eqnarray}
Where $ZND_{1} = 0.2332$ and $ZND_{2} = 0.0116$. Note that $ZND_{2} = 0.0116 au. = 0.315 eV$.
The parameters have been optimized with respect to a B3LYP functional so these parameters can be changed using the following keywords. Note that this keyword only works with GGA type functionals. The CS00 keyword only work with a method which calculates the HOMO energy. 
\item[\Key{CS00 ZND1}] \verb| | \newline
\verb|<ZND1 in au.>|\newline
Changes the parameter $ZND_{1}$ (default $ZND_{1} = 0.2332$) see .CS00
\item[\Key{CS00 ZND1}] \verb| | \newline
\verb|<ZND2 in au.>|\newline
Changes the parameter $ZND_{2}$ (default $ZND_{1} = 0.0116$) see .CS00
\item[\Key{CS00 SHIFT}] \verb| | \newline
\verb|<Delta in au.>|\newline
Using the Casida-Salahub correction with a shift of Delta see .CS00
\end{description}

\subsection{*DENSOPT}\label{subsec:densopt}
This section contains the different options for obtaining the SCF wave function
and energy. The default is augmented Roothaan--Hall density optimization  in combination with
a conjugate residual optimal trialvectors (CROP) scheme for solving the (level-shifted) Newton equations ((see ref.~\cite{crop})) and using an
atom-in-a-molecule  starting guess. 

\begin{description}
\item[\Key{2ND\_ALL}] Use second order optimization in all SCF iterations.
\item[\Key{2ND\_LOC}] Use second order optimization in local SCF iterations.
\item[\Key{ARH}] Use Augmented Roothaan-Hall scheme for density optimization 
(default)~\cite{ARH1,ARH2} where the CROP solver (\cite{crop}) is used for 
solving the (level-shifted) Newton equation.\index{Augmented Roothaan-Hall}\index{ARH} 
\item[\Key{ARH FULL}] Use Augmented Roothaan-Hall for density optimization -
no truncation of the reduced space, keep all micro vectors for the CROP algorithm. 
\item[\Key{ARH DAVID}] Use Augmented Roothaan-Hall for density optimization where
the (level-shifted) Newton equations are solved using a reduced space solver based 
Davidson's algorithm \cite{davidson:1975}. This setting may be used if default settings  
converges to a saddle point. 
 \item[\Key{ARH(LS) DAVID}] The same procedure as described for \Key{ARH DAVID} 
augmented with a line search to accelerate convergence for very large molecular 
systems, but is less efficient than \Key{ARH DAVID} for smaller molecular systems. 
\item[\Key{STABILITY}] Check stability of the optimized wave function by calculation
of the lowest Hessian eigenvalue. 
\item[\Key{STAB MAXIT}] \verb| | \newline
\verb|<Max. number of stability iterations>|\newline
Max. number of iterations in calculation of lowest Hessian eigenvalue (default is 40).
\item[\Key{CHOLESKY}] Do Cholesky decomposition of overlap matrix (for density optimization
in orthogonal AO basis) - default is L{\"o}wdin decomposition by diagonalization.
\item[\Key{CONTFAC}] \verb| | \newline
\verb|<Contraction factor>|\newline 
For update of trust-radius (used in ARH and second order optimization). If trust-radius
should be contracted,
contract it by this factor (default is 0.7).
\item[\Key{CONTRAC}] \verb| | \newline
\verb|<Contraction criterion>|\newline 
For update of trust-radius (used in ARH and second order optimization). Contract trust-radius
if trust-radius ratio is smaller than this criterion (default is 0.25).
\item[\Key{CONVDYN}] \verb| | \newline
\verb|<Option>|\newline 
Dynamic SCF convergence threshold. This is suitable for calculations on large molecules, since the standard SCF
convergence threshold is based on the Frobenius norm of the SCF gradient, which is not size-extensive.
Options are SLOPPY, STANDARD, TIGHT, VTIGHT corresponding to $10^{-4}$, $10^{-5}$, $10^{-6}$, $10^{-7}$ times the square root of the number of electrons in the system.
\item[\Key{CONVTHR}] \verb| | \newline
\verb|<Threshold>|\newline
SCF convergence threshold - Frobenius norm of SCF gradient (default is 1.0d-4). 
Note that this convergence criterion
is not size-extensive. For large molecules, it is recommended to use .CONVDYN instead.
%\item[\Key{DIAGHESONLY}] Calculate only one SCF energy (i.e., no optimization) 
%and the lowest Hessian eigenvalue for a density constructed by weighted
%average of two input densities. Needs files D1 and D2 (densities). Lowest Hessian
%eigenvalue is found by setting up explicit Hessian and diagonalizing (expensive!).
\item[\Key{DIIS}] Pulay's DIIS scheme is used to speed up SCF convergence~\cite{diis1,diis2}.
\item[\Key{DISK}] Store densities and Fock/KS matrices from previous 
iterations on disk instead of in core when constructing the new Fock/KS matrix ({\it memory-saving option}).
\item[\Key{DISKSOLVER}] Store trial and sigma vectors on disk instead of in core
when solving linear equations ({\it memory-saving option}). Only referenced using ARH
, Direct Density optimization or second order optimization.
%\item[\Key{DSM}] The Density Subspace Minimization scheme is used to speed up SCF convergence~\cite{TOKJ,TOYJ}.
%\item[\Key{DSMONE}] The Density Subspace Minimization scheme is used to speed up SCF convergence, 
%but only one DSM step is taken in each SCF iteration.
%\item[\Key{DSMXTRA}] The Density Subspace Minimization scheme is used to speed up SCF convergence,
%including extra (more expensive) term.
%\item[\Key{DUMPMAT}] Dump Fock/KS and density matrices from all iterations to disk for later investigation.
%\item[\Key{EDIIS}] The energy-DIIS scheme is used to speed up SCF convergence~\cite{ediis}.
\item[\Key{EXPAND}] \verb| | \newline
\verb|<Expansion criterion>|\newline 
For update of trust-radius (used in ARH and second order optimization). Expand trust-radius
if trust-radius ratio is larger than this criterion (default is 0.75).
\item[\Key{EXPFAC}] \verb| | \newline
\verb|<Expansion factor>|\newline 
For update of trust-radius (used in ARH and second order optimization). If trust-radius
should be expanded,
expand it by this factor (default is 1.2).
\item[\Key{FIXSHIFT}] \verb| | \newline
\verb|<Shift>|\newline 
Use a fixed level shift in all SCF iterations.
%\item[\Key{HESONLY}] Calculate only one SCF energy (i.e., no optimization) 
%and the lowest Hessian eigenvalue for a density constructed by weighted
%average of two input densities. Needs files D1 and D2 (densities). Lowest Hessian
%eigenvalue is iteratively.
\item[\Key{HESVEC}] \verb| | \newline
\verb|<Number of Hessian eigenvalues>|\newline
Number of lowest Hessian eigenvalues to be calculated with keyword .STABILITY 
(default is 1). 
\item[\Key{LCV}] Compute the Least-Change Valence orbitals after valence density optimization step.
All subsequent calculations are computed using Least-Change Valence orbitals augmented with atomic virtual orbitals of the Atomic density as basis set.
Keyword only effective with TRILEVEL starting guess.
\item[\Key{LCM}]  Compute the Least-Change Molecular orbitals after the Full molecular density calculation.  All subsequent calculations are computed using these orbitals as basis set. .LCV is automatically included. Keyword only meaningful with TRILEVEL starting guess.
\item[\Key{LEVELSH}] \verb| | \newline
\verb|<N> <shift1> <shift2> ...<shiftN> |\newline 
Use custom level shifts in the first {\it N} SCF iterations.
%\item[\Key{LINCOMB}] \verb| | \newline
%\verb|<Weight for linear combination> |\newline
%Weight to use for D1 when linear combination of densities is used as starting
%guess (.START $\rightarrow$ LINCOMB)

\item[\Key{LOW ACCURACY START}] Use low accuracy settings in the first couple of 
iterations until the appropriate gradient threshold have been reached. 

%\item[\Key{LWITER}] Do L{\"o}wdin decomposition of overlap matrix (for density optimization
%in orthogonal AO basis) - iteratively (default is L{\"o}wdin by diagonalization)~\cite{shalf}.
%\item[\Key{LWQITER}] Do L{\"o}wdin decomposition of overlap matrix 
%in quadruple precision (for density optimization
%in orthogonal AO basis) - iteratively.
\item[\Key{MAXELM}] \verb| | \newline
\verb|<Trust radius (max. element)> |\newline
Absolute max. element of step allowed (default is 0.35).
Used in ARH and second order optimization.
\item[\Key{MAXIT}] \verb| | \newline
\verb|<Max. number of iterations> |\newline
Max. number of SCF iterations (default is 100).
%\item[\Key{MAXRATIO}] \verb| | \newline
%\verb|<Max. ratio for DORTH> |\newline
%Largest accepted ratio when using level shift .DORTH.
\item[\Key{MAXSTEP}] \verb| | \newline
\verb|<Trust radius (Frobenius norm)>|\newline
Absolute max. Frobenius norm of step allowed (default is 0.6).
Used in ARH and second order optimization.
\item[\Key{MICTHRS}] \verb| | \newline
\verb|<Threshold for micro iterations>|\newline
The micro iterations of the CROP algorithm are converged to gradient norm times this factor (default is 1.0d-2).
Only referenced if ARH, Direct Density optimization or second order optimization.
\item[\Key{MICROVECS}] \verb| | \newline
\verb|<Max. number of microvectors>|\newline
Max. number of microvectors to be kept in the CROP scheme
(default is 2). 
Only referenced if ARH, Direct Density optimization or second order optimization.
\item[\Key{MINDAMP}] \verb| | \newline
\verb|<Minimum damping>|\newline
Never allow level shift to be smaller than this.
%\item[\Key{MOCHANGE}] Level shifting is done by use of MO overlaps (diagonalization only).
%\item[\Key{NALPHA}] \verb| | \newline
%\verb|<Number of alpha electrons>|\newline
%Explicitly specify number of alpha electrons (automatically set if not specified). If both NALPHA and NBETA are set, they must conform with the total number of electrons!
%\item[\Key{NBETA}] \verb| | \newline
%\verb|<Number of beta electrons>|\newline
%Explicitly specify number of alpha electrons (automatically set if not specified). If both NALPHA and NBETA are set, they must conform with the total number of electrons!
\item[\Key{NOAV}] Turn off Fock matrix averaging in SCF iterations (this is default since the default optimization scheme is ARH, which contains implicit averaging).
%\item[\Key{NEWDAMP}] New level shifting which should be better suited for ARH/CROP. CAREFUL! Still under development!
\item[\Key{NVEC}] \verb| | \newline
\verb|<Max. no of vectors for averaging>|\newline
Maximum number of previous Fock and density matrices to be stored and used for ARH and DIIS (default is 10 for HF and 7 for DFT).
%\item[\Key{NVECDSM}] \verb| | \newline
%\verb|<Max. no of vectors for DSM>|\newline
%\item[\Key{NVECDII}] \verb| | \newline
%\verb|<Max. no of vectors for DIIS>|\newline
%\item[\Key{NOINCREM}] Turn off incremental scheme for Fock/KS matrix build.
\item[\Key{NOPREC}] Turn off preconditioning of linear equations (ARH, TrFD, and second order optimization).
\item[\Key{NOSHIFT}] Do no level shifting.
%\item[\Key{OVERLAP}] \verb| | \newline
%\verb|<Overlap>|\newline
%Smallest accepted overlap when doing level shift by use of MO overlaps (.MOCHANGE).
%\item[\Key{PURIFY}] \verb| | \newline
%\verb|<Purification method>|\newline
%Use purification scheme for density optimization 
\item[\Key{RESTART}] The code automatically saves the density matrix in each SCF iteration in a file called dens.restart. This option restart the calculation from this density matrix. If the program cannot find the dens.restart file the keyword have no effect. 
\item[\Key{SKIPSCFLOOP}] The code automatically saves the density matrix and the Fock/Kohn-Sham matrix at the end of the SCF iterations in two files called dens.restart and fock.restart. This option reads the files and skips the SCF iterations.
\item[\Key{RH}] Use standard Roothaan-Hall scheme (diagonalization) for density optimization.
%\item[\Key{SCALVIR}]
%\item[\Key{SOEO}]
%\item[\Key{SPARSE}]
\item[\Key{SOEO}]
Use second order ensemble optimization. Remember to specify active space and starting occupations. Use only in combination with \Key{NOGCBASIS}. 
Requires \Key{HF} or \Key{DFT} as wave function. After an ensemble optimization, the orbitals are written to file \verb|cmo.out| and the AO 
density matrix is written to \verb|dao.out|, which may be used to plot molecular orbitals and charge density plots.
\item[\Key{SOEOSPACE}] \verb| | \newline
\verb|<core>| \verb|<act>|\newline
Specification of the orbitals in the active space. \verb|<core>| being the number of core orbitals (occupations not optimized), and \verb|<act>| the number 
of active orbitals, where the orbital occupations are optimized.
\item[\Key{SOEOOCC}] \verb| | \newline
\verb|<fully occupied>|\newline 
\verb|<fractionally occupied>|\newline
\verb|<n1>| \verb|<n2>| $\cdots$ \newline
Specification of the distribution of electron pairs in the starting orbitals in a second order ensemble optimization. \verb|<fully occupied>| is the number of 
fully occupied orbitals and \verb|<fractionally occupied>| is the number of fractionally occupied orbitals. \verb|<n1>|, \verb|<n2>| etc. are the fractional 
occupations of the fractionally occupied spin-orbitals in the starting guess. The given occupations must lie between zero and one. If they are either zero 
or one, this orbital occupation is not optimized. Equal distribution may result in wrong results due to symmetry. The sum of the fully occupied orbitals and 
the given orbital occupations \verb|<n1>|, \verb|<n2>| etc., must equal the total number of electron pairs in the system. (NOTE that it is possible to 
specify an active space of zero orbitals, but still include fractional occupations. The optimization will thus optimize the shapes of the orbitals, without 
optimizing the orbital occupations.)
\item[\Key{SOEOSAVE}] 
Saves the AO Fock matrix (and the AO density matrix) to the file \verb|soeosave.out|. Used for restart.
\item[\Key{SOEORST}] 
Restart second order ensemble optimization from orbitals stored in \verb|soeosave.out| (so remember to copy this file to the working directory). 
The molecular geometry need not be the same as in the calculation 
where the stored orbitals were created. The active space and starting occupations still need to be specified using \Key{SOEOSPACE} and \Key{SOEOOCC}.
\item[\Key{SOEOGC}] 
Grand-canonical ensemble optimization. Removes the restriction on the total number of electrons from the second order ensemble optimization. The sum of the 
starting occupations still must be correct.
\item[\Key{SOEOMATHR}] \verb| | \newline
\verb|<macro threshold>|\newline 
Specifies the convergence threshold for the macro iterations in second order ensemble optimization.
\item[\Key{SOEOMITHR}] \verb| | \newline
\verb|<micro threshold>|\newline 
Specifies the convergence threshold for the micro iterations in second order ensemble optimization.
\item[\Key{SOEOTRUST}] \verb| | \newline
\verb|<trust-radius>|\newline 
Specifies the starting trust-radius in the ensemble optimization. Trust-radius will still be updated throughout the optimization.
\item[\Key{SOEODIPOLE}] Use the ensemble density matrix to determine electric dipole moment and static electric polarizability.
\item[\Key{START}] \verb| | \newline
\verb|<Option>|\newline
Starting guess for SCF optimization. Options are:
\begin{itemize}
\item {\bf H1DIAG} Obtain initial guess by diagonalizing one-electron Hamiltonian
\item {\bf ATOMS}  Obtain initial guess by atoms-in-molecules approach (default)
\item {\bf TRILEVEL} Optimization in three steps. 1. Atomic densities, 2. Valence molecular density, 3. Full molecular density~\cite{trilevel1, trilevel2}. 
\end{itemize}
Note that Huckel guess is not supported by \lsdalton.
%\item[\Key{TRSCF}] Use Trust-Region SCF scheme, i.e. diagonalization, .DORTH level shift, and DSM~\cite{TOKJ,TOYJ}.
%\item[\Key{TrFD}] Density optimization by minimization of the Roothaan-Hall energy E$_{\rm RH}$ = Tr{\bf FD}({\bf X})~\cite{TrFD}.
%\item[\Key{TrFD FULL}] As above, but keep the full subspace of trial vectors (instead of truncating) when solving linear equations.
%\item[\Key{UNREST}] Force unrestricted calculation (default for open shell systems).
\item[\Key{VanLenthe}] Use Van Lenthe's scheme for level shifting and averaging~\cite{VanLenthe}.

\subsection{\$INFO}\label{subsec:info}
For the different parts of the wave function optimization, it is possible
to get very detailed information.
This section describes these keywords. They must be put
under *DENSOPT in a section beginning with
\$INFO and ending with \$END INFO. Note that these keywords
do NOT start with a dot!
\begin{description}
\item[\Keyinfo{INFO\_CROP}] Detailed info from Conjugated Residual OPtimal vectors scheme (Direct Density Optimization, ARH and second order optimization).
\item[\Keyinfo{INFO\_DIIS}] Detailed info from Direct Inversion in the Iterative Subspace algorithm.
%\item[\Keyinfo{INFO\_DSM}] Detailed info from Density Subspace Minimization algorithm.
%\item[\Keyinfo{INFO\_DSM\_DETAIL}] Even more detailed info from Density Subspace Minimization algorithm.
\item[\Keyinfo{INFO\_LEVELSHIFT}] Detailed info from determination of dynamic level shift (Direct Density Optimization, ARH and second order optimization). 
\item[\Keyinfo{INFO\_LINEQ}] Detailed info from solution of linear equations and trust-radius update (Direct Density Optimization, ARH and second order optimization).
\item[\Keyinfo{INFO\_RH}] Detailed info from Roothaan-Hall algorithm (diagonalization).
\item[\Keyinfo{INFO\_RH\_DETAIL}] Even more detailed info from Roothaan-Hall algorithm (diagonalization).
\item[\Keyinfo{INFO\_STABILITY}] Detailed info from calculation of lowest Hessian eigenvalue (stability analysis) and HOMO-LUMO gap.
\item[\Keyinfo{INFO\_STABILITY\_REDSPACE}] Reduced space info from calculation of lowest Hessian eigenvalue (stability analysis) and HOMO-LUMO gap.
%\item[\Keyinfo{INFO\_WEIGHT}] Detailed info about weights of the densities in DIIS and DSM algorithms.
\item[\Keyinfo{}]
\end{description}\end{description}

\section{**OPTIMIZE}\label{sec:optimize}
This input module describes the keywords needed to optimize a molecular geometry.
In the current release no second-order algorithms are available since the molecular Hessian is not implemented, but
a number of quasi-Newton trust-radius level-shifted techniques for finding
equilibrium geometries are available (\Key{BFGS}, \Key{PSB}, \Key{DFP}).
The methods differ in the way approximate Hessians are built and updated: \Key{INIMOD}, \Key{INIRED} and \Key{INITEV} provide different approximations for the initial Hessian, 
while \Key{MODHES} recomputes the approximated Hessian at every geometry.

The geometry optimization generates a sequence of geometry steps. The coordinates of each 
accepted step are stored in the files MOLECULE.\emph{XXX}, where \emph{XXX}
is the geometry step number, and the final converged geometry in MOLECULE.OUT.

Geometric structure can be optimized in redundant internal (\Key{REDINT}) or
Cartesian  (\Key{CARTES}) coordinates with two sets of convergence criteria (two for the gradient and two for the step).
Convergence is obtained when the following four quantities are respectively smaller than the four convergence criteria $\epsilon$, 5$\epsilon$, 3$\epsilon$ and 15$\epsilon$  \cite{NewConv}:
\begin{itemize}
\item the root-mean-square of the gradient, 
\item the maximum absolute value of the gradient, 
\item the root-mean square of the step vector,
\item and the maximum absolute element (in internal or Cartesian coordinates) of the step vector.
\end{itemize}


The default setting specifies the minimization in internal coordinates \cite{DaltonOpt}, with a model Hessian \cite{ModelHess} updated with BFGS formula. 
The atoms-in-molecule approach is used to set up the initial density-matrix at each new
geometry step.
However, it is possible to take as starting guess McWeeny-purified converged
density-matrix at the previous geometry. This is achieved by setting the \Key{RESTART} option under
the *DENSOPT subsection.
The default value of $\epsilon$ is $10^{-5}$
(Other predefined values for the convergence criteria can be set using the keywords \Key{VLOOSE}, \Key{LOOSE}, \Key{TIGHT} and \Key{VTIGHT}).
Alternatively the convergence criteria of Baker~\cite{Baker} can be set using \Key{BAKER}.


\vspace{1 cm}
\noindent
\textbf{Example of test cases for geometry optimization calculations} \newline
The test cases are located in LSDALTON/test/geomopt.
These test cases illustrate the main features of the geometry optimization:
\begin{itemize}
\item
\textit{geomopt/cartes\_bfgs\_min}:
performs a DFT/LDA geometry optimization in Cartesian coordinates,
with BFGS update of an initial Hessian equal to a unit matrix
and Baker convergence criteria.
\item
\textit{geomopt/redint\_bfgs}:
performs a DFT/BLYP geometry optimization in redundant internal coordinates
with a model Hessian updated with BFGS formula
and Baker convergence criteria.
\item
\textit{geomopt/Excited\_state\_opt}:
performs a DFT/B3LYP geometry optimization of an excited state in redundant internal coordinates
and Baker convergence criteria.
\item
\textit{geomopt/cartes\_psb\_min}:
performs a DFT/BLYP geometry optimization in Cartesian coordinates
with a diagonal initial Hessian updated by PSB formula,
McWeenie's purification used for constructing the initial guess
and Baker convergence criteria.
\item
\textit{geomopt/geoopt\_constrain}:
shows a constrained geometry optimization of ethane,
keeping the C-C bond distance fixed
(Internal coordinate \#1 as determined from the use of \Key{FINDRE}).
\item
\textit{geomopt/cartes\_trilevel\_newconv}:
performs a geometry optimization in Cartesian coordinates
with \Key{TRILEVEL} starting guess and a default convergence criteria,
 a diagonal initial Hessian updated by a loose DFP formula.
\end{itemize}

\begin{description}

\item[\Key{BAKER}]
Activates the convergence criteria of Baker \cite{Baker}. The minimum
is then said to be found when the largest element of the gradient
vector (in Cartesian or redundant internal coordinates) falls below
$3\cdot 10^{-4}$ and either the energy change from the last
iteration is less than $10^{-6}$ or the largest element of
the predicted step vector is less than $3\cdot 10^{-4}$.

\item[\Key{BFGS}]
Specifies the use of a first-order method\index{first-order optimization}
with the Broyden-Fletcher-Goldfarb-Shanno (BFGS)
update formula for optimization. This is the
preferred first-order method for minimizations, as this update is able
to maintain a positive definite Hessian.

\item[\Key{CARTES}]
Specifies that Cartesian coordinates\index{Cartesian coordinates}\index{coordinate system!Cartesian coordinates}
should be used in the optimization.

\item[\Key{CONSTR}]\verb| | \newline
\verb|<Number of contrained redundant internal coordinates>|\newline
\verb|<Indices of each contrained redundant internal coordinate, one per line>|\newline
Specifies a contrained geometry optimization. You will need to give
the total number of redundant internal coordinates to constrain and their
indices as defined using the \Key{FINDRE} keyword.
For example fixing redundant internal coordinates 4 and 9 would read like:
\begin{verbatim}
...
**OPTIMIZE
.CONSTR
2
4
9
...
**END OF INPUT
\end{verbatim}


\item[\Key{DFP}]
Specifies that a first-order\index{first-order optimization} method with the
Davidon-Fletcher-Powell (DFP) update formula should be used for optimization.

\item[\Key{FINDRE}]
Using this keyword no geometry optimization is carried out, but only the redundant internals coordinates are found.

\item[\Key{INIMOD}]
Use a simple model Hessian~\cite{ModelHess} diagonal in redundant
internal coordinates as the initial Hessian. All diagonal elements are
determined based on an extremely simplified molecular mechanics model,
yet this model provides Hessians that are good starting points for
most systems, thus avoiding any calculation of the exact Hessian. This
is the default for optimizations in redundant internal coordinates. Currently 
this is not an option for optimization in Cartesian coordinates.

\item[\Key{INIRED}]
Specifies that the initial Hessian should be diagonal in redundant internal 
coordinates. The different diagonal
elements are set equal to 0.5 for bonds, 0.2 for angles and 0.1 for
dihedral angles, unless \Key{INITEV} has been specified. If the
optimization is run in Cartesian coordinates, the diagonal internal
Hessian is transformed to Cartesians.

\item[\Key{INITEV}]\verb| | \newline
\verb|<Read EVLINI, the eigenvalues>|\newline
The default initial Hessian for first-order
minimizations is the identity matrix when Cartesian coordinates are used, and a diagonal
matrix when redundant internal coordinates are used. If \Key{INITEV}
is used, all the diagonal elements (and therefore the eigenvalues) are
set equal to the value EVLINI. 

\item[\Key{LOOSE}]
Default convergence criterion $\epsilon$ set to $1.0\cdot 10^{-4}$.

\item[\Key{MAX IT}]
Maximum number of iterations in geometry optimization scheme
(default set to 100).

\item[\Key{MODHES}]
Determine a new model Hessian (see \Key{INIMOD})
at every geometry without doing any updating. The model is thus used
in much the same manner as an exact Hessian, though it is obviously
only a relatively crude approximation to the analytical Hessian.

\item[\Key{PRINT}]\verb| | \newline
\verb|<Print level>|\newline
Print level for the output. The higher the print level, the more information
is printed to the output file.

\item[\Key{REDINT}]
Specifies that redundant internal coordinates\index{Redundant internal coordinates}\index{coordinate system!Redundant internal coordinates}
should be used in the optimization. This is the default.

\item[\Key{PSB}]
Specifies that a first-order method with the
Powell-Symmetric-Broyden (PSB) 
update formula should be used for optimization.

\item[\Key{TIGHT}]
Default convergence criterion $\epsilon$ set to $1.0\cdot 10^{-6}$.

\item[\Key{VLOOSE}]
Default convergence criterion $\epsilon$ set to $1.0\cdot 10^{-3}$.

\item[\Key{VTIGHT}]
Default convergence criterion $\epsilon$ set to $1.0\cdot 10^{-7}$.

\end{description}

\section{**DYNAMI}\label{sec:dynami}
This input module is devoted to molecular dynamics simulations. \lsdalton\ provides some tools for performing
direct Born-Oppenheimer molecular dynamics, i.e. trajectories are integrated with forces calculated on the fly.
Trajectory integration is available for SCF-type wavefunctions (with dispersion correction for DFT)
  and for DEC wavefunctions. Properties could be calculated along the trajectories and should be
 specified in the **RESPONSE section.
\lsdalton\ simulates microcanonical(NVE) ensembles. Currently no sampling is availabe and the starting coordinates
and velocities must be provided as input. Trajectories are integrated with gradient-based velocity-Verlet 
method \cite{Verlet}. 

\lsdalton\ provides several options for the choice of starting guess for SCF-type electronic theory methods. By
default, the guess is generated anew each time step according to the corresponding input. Alternatively, one can
restart from the density optimized at the previous time-step. This is achieved by setting the .RESTART option under
the *DENSOPT subsection. This reduces the number of SCF iterations per time-step and accelerates the integration. 
Two more efficient algorithms for starting guess propagation are implemented in \lsdalton\: Fock matrix dynamics \cite{FMD} 
 and time-reversible propagator \cite{TimRev}.  
\newline
\vspace{1 cm}
\noindent
\textbf{Example test cases for **DYNAMI calculations}: \newline
These test cases illustrate the main features of direct dynamics. The test cases are located in LSDALTON/test/ddynam:
\begin{itemize}
\item
\textit{ddynam/H2O\_fmd}: free water molecule with Fock matrix dynamics; 
\item
\textit{ddynam/HCN\_ddyn}: HCN dissociation with restart density; 
\item
\textit{ddynam/HF\_vib}: a vibrating HF molecule with time-reversible propagator.
\end{itemize}

\begin{description}
\item[\Key{PRINT}]\verb| | \newline
\verb|<Print level>|\newline
Print level for the output. The higher the print level, the more information
is printed to the output file.
\item[\Key{TIMESTEP}]\verb| | \newline
Defines integration time step in femtoseconds which should be given in the next line (real). The
default i 0.5 fs.
\item[\Key{MAX ITER}]\verb| | \newline
Defines maximum number of time steps. Must be given in the next line (integer). The default is 100.
\item[\Key{MASSWE}]\verb| | \newline 
States that the integration is carried out in mass-weighted coordinates. The default is FALSE.
\item[\Key{MWVEL}]\verb| | \newline 
States that the input velocities are mass-weighted. The default is FALSE.
\item[\Key{VELOCI}]\verb| | \newline 
Begins the input of the velocities. In the next line the number of atoms should be given (integer),
then the velocities grouped atom-wise: three(x,y,z) in a line (real). The default is for all 
velocities to be zero.
\item[\Key{FOCKMD}]\verb| | \newline 
Fock matrix dynamics. Below number of points for extrapolation $N$ and polynomial order $M$ must
be specified. Note that $M>N$ (both integer). Works only with .RESTART option under the *DENSOPT subsection
\item[\Key{TIMREV}]\verb| | \newline 
Time-reversible density propagation. Below the number of points for extrapolation $N$ (integer)  must be specified.
The only thoroughly tested option is $N=2$.

\end{description}


\section{**LOCALIZE ORBITALS}\label{subsec:orbloc}

This section describes keywords needed to perform localization of Hartree--Fock orbitals. The optimization of the
chosen localization function will be performed using a trust-region algorithm \cite{hoyvik:TRM}, and can be performed for  the occupied space and/or the virtual orbital space. For the occupied space the core and valence spaces will be localized separately.  

After running a Hartree-Fock calculation followed by an orbital localization two files with molecular orbital coefficients will be present; \textit{cmo\_orbitals.u} and \textit{lcm\_orbitals.u}. \textit{cmo\_orbitals.u} contains coefficients for the canonical molecular orbitals (CMO) and \textit{lcm\_orbitals.u} contains coefficients for the localized molecular orbitals (LMO). The coefficient matrix row index refers to the atomic orbital basis index, while the column index refers to the molecular orbital basis. The format of the files are as described in the Matrix File Format part of Section \ref{interfacing}.  

For the most efficient orbital localization for large molecular systems \cite{hoyvik:3L}, the .ARH, .START/TRILEVEL  and .LCM options are recommended for use as described in Section \ref{subsec:densopt}, and .PSM with powers 2 2 are recommended for the **LOCALIZE ORBITALS section.  

\begin{description}

\item[\Key{PSM}]\verb| | \newline
\verb|<m m>|\newline
Use powers m of the second moment (PSM) localization function \cite{jansik:2011}.  A power 0 specifies that no localization should be carried out (e.g., 0 1  to only localize the virtual space). m=1 is equivalent with the Boys localization function. For improved locality m$\ge$2 is recommended. 

\item[\Key{PFM}]\verb| | \newline
\verb|<m m>|\newline
Use powers m of the fourth moment (PFM) localization function \cite{hoyvik:PFM}.  A power 0 specifies that no localization should be carried out (e.g., 0 1  to only localize the virtual space). Using power 1 yields orbitals with good locality, but a power 2 is recommended if locality of the orbitals is essential. Powers higher than 3 are not recommended.  The PFM localization function should be chosen if basis sets augmented with diffuse functions are used.

\item[\Key{PipekMezey}]\verb| | \newline
Use Pipek-Mezey localization function using an implementation based on L{\"o}wdin population analysis 
rather than the traditional Mulliken population analysis (see Ref. \cite{hoyvik:PM}).  Both occupied and virtual orbitals will be localized. Please note, the Pipek-Mezey localization function suffers from system and basis set dependencies. For systems with complicated bonding structures or when using basis sets augmented with diffuse functions the PSM or PFM options should be used if good locality is essential.

\item[\Key{OccPipekMezey}]\verb| | \newline
Pipek-Mezey localization of only the occupied space.


\item[\Key{VirtPipekMezey}]\verb| | \newline
Pipek-Mezey localization of only the virtual space.


\item[\Key{PipekM(MULL)}]\verb| | \newline
Use Pipek-Mezey localization function using the Mulliken population analysis. A power 0 specifies that no localization should be carried out.  Otherwise the same considerations as for the \Key{PipekMezey} option.


\item[\Key{OccPipekM(MULL)}]\verb| | \newline
Pipek-Mezey localization (using Mulliken population analysis) of occcupied space.

\item[\Key{VirtPipekM(MULL)}]\verb| | \newline
Pipek-Mezey localization (using Mulliken population analysis) of virtual space.

\item[\Key{No Level2 Localization}]\verb| | \newline
Should only be used in combination with the .START/TRILEVEL and  .LCM options for the *DENSOPT section. The keyword is used to skip orbital localization after the second level in the three level procedure. Not recommended for general use, but can be used to save  computational time if only the virtual space is to be localized.  

\item[\Key{Only Loc}]\verb| | \newline
Provided the file with the molecular orbital coefficients (e.g., \textit{cmo\_orbitals.u} or \textit{lcm\_orbitals.u}) using this keyword the Hartree-Fock calculation will be skipped, and the orbitals will be read in and localized. Important: rename or copy the orbital coefficient file to \textit{orbitals\_in.u}, only this file will be read. After the localization procedure the molecular orbital coefficients corresponding to the localized basis is written to \textit{orbitals\_out.u}. Thus, for this keyword to be used, \textit{orbitals\_in.u} must exist and a localization function must be chosen.


\item[\Key{Orbital Locality}]\verb| | \newline
This keyword will make sure second and fourth moment orbital spreads are printed for all orbitals, not just the least local ones.


\item[\Key{MACRO IT}]\verb| | \newline
<option>
Set maximum number of macro iterations for orbital localization procedure. Default is 200. 


\item[\Key{LOOSE MICRO THRESH}]\verb| | \newline
Looser threshold for solving level-shifted Newton equations in davidson solver in orbital localization procedure. Should only be used if a calculation fails and the error message tells you to use this keyword.

\item[\Key{Orbital Plot}]\verb| | \newline
\verb|<orbital specification>|\newline	
Generates .plt file for either the least local or the most local orbitals. To generate .plt files for the least local orbitals use orbital specification   LEASTL, whereas to generate .plt files for the most local orbitals use specification MOSTL. If both least local and most local are wanted, make two \Key{Orbital Plot} sections with each of the specifications. The .plt files may be plotted using for example the UCSF Chimera program package \cite{chimera}. Note: for plotting other orbitals, use the **PLT option described in section \ref{sec:plt}. Also note that the grid dimensions may be modified as described in Section~\ref{sec:pltgrid}.
\end{description}




\section{**RESPONS}\label{subsec:respons}
This section describes the keywords needed for obtaining molecular
properties for HF and DFT based on the atomic orbital based response formulation~\cite{thorvaldsen:214108}.
The response section begins with
**RESPONS. 
General response information related to more than one property
(e.g. how many excitation energies)
is put directly under **RESPONS.
After this,
each individual response property (e.g. the polarizability tensor)
is labeled by an asterisk, and the specific (optional) information related
to that property (e.g. which optical frequencies) follows 
below.
All input values are given in atomic units.
The general structure is thus:
\begin{description}
\item[\Keyinfo{**RESPONS}]
\item[\Keyinfo{.General response information}]
\item[\Keyinfo{*Label for property 1}]
\item[\Keyinfo{.Specific (optional) information for property 1}]
\item[\Keyinfo{*Label for property 2}]
\item[\Keyinfo{.Specific (optional) information for property 2}]
\end{description}
Each of the properties below have a test case.
The test cases may be found in the {\bf LSDALTON/test/LSresponse} directory.
To run a test case, go to the
{\bf test/} directory and type: 
\begin{description}
\item
\verb|./TEST  <test case>|
\end{description}
The test case files contains simple examples of input files.

Below, the list of general response input keywords follows.

\begin{description}
\item[\Key{NEXCIT}] \verb| | \newline
\verb|<Number of excitation energies>|\newline
Determines the number of excitation energies to be calculated.
If this keyword is set, the excitation energies 
and the corresponding one-photon dipole absorption strengths
for the lowest NEXCIT excited states (i.e. excited states 1 to NEXCIT) 
are always calculated.
\emph{\bf Important:} If properties involving excited states
are to be requested (e.g. two-photon absorption or the excited state gradient),
this keyword must be listed \emph{before}
any of these properties. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_opa
\end{description}

\subsection{*SOLVER}\label{subsec:responsesolver}
General information related to the way response equations are solved to 
obtain a given property.
By default, standard and eigenvalue response equations are solved using the
algorithm with paired trial vectors~\cite{coriani:2007}, whereas damped
(complex) response equations are solved using the algorithm with
symmetrized trial vectors~\cite{kauczor:2011}.\newline
This choice can be modified using the \Key{SYM\_SOLVER} and \Key{PAIR\_SOLVER} keywords, see below.
\begin{description}
\item[\Key{SYM\_SOLVER}] \verb| | \newline
The solver with symmetrized trial vectors is used for solving standard
response equations.\newline
{\bf Test case}: LSresponse/LSresponse\_HF\_alpha\_astv
\item[\Key{PAIR\_SOLVER}] \verb| | \newline
The solver with paired trial vectors is used for solving damped (complex)
response equations.\newline
{\bf Test case}: LSresponse/LSresponse\_DFT\_alpha\_aptv
\item[\Key{CONVTHR}] \verb| | \newline
\verb|<Convergence threshold>|\newline
Convergence threshold to which response equations are solved.
Default value is set to $10^{-4}$.
\item[\Key{MAXIT}] \verb| | \newline
\verb|<Maximum number of iterations>|\newline
Maximum number of iterations in the iterative procedure.
Default value is set to 100.
\item[\Key{MAXRED}] \verb| | \newline
\verb|<Maximum size of the reduced space>|\newline
Maximum size of the reduced space.
Default value set equal to 200.
\item[\Key{AOPREC}] \verb| | \newline
AO preconditioning is used (MO preconditioning by default).
AO preconditioning may only be used within the algorithm with paired trial vectors.
\item[\Key{NOPREC}] \verb| | \newline
No preconditioning is used.
\item[\Key{CONVDYN}] \verb| | \newline
\verb|<Option>|\newline 
Dynamic convergence threshold suitable for large calculations.
Options are TIGHT, STANDARD, and SLOPPY.
\item[\Key{RESTEXC}] \verb| | \newline
\verb|<Number Of excitation Vectors on file>|\newline 
This is a restart option, that allows the user to restart the calculation. 

Assume for instance that you have already done one calculation where you requested 6 excitation 
energies but realize that you need 10. You can provide the file rsp\_eigenvecs and use

.RESTEXC\\
6 

option to restart the calculation from the previous. 
This option can also be used to bypass the excitation vector step if the previous calculation failed for some property evaluation which needed the excitation vectors.  
\item[\Key{DTHR}] \verb| | \newline
\verb|<Threshold>|\newline 
Threshold for when excited states are to be considered degenerate
\end{description}
Now follows a list of input keywords for the specific properties
available in \lsdalton.

\subsection{*DIPOLE}\label{subsec:dipole}
Calculation of the permanent dipole moment

\subsection{*DIPOLEMOMENTMATRIX}\label{subsec:dipolematrix}
Calculation of the full dipole moment matrix:\newline
\begin{eqnarray}
\mu = \left(\begin{array}{cccc}
\mu_{00} & \mu_{01} & \mu_{02} & \dots \\
\mu_{10} & \mu_{11} & \mu_{12} & \dots \\
\mu_{20} & \mu_{21} & \mu_{22} & \dots \\
\dots & \dots & \dots & \dots \\
\end{array}\right)
\end{eqnarray}
\begin{itemize}
\item $\mu_{00}$ denote the permanent dipole moment for the ground state
\item $\mu_{0i}$ denote the transition dipole moment between the ground state and the i'th excited state
\item $\mu_{ii}$ denote the Permanent dipole moment for the i'th excited states
\item $\mu_{ij}$ denote the transition dipole moment between the i'th and j'th excited state
\end{itemize}

{\bf Requires specification of .NEXCIT!}\newline

\subsection{*ALPHA}\label{subsec:alpha}
Calculation of the (possibly complex) 
electric dipole polarizability tensor $\alpha_{AB}$ and its isotropic average.
The polarizability equals minus the linear response function
$\langle\langle \mu_A; \mu_B \rangle\rangle_{\omega_B}$, where
$\omega_B$ is in general allowed to be complex -- that is,
$\omega_B = \omega_B^R + i \omega_B^I$.
Unspecified frequencies are set to zero by default,
i.e. if no frequencies are specified, the static polarizability is calculated.
\newline
{\bf Test case}: LSresponse/LSresponse\_HF\_alpha 
\begin{description}
\item[\Key{BFREQ}] \verb| | \newline
\verb|<Number of real frequencies for B operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Real frequencies $\omega_B^R$ in the corresponding linear response function.
The first line after .BFREQ contains the number of frequencies
and the second line contains all frequency values (on one single line).
\item[\Key{IMBFREQ}] \verb| | \newline
\verb|<Number of imaginary frequencies for B operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Imaginary frequencies $\omega_B^I$ in the corresponding
linear response function.
The imaginary part of the complex polarizability describes a broadened one-photon
absorption spectrum.
If .IMBFREQ is not specified, only the real polarizability is calculated.
Input as for .BFREQ. 
\end{description}
For example, the following input is used 
to calculate complex polarizability tensors
for the frequencies $\omega_B = 0.1 + 0.05i$ and $\omega_B = 0.2$ 
(in a.u.):
\begin{description}
\item[\Keyinfo{**RESPONS}]
\item[\Keyinfo{*ALPHA}]
\item[\Keyinfo{.BFREQ}]
\item[\Keyinfo{2}]
\item[\Keyinfo{0.1   0.2}]
\item[\Keyinfo{.IMBFREQ}]
\item[\Keyinfo{2}]
\item[\Keyinfo{0.05   0.0}]
\end{description}


\subsection{*BETA}\label{subsec:beta}
Calculation of the (possibly complex) first electric dipole 
hyperpolarizability tensor $\beta_{ABC}$ and 
the corresponding averages $\beta_{\parallel}$ and
$\beta_{\perp}$. 
The first hyperpolarizability tensor equals minus the quadratic response function
$\langle\langle \mu_A; \mu_B, \mu_C \rangle\rangle_{\omega_B, \omega_C}$, where
the frequencies are in general allowed to be complex --
i.e. $\omega_B = \omega_B^R + i \omega_B^I$ and
$\omega_C = \omega_C^R + i \omega_C^I$.
The input is analogous to the *ALPHA input.
Unspecified frequencies are set to zero by default,
i.e. if no frequencies are specified, the static first hyperpolarizability is calculated. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_beta 
\begin{description}
\item[\Key{BFREQ}] \verb| | %\newline
\verb|<Number of real frequencies for B operator>|%\newline
\verb|<Freq1, freq2, ... , freqN>|%\newline
Real frequencies $\omega_B^R$ in the corresponding quadratic response function.
Input as for .BFREQ under *ALPHA.
\item[\Key{IMBFREQ}] \verb| | \newline
\verb|<Number of imaginary frequencies for B operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Imaginary frequencies $\omega_B^I$ in the corresponding quadratic response function.
Input as for .IMBFREQ under *ALPHA.
\item[\Key{CFREQ}] \verb| | \newline
\verb|<Number of real frequencies for C operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Real frequencies $\omega_C^R$ in the corresponding quadratic response function.
Input as for .BFREQ under *ALPHA.
\item[\Key{IMCFREQ}] \verb| | \newline
\verb|<Number of imaginary frequencies for C operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Imaginary frequencies $\omega_C^I$ in the corresponding quadratic response function.
Input as for .IMBFREQ under *ALPHA.
\end{description}

\subsection{*DAMPED\_TPA}\label{subsec:dtpa}
Damped two-photon absorption~\cite{dampedtpa} where both individual photons
have the same energy (= half the excitation energy).
\newline
{\bf Test case}: LSresponse/LSresponse\_HF\_dtpa 
\begin{description}
\item[\Key{OPFREQ}] \verb| | \newline
\verb|<Number of one-photon frequencies>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
The frequencies in the input are one-photon frequencies (=half the
excitation energy in case of resonance).
\item[\Key{GAMMA}] \verb| | \newline
\verb|<Damping parameter>|\newline
The damping parameter $\gamma$ is used in \emph{all} response equations,
i.e. $i \gamma$ is effectively added to all frequencies occurring in the response equations.
Default value: 0.005 a.u.
\end{description}

\subsection{*QUASIMCD}\label{subsec:quasimcd}
Calculation of the  $\mathcal{A}$ and $\mathcal{B}$ terms of magnetic circular dichroism (MCD), based on the method of Ref.~ \cite{KjaergaardMCD}, but reformulated using the formalism of Ref.~\cite{thorvaldsen:214108}. 
The calculation of Damped MCD spectra according to Ref.~\cite{KjaergaardDampedMCD} is also possible with this keyword.
\newline
{\bf Note that one or more of the 3 keywords \{ .DAMPEDXCOOR  , .MCDEXCIT, .DAMPEDRANGE \} must be specified}

If {\bf .MCDEXCIT} is specified, the default is to proceed in the following way: 
\begin{enumerate}
\item Determine the excited states requested under .MCDEXCIT 
\item Determine $\mathcal{B}$ terms for all allowed transitions. Both London atomic orbitals LAO (also called Gauge including atomic orbitals GIAO) and non-LAOs are used to determine the $\mathcal{B}$ terms. LAOs are superior to standards AOs, but the difference can give an indication of how close the result is to the basis set limit. 
\item Simulate the MCD spectrum based on the calculated $\mathcal{B}$ terms 
(sticks) by associating a Lorentzian lineshape function (with lineshape parameter of 0.005 a.u.) to each $\mathcal{B}$ term (See Ref. \cite{KjaergaardMCD}). 
The simulated spectrum is written to a file MCDspectraAU.dat (in atomic units). The first number is the frequency, the second the LAO ellipticity and the third is the non-LAO ellipticity. A corresponding file is generated called MCDspectra.dat using standard units ($cm^{-1}$ for frequencies and molar ellipticity for the ellipticity).
The individual $\mathcal{B}$ term contribution to the MCD spectra is written to the files BtermAU.dat and Bterm.dat. Per default 5000 points are used for the simulated spectrum. 
The standard units for the $\mathcal{B}$ term are given as $\frac{D^{2} \mu_{B}}{cm^{-1}}$, where $D$ is the unit Debye and $\mu_{B}$ is the Bohr magneton. The conversion factor between atomic units and the standard units is $5.88764 \dot 10^{-5}$.
The standard unit  for the $\mathcal{A}$ term is given as $D^{2} \mu_{B}$, with a conversion factor of $12.920947806163007$.

\item Perform damped calculations based on the standard MCD calculation. A number of points around each individual MCD peak (default value: 10) are determined for which to calculate the damped spectra. The result is printed to the files dampedMCDspectraRAU.dat (atomic units) and dampedMCDspectraR.dat.
\end{enumerate}
{\bf Test case}: LSresponse/LSresponse\_mcd\_calc, LSresponse/LSresponse\_mcd\newline
LSresponse/LSresponse\_mcd2, LSresponse/LSresponse\_mcd3  \newline
Note that only the LSresponse/LSresponse\_mcd\_calc test case is a good example for a general MCD calculation.

\begin{description}
\item[\Key{MCDEXCIT}] \verb| | \newline
\verb|<Number of excited states to consider>|\newline
The $\mathcal{B}$ terms will be calculated for all states, unless they are zero due to selection rules (dipole forbidden)
\item[\Key{MCDEXSTATES}] \verb| | \newline
\verb|<Number of specific excited states to consider in MCD calc>|\newline
\verb|<Specific excited states to consider>|\newline
This keyword only calculates the $\mathcal{B}$ and possible $\mathcal{A}$ terms for the selected excited states.
The first line after .MCDEXSTATES contains the number of specific excited states for which the MCD is to be calculated,
and the second line specifies such states (identified by their index in the .MCDNEXCIT list).
{\bf Important:} The position of the highest lying excited state
specified by .MCDEXSTATES must be smaller than or equal to
the total number of excited states specified by .MCDNEXCIT!
\item[\Key{DEGENERATE}] \verb| | \newline
This keyword must be set in input if the molecule has a degenerate state so that $\mathcal{A}$ terms are possible, otherwise all states are assumed non-degenerate and no $\mathcal{A}$ terms will be calculated. When this keyword is set, the $\mathcal{A}$ terms are calculated and a derivative Lorentzian lineshape function is used to simulate the individual $\mathcal{A}$ term contributions to the MCD spectrum (See Ref. \cite{KjaergaardMCD}). The individual $\mathcal{A}$ terms contributions to the MCD spectrum are written to the files AtermAU.dat and Aterm.dat   
\item[\Key{DAMPEDXCOOR}] \verb| | \newline
\verb|<Number of frequencies>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
The frequencies for which to calculate the damped MCD spectra (in atomic units).
\item[\Key{DAMPEDRANGE}] \verb| | \newline
\verb|<Freq1>|\newline
\verb|<FreqN>|\newline
\verb|<Number of frequencies in range between Freq1 and Freq2>|\newline
The frequencies for which to calculate the damped MCD spectra (in atomic units), here specified as an interval.
\item[\Key{NO LONDON}] \verb| | \newline
Deactivates the use of LAOs (i.e., only standard, non-LAO, basis is used)
\item[\Key{NO NOLONDON}] \verb| | \newline
Deactivates the use of non-LAOs (i.e., only LAO are used)
\item[\Key{NO SIMULATE}] \verb| | \newline
Deactivates the simulation of the MCD spectrum from the individual MCD terms
\item[\Key{NO ATERM}] \verb| | \newline
Deactivates the calculation of $\mathcal{A}$ terms
\item[\Key{NO BTERM}] \verb| | \newline
Deactivates the calculation of $\mathcal{B}$ terms
\item[\Key{NO DAMPED}] \verb| | \newline
Deactivates the execution of damped MCD spectra
\item[\Key{GAUSSIAN}] \verb| | \newline
Uses Gaussian lineshape functions (with a lineshape parameter of 0.0070851079363103793) 
instead of the default Lorentzian lineshape functions.
\item[\Key{LINESHAPEPARAM}] \verb| | \newline
\verb|<lineshape parameter>|\newline
Changes the lineshape parameter (default value is 0.005~a.u. for Lorentzian, 
and 0.0070851079363103793~a.u. for Gaussian) used to simulate the spectrum
\item[\Key{NSTEPS}] \verb| | \newline
\verb|<number of frequencies used for the simulated MCD spectra>|\newline
Changes the number of frequencies used for the simulation of the MCD spectra from the 
individual $\mathcal{A}$ and $\mathcal{B}$ terms' sticks 
(default 5000).
\item[\Key{NVECFORPEAK}] \verb| | \newline
\verb|<number of frequencies used around each MCD peak>|\newline
Changes the number of frequencies used around each MCD peak (default 10) in the damped response calculation.
\end{description}
Note that the keyword {\bf .DTHR} under {\bf *SOLVER} (see section \ref{subsec:responsesolver} ) can be used to define the threshold below which an excited state is considered degenerate

\subsection{*SHIELD}\label{nmrshield}
Nuclear magnetic shielding tensors and chemical shift can be calculated with this keyword
{\bf Test case}: LSresponse/LSresponse\_NMR\_SHIELD

\subsection*{ESDIPOLE}\label{subsec:esd}
Permanent dipole moment for excited states. 
{\bf Always requires specification of .NEXCIT!}\newline
If .EXSTATES is not specified, the excited state dipole moments
for all excited states from 1 to NEXCIT are calculated. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_esd
\begin{description}
\item[\Key{EXSTATES}] \verb| | \newline
\verb|<Number of specific excited states to consider>|\newline
\verb|<Specific excited states to consider>|\newline
Only calculate excited state gradient for selected excited states.
The first line after .EXSTATES contains the number
of excited states for which the 
%excited state gradient 
excited state dipole moment
is to be calculated,
and the second line specifies such states (identified by their 
index in the .NEXCIT list).
{\bf Important:} The position of the highest lying excited state
specified by .EXSTATES must be smaller than or equal to
the total number of excited states specified by .NEXCIT!
\end{description}

\subsection{*ESGRAD}\label{subsec:esg}
Calculation of the molecular gradient for excited states.
{\bf Always requires specification of .NEXCIT!}
If .EXSTATES is not specified, excited state gradients
for all excited states from 1 to NEXCIT
are calculated. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_esg 
\begin{description}
\item[\Key{EXSTATES}] \verb| | \newline
\verb|<Number of specific excited states to consider>|\newline
\verb|<Specific excited states to consider>|\newline
Input is identical to .EXSTATES under *ESDIPOLE.
\end{description}
For example, the following input is used 
to calculate excited state gradients for excited states number 3 and 6:
\begin{description}
\item[\Keyinfo{**RESPONS}]
\item[\Keyinfo{.NEXCIT}]
\item[\Keyinfo{6}]
\item[\Keyinfo{*ESGRAD}]
\item[\Keyinfo{.EXSTATES}]
\item[\Keyinfo{2}]
\item[\Keyinfo{3   6}]
\end{description}


\subsection{*GAMMA}\label{subsec:gamma}
Calculation of the (possibly complex)  second electric-dipole 
hyperpolarizability tensor $\gamma_{ABCD}$ and 
the corresponding averages $\gamma_{\parallel}$ and
$\gamma_{\perp}$. 
The second hyperpolarizability tensor equals minus the cubic response function
$\langle\langle \mu_A; \mu_B, \mu_C, \mu_D \rangle\rangle_{\omega_B, \omega_C, \omega_D}$, where
the frequencies are in general allowed to be complex --
i.e. $\omega_B = \omega_B^R + i \omega_B^I$,
$\omega_C = \omega_C^R + i \omega_C^I$, and
$\omega_D = \omega_D^R + i \omega_D^I$.
The input is analogous to those for *ALPHA and *BETA.
Unspecified frequencies are set to zero by default,
i.e. if no frequencies are specified the static second hyperpolarizability is calculated. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_gamma 
\begin{description}
\item[\Key{BFREQ}] \verb| | \newline
\verb|<Number of real frequencies for B operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Real frequencies $\omega_B^R$ in the corresponding cubic response function.
Input as for .BFREQ under *ALPHA.
\item[\Key{IMBFREQ}] \verb| | \newline
\verb|<Number of imaginary frequencies for B operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Imaginary frequencies $\omega_B^I$ in the corresponding cubic response function.
Input as for .BFREQ under *ALPHA.
\item[\Key{CFREQ}] \verb| | \newline
\verb|<Number of real frequencies for C operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Real frequencies $\omega_C^R$ in the corresponding cubic response function.
Input as for .BFREQ under *ALPHA.
\item[\Key{IMCFREQ}] \verb| | \newline
\verb|<Number of imaginary frequencies for C operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Imaginary frequencies $\omega_C^I$ in the corresponding cubic response function.
Input as for .IMBFREQ under *ALPHA.
\item[\Key{DFREQ}] \verb| | \newline
\verb|<Number of real frequencies for D operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Real frequencies $\omega_D^R$ in the corresponding cubic response function.
Input as for .BFREQ under *ALPHA.
\item[\Key{IMDFREQ}] \verb| | \newline
\verb|<Number of imaginary frequencies for D operator>|\newline
\verb|<Freq1, freq2, ... , freqN>|\newline
Imaginary frequencies $\omega_D^I$ in the corresponding cubic response function.
Input as for .IMBFREQ under *ALPHA.
\end{description}


\subsection{*MOLGRA}\label{subsec:molgra}
Single point calculation of the molecular gradient. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_molgra 

\subsection{*TPA}\label{subsec:tpa}
Two-photon absorption where both individual photons
have the same energy (= half the excitation energy).
{\bf Always requires specification of .NEXCIT!}
If .EXSTATES is not specified, two-photon absorption
for all excited states from 1 to NEXCIT
are calculated. \newline
{\bf Test case}: LSresponse/LSresponse\_HF\_tpa 
\begin{description}
\item[\Key{EXSTATES}] \verb| | \newline
\verb|<Number of specific excited states to consider>|\newline
\verb|<Specific excited states to consider>|\newline
Input is identical to .EXSTATES under *ESDIPOLE.
\end{description}


\section{**DEC and **CC}\label{sec:dec}
Correlated coupled-cluster (CC) calculations using the Divide-Expand-Consolidate (DEC) scheme~\cite{dec1,dec2,dec3,dec4,dec5,dec6}, where
local orbitals are used to carry out the correlated calculation on a large molecular system in terms of many small local calculations.
Formally, the computational time for the DEC scheme scales linearly with system size.
Currently only second-order M{\o}ller-Plesset (MP2) calculations (energy, density, and geometry optimization) are available using the DEC scheme. 
DEC calculations are invoked using the **DEC keyword.

Furthermore, conventional coupled-cluster energies for the MP2, CC2, and CCSD models are available using the **CC keyword. The computational time for these implementations scale with the system size to the fifth, fifth, and sixth power for MP2, CC2, and CCSD, respectively.

The **DEC and **CC implementations employ massive parallelism and will be highly effective only if many computing nodes are available.

\textbf{Special note}: It is mandatory that the memory available for the calculation is specified in the input, see \Key{MEMORY} keyword below.

The **DEC and **CC sections use local orbitals by default, although the orbitals are converted to the (semi-)canonical basis when the MP2
and CC equations are solved.
Below keywords for the **DEC section and **CC section and relevant test cases are given. 

\vspace{1 cm}
\noindent
\textbf{**DEC input keywords} (only MP2 model):

\begin{description}
\item[\Key{FOT}]\verb| | \newline
\verb|<FOT level>|\newline
Level for fragment optimization threshold (FOT). The FOT defines the precision of a DEC calculation compared
to a conventional calculation~\cite{dec1,dec2,dec3,dec4,dec5,dec6}.
The input is an integer which defines the negative power of the FOT; e.g. if FOT level=5, then the FOT=$10^{-5}$ a.u.
Thus, the higher the FOT, the smaller is the error of the DEC calculation compared to a conventional calculation (and of course, the more expensive is the calculation). Possible values: 1,2,3,4,5,6,7,8. Default value: 4.


\item[\Key{MEMORY}] \verb| | \newline
\verb|<Memory in gigabytes>| \newline
It is mandatory to specify the memory (in gigabytes) available for the calculation using this keyword! For an MPI run this is the memory available for each MPI process.
If this keyword is not set, the program will stop with a quit statement informing about an error in the LSDALTON.INP file.
(This keyword must also be used in **CC section).


\item[\Key{PAIRTHR}] \verb| | \newline
\verb|<Pair distance threshold (in a.u.)>|\newline
Pair distance threshold (in a.u.) beyond which pair fragments are omitted from the calculation. By default this value is adapted to the FOT.

\item[\Key{PAIRTHRANGSTROM}]  \verb| | \newline
\verb|<Pair distance threshold (in Angstrom)>|\newline
Pair distance threshold (in {\AA}) beyond which pair fragments are omitted from the calculation. By default this value is adapted to the FOT.


\item[\Key{RESTART}] \verb| | \newline
Restart unfinished DEC calculation. Requires that HF files \emph{dens.restart}, \emph{fock.restart}, \emph{lcm\_orbitals.u}, and \emph{overlapmatrix} are present in the folder where the calculation is restarted. Additionally, if .info files are present it means that some of the fragment calculations have been
carried out and the .RESTART keyword will read information about the finished fragment calculations from file and calculate the missing fragments.
Specifically, if the files atomicfragments.info and atomicfragmentsdone.info are present, it means that some (or all) of the atomic fragment calculations are finished. If, in addition, the file fragenergies.info (energy calculation) \emph{or} mp2grad.info (MP2 density or gradient calculation) is also present,
it means that some (or all) of the pair fragments are also done.

\textbf{Note 1: This keyword should NOT be combined with .RESTART in the *DENSOPT section.}

\textbf{Note 2: This keyword cannot be used for a DEC-MP2 geometry optimization. The only way to "restart" a DEC-MP2 geometry optimization is use the current geometry in a new DEC-MP2 geometry optimization -- i.e., copy the most recently generated MOLECULE.xxx file to MOLECULE.INP and run the calculation again using the same LSDALTON.INP.}


\item[\Key{NOTABSORBH}] \verb| | \newline
By default orbitals originally assigned to hydrogen atoms are reassigned to the nearest heavy atom. This reassigning can be turned off by invoking this keyword.

\item[\Key{FROZENCORE}]  \verb| | \newline
Use the frozen core approximation (can also be used in **CC section).


\item[\Key{DENSITY}] \verb| | \newline
Calculate DEC-MP2 density matrix~\cite{dec5} (stored in MP2.dens). The MP2 electric dipole moment is also calculated if this keyword is invoked.

\item[\Key{GRADIENT}] \verb| | \newline
Calculate MP2 molecular gradient~\cite{dec5} at input geometry (for geometry optimization, see test case examples below). The MP2 density and electric dipole moment is also calculated if this keyword is invoked.

\item[\Key{KAPPATHR}] \verb| | \newline
\verb|<THR>|\newline
Threshold for $\bar{kappa}$ multiplier equations solved when DEC-MP2 molecular gradient is calculation. Default value is 10$^{-4}$.


\item[\Key{CANONICAL}] \verb| | \newline
Use canonical orbitals. This is only recommended for advanced users for testing purposes. In general, the DEC scheme is only meaningful for local orbitals.

\item[\Key{MPIGROUPSIZE}] \verb| | \newline
\verb|<Size>|\newline
Size of local MPI groups (integer) in massively parallel DEC scheme~\cite{dec6}. The default settings should suffice for most purposes, and use of the keyword is only recommended for advanced users.


\end{description}

\vspace{1 cm}
\noindent
\textbf{Example test cases for **DEC calculations}: \newline
These test cases illustrate the main features of the DEC scheme. The test cases are located in LSDALTON/test/dectests.

\begin{itemize}
\item
\textit{decmp2\_energy}: Calculate DEC-MP2 energy.
\item
\textit{decmp2\_density}: Calculate DEC-MP2 density matrix and electric dipole moment.
\item
\textit{decmp2\_gradient}: Calculate DEC-MP2 molecular gradient.
\item
\textit{decmp2\_geoopt}: Carry out DEC-MP2 geometry optimization. Note that the geometry optimization is invoked by the **OPTIMIZE section, while the **DEC section specifies that the geometry optimization should use DEC-MP2 energies and molecular gradients. The DEC-MP2 geometry optimization will automatically estimate the intrinsic energy error of the DEC calculation. If this error is larger than the difference between two geometry, the FOT level will be increased to get a more accurate energy and gradient in the next iteration.
\end{itemize}


\vspace{1 cm}
\noindent
\textbf{**CC input keywords}:

\begin{description}

\item[\Key{MP2}]\verb| | \newline
Use MP2 model. This gives the canonical MP2 energy and is not optimized for parallel performance. It is only intended to be used for benchmarking DEC-MP2 calculations on relatively small molecular systems.

\item[\Key{CC2}]\verb| | \newline
Use CC2 model which is not an optimized code, but rather uses the CCSD optimized code with some contributions removed. See CCSD documentation for details.

\item[\Key{CCSD}]\verb| | \newline
Use CCSD model. The code employed is a massively parallel version and flexible with respect to memory. Due to the use of one-sided communication in these models it is recommended to run CCSD with an asynchronous progress engine switched on (how to do that can be found in the documentation of the respective MPI library you are using). When running a CCSD calculation make sure that at least one quantity of size $V^2O^2$ ($O$ = number of occupied orbitals, $V$ = number of virtual orbitals) fits into memory in double precision floating point numbers (with some additional space of course). Using this keyword automatically triggers checkpointing after each iteration. The calculation can be restarted with the usual \Key{.RESTART} keyword.

\item[\Key{FROZENCORE}]  \verb| | \newline
Use the frozen core approximation (can also be used in **DEC section).

\item[\Key{MEMORY}] \verb| | \newline
\verb|<Memory in gigabytes>| \newline
It is mandatory to specify the memory (in gigabytes) available for the calculation using this keyword! For an MPI run this is the memory available for each MPI process.
If this keyword is not set, the program will stop with a quit statement informing about an error in the LSDALTON.INP file.
(This keyword must also be used in **DEC section).

\item[\Key{CCMAXITER}]  \verb| | \newline
Maximum number of iterations in CC solver.

\item[\Key{CCTHR}]  \verb| | \newline
Convergence threshold for residual norm in CC solver.


\item[\Key{SUBSIZE}]  \verb| | \newline
Number of previous vectors to store in CROP scheme~\cite{crop} for CC solver.

\item[\Key{CCSDNOSAFE}]  \verb| | \newline
Prevent saving of CCSD amplitudes as checkpoint files. 


\end{description}


\vspace{1 cm}
\noindent
\textbf{Example test cases for **CC calculations}: \newline
The test cases are located in LSDALTON/test/dectests.

\begin{itemize}
\item
\textit{fullmp2\_energy}: Calculate conventional canonical MP2 energy.
\item
\textit{fullccsd\_high}: Calculate conventional canonical CCSD energy.
\end{itemize}





\section{**PLT}\label{sec:plt}
Generation of .plt files which may be used to visualize densities, orbitals, and electrostatic potentials by calculating these at specific points in space.
The .plt files can be visualized e.g. using the Chimera program~\cite{chimera}.

\textbf{Important note}: This section assumes that an LSDALTON calculation has already been carried out to generate files containing
density matrix elements or molecular orbital coefficients. The .plt files can then be generated by running a new calculation where the LSDALTON.INP file has been modified as exemplified below.

The density matrix from HF and DFT calculation are saved in a file \emph{dens.restart}, while the MP2 density is saved in the file \emph{MP2.dens} (if requested, see **DEC section).
The canonical MO coefficients are saved in the file \emph{cmo\_orbitals.u}, while localized molecular orbitals are saved in a file \emph{lcm\_orbitals.u} (if requested).
The definition of the grid points is described in the **PLTGRID section.

Note that it is also possible to generate .plt files for orbitals on the run as described in Section \ref{subsec:orbloc}.

\begin{description}
\item[\Key{INPUT}] \verb| | \newline
\verb|<Name of input file>| \newline
The name of the input file containing density matrix elements or orbital coefficients. Possible input files include \emph{dens.restart}, \emph{MP2.dens}, \emph{cmo\_orbitals.u}, and \emph{lcm\_orbitals.u}.

\item[\Key{OUTPUT}] \verb| | \newline
\verb|<Name of output file>| \newline
The name of the output plt-file where the calculated values at each grid point are saved. Examples are given below.

\item[\Key{DENS}]\verb| | \newline
Construct .plt file for electron density at grid points.
For example to calculate electron density from the file  \emph{dens.restart} and save information in file  dens.plt,
insert the following section in the LSDALTON.INP file used to generate the  \emph{dens.restart} file in the first place:
 \newline
**PLT \newline
.INPUT \newline
dens.restart \newline
.OUTPUT \newline
dens.plt \newline
.DENS \newline

\item[\Key{EP}]\verb| | \newline
Construct .plt file for electrostatic potential grid points based on input density matrix.
For example to calculate electrostatic potential from the density in the file  \emph{dens.restart} and save information in file  ep.plt,
insert the following section in the LSDALTON.INP file used to generate the  \emph{dens.restart} file in the first place:
 \newline
**PLT \newline
.INPUT \newline
dens.restart \newline
.OUTPUT \newline
ep.plt \newline
.EP \newline


\item[\Key{ORB}]\verb| | \newline
\verb|<Orbital index>|\newline
Construct .plt file for specific orbital at grid points. For example to calculate values of orbital number 8 at grid points from the file  \emph{lcm\_orbitals.u} and save information in file orb8.plt, insert the following section in the LSDALTON.INP file used to generate the  \emph{lcm\_orbitals.u} file in the first place: \newline
**PLT \newline
.INPUT \newline
lcm\_orbitals.u \newline
.OUTPUT \newline
orb8.plt \newline
.ORB \newline
8

\item[\Key{CHARGEDIST}]\verb| | \newline
\verb|<Orbital index 1     Orbital index 2>|\newline
Construct .plt file for charge distribution of two orbitals at grid points. 
For example to calculate charge distribution between orbitals 5 and 8 at grid points from the file  \emph{lcm\_orbitals.u} and save information in file cd\_5\_8.plt,
insert the following section in the LSDALTON.INP file used to generate the  \emph{lcm\_orbitals.u} file in the first place::
 \newline
**PLT \newline
.INPUT \newline
lcm\_orbitals.u \newline
.OUTPUT \newline
 cd\_5\_8.plt \newline
.CHARGEDIST \newline
5  8

\end{description}



\section{**PLTGRID}\label{sec:pltgrid}
Definition of 3-dimensinal grid used for generation of .plt files in **PLT section.
The default grid choice should suffice for most visualization purposes. This section is only for the advanced user who wishes to modify the default choice of grid.
This also modifies the grid used when .plt files for local orbitals are generated on the run, see Section \ref{subsec:orbloc}.

The grid box is defined in the following manner:
\begin{itemize}
\item
The first point in the grid box is (X1,Y1,Z1).                                                 
\item
The remaining grid points are then defined by going out in the X, Y, and Z directions with step sizes deltax, deltay, and deltaz, until there are nX, nY, and nZ points in the X,Y, and Z directions (giving a total number of gridpoints $nX\times nY \times nZ$).      
\end{itemize}

There are two options to define the grid box: (i) manual gridbox where X1, Y1, Z1, deltax, deltay, deltaz, nX, nY, nZ are defined explicitly in the input file; (ii)
molecule-specific gridbox where all atoms are contained within the grid box AND there is an additional buffer zone around the outermost atoms in the X, Y, and Z directions. Option (ii) thus requires that the deltax, deltay, deltaz, and buffer values are defined by the input, which implicitly defines X1, Y1, Z1, nX, nY, and nZ based on the molecular structure.

The default gridbox uses option (ii) with {deltax=deltay=deltaz=0.3 a.u.} and {buffer=6.0 a.u}. 
User-defined grid box based on options (i) and (ii) use the following inputs:


\begin{description}
\item[\Key{MANUAL}] \verb| | \newline
\verb|<X1   Y1   Z1>| \newline
\verb|<deltax    deltay    deltaz>| \newline
\verb|<nX    nY    nZ>| \newline
Manual definition of gridbox as described above. All input values are in a.u.

\item[\Key{MOLECULE}] \verb| | \newline
\verb|<buffer>| \newline
\verb|<deltax    deltay    deltaz>| \newline
Molecule-specific definition of gridbox as described above. All input values are in a.u.

\end{description}

