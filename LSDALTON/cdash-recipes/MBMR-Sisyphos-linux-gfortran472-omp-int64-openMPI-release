TMP_DIR=/home/sisyphos/NightlyTesting/tmp/DaltonGfortranReleaseOPENMPI64MBMR
SCRATCH_DIR=/tmp/sisyphos/DaltonGfortranReleaseOPENMPI64MBMR
rm -rf $TMP_DIR
rm -rf $SCRATCH_DIR

git clone git@repo.ctcc.no:dalton.git $TMP_DIR
cd $TMP_DIR
export OMP_NUM_THREADS=2
source 
export MATH_ROOT=/opt/intel/mkl
export DALTON_TMPDIR=$SCRATCH_DIR
export DALTON_NUM_MPI_PROCS=6
export CTEST_PROJECT_NAME=LSDALTON
module load mpi/openmpi-$(uname -i)
#the module load do not seem to work when called from a crontab script, so instead we do
export PATH=/usr/lib64/openmpi/bin:$PATH
export LD_LIBRARY_PATH=/usr/lib64/openmpi/lib:$LD_LIBRARY_PATH


./setup --fc=mpif90 --cc=mpicc --cxx=mpic++ --omp --mpi --timing --int64 -D BUILDNAME="MBMR-Sisyphos-linux-gfortran472-omp-int64-openMPI-release" build

cd build
make release
#this creates a tar file named DALTON-2013.2-Source.tar.gz
tar -zxvf DALTON-2013.2-Source.tar.gz
cd DALTON-2013.2-Source

./setup --fc=mpif90 --cc=mpicc --cxx=mpic++ --omp --mpi --timing --int64 -D BUILDNAME="MBMR-Sisyphos-linux-gfortran472-omp-int64-openMPI-release" build

cd build
ctest -D Nightly -L linsca
exit 0
