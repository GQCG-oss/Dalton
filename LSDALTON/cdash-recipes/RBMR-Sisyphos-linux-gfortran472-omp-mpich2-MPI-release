TMP_DIR=/home/sisyphos/NightlyTesting/tmp/DaltonGfortranReleasempich2MPIRBMR
SCRATCH_DIR=/tmp/sisyphos/DaltonGfortranReleasempich2MPIRBMR
rm -rf $TMP_DIR
rm -rf $SCRATCH_DIR

git clone --recursive git@gitlab.com:dalton/dalton.git $TMP_DIR
cd $TMP_DIR
git checkout Dalton2015
export OMP_NUM_THREADS=2
export MATH_ROOT=/lib64/ATLAS
export DALTON_TMPDIR=$SCRATCH_DIR
export DALTON_NUM_MPI_PROCS=3
export CTEST_PROJECT_NAME=LSDALTON
module load mpi/mpich-$(uname -i)
#The module load command does not seem to work when called using a crontab script. 
#So instead we do
echo $PATH
which mpif90 
echo "this should not be openmpi version"
export PATH=/usr/lib64/mpich/bin:$PATH
export LD_LIBRARY_PATH=/usr/lib64/mpich/lib:$LD_LIBRARY_PATH

./setup --fc=mpif90 --cc=mpicc --cxx=mpic++ --omp --mpi --timing -DENABLE_DEC=ON -D BUILDNAME="RB-Sisyphos-linux-gfortran472-omp-mpich2-MPI-release" build

cd build
make release
#this creates a tar file named DALTON-Source.tar.gz
if [[ -e  DALTON-Source.tar.gz ]]; then
 tar -zxvf DALTON-Source.tar.gz
 cd DALTON-Source
./setup --fc=mpif90 --cc=mpicc --cxx=mpic++ --omp --mpi --timing -DENABLE_DEC=ON -D BUILDNAME="RBMR-Sisyphos-linux-gfortran472-omp-mpich2-MPI-release" build
cd build
ctest --track ReleaseBranch2015MakeRelease -D Nightly -L linsca
fi
exit 0
