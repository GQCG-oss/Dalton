#!/bin/bash
TMP_DIR=/home/tkjaer/NightlyTestingCdash/tmp/DaltonIfortRelease64
SCRATCH_DIR=/tmp/tkjaer/DaltonIfortRelease64
rm -rf $TMP_DIR 
rm -rf $SCRATCH_DIR
. /etc/bashrc
source /com/gfortran/4.4.3/bin/gfortranvars.sh
source /home/com/intel/composer_xe_2011_sp1.8.273/bin/compilervars.sh intel64
source /home/com/intel/composer_xe_2011_sp1.8.273/mkl/bin/mklvars.sh intel64
source /com/OpenMPI/1.4.1/intel/bin/openmpi.sh
mkl=/home/com/intel/composer_xe_2011_sp1.8.273/mkl/lib/intel64
openmpi=/com/OpenMPI/1.4.1/intel/lib
intel=/home/com/intel/composer_xe_2011_sp1.8.273/compiler/lib/intel64
export LD_LIBRARY_PATH=${mkl}:${openmpi}:${intel}:$LD_LIBRARY_PATH
export OMP_NUM_THREADS=2
export PATH=/com/OpenMPI/1.4.1/intel/bin:$PATH
export MATH_ROOT=/home/com/intel/composer_xe_2011_sp1.8.273/mkl
source /com/open64/5.0-0/load.sh
export PATH=/usr/local/torque/bin:/usr/lib64/qt-3.3/bin:/com/pgi/linux86-64/12.4/bin:/home/com/intel/composer_xe_2011_sp1.8.273/bin/intel64:/home/tkjaer/bin:/com/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/com/intel/composer_xe_2011_sp1.8.273/mpirt/bin/intel64:/home/tkjaer/bin:$PATH
export LD_LIBRARY_PATH=/home/com/intel/composer_xe_2011_sp1.8.273/compiler/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/ipp/../compiler/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/ipp/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/compiler/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/mkl/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/tbb/lib/intel64//cc4.1.0_libc2.4_kernel2.6.16.21:/home/com/intel/composer_xe_2011_sp1.8.273/debugger/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/mpirt/lib/intel64:$LS_LIBRARY_PATH

git clone git@repo.ctcc.no:dalton.git $TMP_DIR
cd $TMP_DIR
#git checkout linsca-develop
#git checkout Dalton2013_release
git log --pretty=format:"%an" --since=1.day > /home/tkjaer/NightlyTestingCdash/SINNERS
export OMP_NUM_THREADS=3
source /home/com/intel/composer_xe_2011_sp1.11.339/bin/ifortvars.sh intel64
source /home/com/intel/composer_xe_2011_sp1.11.339/bin/compilervars.sh intel64
cd $TMP_DIR
export MATH_ROOT=/home/com/intel/composer_xe_2011_sp1.11.339/mkl
export DALTON_TMPDIR=$SCRATCH_DIR
export DALTON_NUM_MPI_PROCS=1
export CTEST_PROJECT_NAME=LSDALTON

./setup --fc=ifort --cc=icc --int64 --blas=none --lapack=none --explicit-libs="-Llib -L$MATH_ROOT/lib/intel64 -lmkl_solver_ilp64 -Wl,--start-group -lmkl_intel_ilp64 -lmkl_intel_thread -lmkl_core -Wl,--end-group -openmp -lpthread" --omp -D BUILDNAME="MB-Grendel-linux-ifort12.1.5-omp64int-release"
#cp /home/tkjaer/NightlyTestingCdash/git_revision_info.f90 $TMP_DIR/lsutil/.
#cp /home/tkjaer/NightlyTestingCdash/compilation_info.f90 $TMP_DIR/lsutil/.
cd $TMP_DIR/build
#make depend
#make Nightly
#make Experimental
ctest -D Nightly -L linsca

exit 0

