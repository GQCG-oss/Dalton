#!/bin/bash
export PATH=/com/OpenMPI/1.4.4/intel/bin:/com/intel/Compiler/11.1/064/bin/intel64:/usr/local/torque/bin:/home/com/intel/composer_xe_2011_sp1.8.273/bin/intel64:/com/bin:/usr/local/bin:/bin:/usr/bin:/home/com/intel/composer_xe_2011_sp1.8.273/mpirt/bin/intel64
export LD_LIBRARY_PATH=/com/intel/Compiler/11.1/064/mkl/lib/em64t:/com/intel/Compiler/11.1/064/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/compiler/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/ipp/../compiler/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/ipp/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/compiler/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/mkl/lib/intel64:/home/com/intel/composer_xe_2011_sp1.8.273/tbb/lib/intel64//cc4.1.0_libc2.4_kernel2.6.16.21:/home/com/intel/composer_xe_2011_sp1.8.273/mpirt/lib/intel64:/com/OpenMPI/1.4.1/intel/lib
source /com/OpenMPI/1.4.1/intel/bin/openmpi.sh
source /com/intel/Compiler/11.1/064/mkl/tools/environment/mklvarsem64t.sh
source /com/intel/Compiler/11.1/064/bin/intel64/ifortvars_intel64.sh
mkdir $TMP_DIR/build
TMP_DIR=/home/tkjaer/NightlyTestingCdash/tmp/DaltonReleaseompMPI
SCRATCH_DIR=/scratch/tkjaer/DaltonReleaseompMPI
rm -rf $TMP_DIR
rm -rf $SCRATCH_DIR
rm -rf /home/tkjaer/NightlyTestingCdash/tmp/tmp5
git clone git@repo.ctcc.no:dalton.git $TMP_DIR
cd $TMP_DIR
git checkout linsca-develop
export OMP_NUM_THREADS=3
export MATH_ROOT=/com/intel/Compiler/11.1/064/mkl
cd $TMP_DIR/build
FC=mpif90 CC=mpicc cmake -DENABLE_MPI=1 -DSCRATCH_DIR=$SCRATCH_DIR -DCMAKE_BUILD_TYPE=Release -DBUILDNAME=Grendel-linux-ifort-openMPI-release $TMP_DIR
make depend
make Nightly
rm -rf $TMP_DIR 
rm -rf $SCRATCH_DIR
mv $TMP_DIR /home/tkjaer/NightlyTestingCdash/tmp/tmp5

exit 0

