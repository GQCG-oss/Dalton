#!/bin/bash
TMP_DIR=/home/tkjaer/NightlyTestingCdash/tmp/DaltonReleaseomp64MPI23
SCRATCH_DIR=/tmp/tkjaer/DaltonReleaseomp64MPI32
mv $TMP_DIR /home/tkjaer/NightlyTestingCdash/tmp/tmp7
rm -rf $SCRATCH_DIR
rm -rf /home/tkjaer/NightlyTestingCdash/tmp/tmp7

export PATH=/usr/local/torque/bin:/com/bin:/usr/local/bin:/bin:/usr/bin
export LD_LIBRARY_PATH=/com/OpenMPI/1.4.5/intel/lib:/com/intel/composer_xe_2013.1.117/mkl/lib/intel64:/com/intel/composer_xe_2013.1.117/compiler/lib/intel64
source /com/OpenMPI/1.4.5/intel/load.sh
#source /com/OpenMPI/1.4.5/intel/bin/openmpi.sh
ompi_info -a | grep 'Fort integer size'
# this should give
#  Fort integer size: 4
source /com/intel/composer_xe_2013.1.117/bin/ifortvars.sh intel64
source /com/intel/composer_xe_2013.1.117/bin/compilervars.sh intel64
source /com/intel/composer_xe_2013.1.117/mkl/bin/mklvars.sh intel64
source /com/OpenMPI/1.4.5/intel/load.sh


git clone git@gitlab.com:dalton/dalton.git $TMP_DIR
cd $TMP_DIR
#git checkout linsca-develop
#git checkout Dalton2013_release
git log --pretty=format:"%an" --since=1.day > /home/tkjaer/NightlyTestingCdash/SINNERS
export OMP_NUM_THREADS=3
export MATH_ROOT=/com/intel/composer_xe_2013.1.117/mkl
export DALTON_TMPDIR=$SCRATCH_DIR
export DALTON_NUM_MPI_PROCS=5
export CTEST_PROJECT_NAME=LSDALTON
./setup --fc=mpif90 --cc=mpicc --cxx=mpic++ --mpi --int64 --omp --timings -D MPIEXEC=/com/OpenMPI/1.4.5/intel/bin/mpirun -D BUILDNAME="MB-Grendel-linux-MPI-32bit-64bitlsdalton"
cd $TMP_DIR/build
#make Nightly
#make Experimental
ctest -D Nightly -L linsca
exit 0

