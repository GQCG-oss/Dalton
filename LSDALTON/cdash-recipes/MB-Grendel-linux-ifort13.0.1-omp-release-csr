#!/bin/bash
TMP_DIR=/home/tkjaer/NightlyTestingCdash/tmp/DaltonIfortReleaseCSR
SCRATCH_DIR=/tmp/tkjaer/DaltonIfortReleaseCSR
rm -rf $TMP_DIR 
rm -rf $SCRATCH_DIR
export PATH=/home/com/intel/composer_xe_2013.1.117/bin/intel64:/home/com/intel/composer_xe_2013.1.117/mpirt/bin/intel64:/home/com/intel/composer_xe_2013.1.117/bin/intel64:/home/com/intel/composer_xe_2013.1.117/bin/intel64_mic:/home/com/intel/composer_xe_2013.1.117/debugger/gui/intel64:/com/OpenMPI/1.4.1/intel/bin:/com/gfortran/4.4.3/bin:/usr/local/torque/bin:/com/pgi/linux86-64/12.4/bin:/com/bin:/usr/local/bin:/bin:/usr/bin:/home/tkjaer/bin

export LD_LIBRARY_PATH=/home/com/intel/composer_xe_2013.1.117/compiler/lib/intel64:/opt/intel/mic/coi/host-linux-release/lib:/opt/intel/mic/myo/lib:/home/com/intel/composer_xe_2013.1.117/mpirt/lib/intel64:/home/com/intel/composer_xe_2013.1.117/ipp/../compiler/lib/intel64:/home/com/intel/composer_xe_2013.1.117/ipp/lib/intel64:/home/com/intel/composer_xe_2013.1.117/compiler/lib/intel64:/home/com/intel/composer_xe_2013.1.117/mkl/lib/intel64:/home/com/intel/composer_xe_2013.1.117/tbb/lib/intel64:/com/OpenMPI/1.4.1/intel/lib:/com/OpenMPI/1.4.1/intel/lib:/com/gfortran/4.4.3/lib64:/com/gfortran/4.4.3/lib
git clone git@repo.ctcc.no:dalton.git $TMP_DIR
cd $TMP_DIR
#git checkout linsca-develop
#git checkout Dalton2013_release
git log --pretty=format:"%an" --since=1.day > /home/tkjaer/NightlyTestingCdash/SINNERS
export OMP_NUM_THREADS=3
source /home/com/intel/composer_xe_2013.1.117/bin/ifortvars.sh intel64
source /home/com/intel/composer_xe_2013.1.117/mkl/bin/mklvars.sh intel64
export MATH_ROOT=/home/com/intel/composer_xe_2013.1.117/mkl
cd $TMP_DIR
export DALTON_TMPDIR=$SCRATCH_DIR
export DALTON_NUM_MPI_PROCS=1
export CTEST_PROJECT_NAME=LSDALTON
./setup --fc=ifort --cc=icc --csr --omp --lapack=none --blas=none --explicit-libs="-L$MATH_ROOT/lib/intel64/libmkl_solver_lp64.a -Wl,--start-group  $MATH_ROOT/lib/intel64/libmkl_intel_lp64.a $MATH_ROOT/lib/intel64/libmkl_intel_thread.a $MATH_ROOT/lib/intel64/libmkl_core.a -Wl,--end-group -openmp -lpthread" -D BUILDNAME="MB-Grendel-linux-ifort13.0.1-omp-release-csr"
#--scratch=$SCRATCH_DIR 
cd $TMP_DIR/build
#cd $TMP_DIR/build
#make clean
#make depend
#make Nightly
#make Experimental
ctest -D Nightly -L linsca
exit 0

