#!/bin/bash
TMP_DIR=/home/tkjaer/NightlyTestingCdash/tmp/MBGrendelintel15SCALAPACKOMP64release
SCRATCH_DIR=/tmp/tkjaer/MBGrendelintel15SCALAPACKOMP64release
rm -rf $TMP_DIR
rm -rf $SCRATCH_DIR
mv $TMP_DIR /home/tkjaer/NightlyTestingCdash/tmp/tmp3
rm -rf /home/tkjaer/NightlyTestingCdash/tmp/tmp3
#due to launch with crontab PATH is empty. We need PATH to git and cmake etc.
export PATH=/usr/local/torque/bin:/com/bin:/usr/local/bin:/bin:/usr/bin

git clone --recursive git@gitlab.com:dalton/dalton.git $TMP_DIR
cd $TMP_DIR
source /com/OpenMPI/1.8.4/intel/load.sh
export MATH_ROOT=$MKLROOT #/home/com/intel/composer_xe_2011_sp1.8.273/mkl
cd $TMP_DIR
export DALTON_TMPDIR=$SCRATCH_DIR
export OMP_NUM_THREADS=3
export DALTON_NUM_MPI_PROCS=3
export CTEST_PROJECT_NAME=LSDALTON
./setup --fc=mpif90 --cc=mpicc --cxx=mpic++ --mpi --omp --scalapack --blacs=openmpi --timings -DENABLE_DEC=ON -DENABLE_TENSORS=ON -D BUILDNAME="MB-Grendel-intel12.1.2-SCALAPACK-OMP64-release"
cd $TMP_DIR/build
ctest -D Nightly -L linsca

exit 0

