#!/bin/sh
info='
   dft_b3lyp_molhes_nosym 
   ----------------------
   Molecule:         LiOH
   Wave Function:    DFT (B3LYP) / 6-31G** 
   Test Purpose:     Test analytical molecular hessian and dipole
                     gradient with spherical basis functions  
                     
'

molecule='BASIS
6-31G**
LiOH
B3LYP/6-31G** 
    3   0
        3.    1
Li  .0000000000             .0000000000           -2.1946269792
        8.    1
O   .0000000000             .0000000000             .7986363667
        1.    1
H   .0000000000             .0000000000            2.6039702557
'

dalton='**DALTON INPUT
.RUN WAVE FUNCTION
.PROPERTIES
**WAVE FUNCTIONS
.DFT
 B3LYP
*DFT INPUT
! EHT guess goes through very bad densities, do not let it stop you.
.DFTELS
5e-3
.GRID TYPE
BECKE GC2
.RADINT
2e-7
**PROPERTIES
.MOLGRA
.MOLHES
.DIPGRA
.VIBANA
**END OF DALTON INPUT
'

test='
check_scf_energy DFT -83.328715459994 4e-10

check_mol_gradient 1 "Li    " 0 0 -0.0000169506 7e-8
check_mol_gradient 1 "O     " 0 0  0.0000469217 7e-8
check_mol_gradient 1 "H     " 0 0 -0.0000004800 9e-8

check_mol_hessian 9 1e-5 "
           Li   x      Li   y      Li   z      O    x      O    y      O    z

 Li   x    0.000811
 Li   y    0.000001    0.000811
 Li   z    0.000000    0.000000    0.193753

 O    x   -0.002148   -0.000002    0.000000    0.005709
 O    y   -0.000002   -0.002148    0.000000    0.000005    0.005709
 O    z    0.000000    0.000000   -0.193556    0.000001    0.000001    0.765702

 H    x    0.001336    0.000001    0.000000   -0.003551   -0.000003   -0.000001
 H    y    0.000001    0.001336    0.000000   -0.000003   -0.003551   -0.000001
 H    z    0.000000    0.000000   -0.000197   -0.000001   -0.000001   -0.572146


           H    x      H    y      H    z

 H    x    0.002215
 H    y    0.000002    0.002215
 H    z    0.000000    0.000000    0.572343"


check_dip_gradient 3 2e-5 "
        Li   x     0.64485917     0.00000050     0.00000430
        Li   y     0.00000050     0.64485917     0.00000430
        Li   z     0.00000005     0.00000005     0.69483010

        O    x    -0.91605176    -0.00000132    -0.00001142
        O    y    -0.00000132    -0.91605175    -0.00001142
        O    z    -0.00000019    -0.00000019    -0.81730138

        H    x     0.27119258     0.00000083     0.00000712
        H    y     0.00000083     0.27119258     0.00000712
        H    z     0.00000013     0.00000013     0.12247127"

check_rotational_const 35507.25 1.184394
check_vibr_freqs 4e-1 "
   1      A      3996.45    0.018209     28.484   0.6741
   2      A      1014.69    0.004623     93.818   2.2203
   3      A       265.57    0.001210    140.258   3.3193
   4      A       265.57    0.001210    140.258   3.3193"
'

. ./functions || { echo "'functions' library not found." ; exit 1; }
check_gen_input "$0" "$info" "$molecule" "$dalton" "$test"
