
#######################################################################
#  TEST DESCRIPTION
#######################################################################
cat > hfreqfromg.info <<%EOF%
   hfreqfromg
   ----------
   Molecule:         H2O
   Wave Function:    SCF / cc-pVDZ
   Test Purpose:     Harmonic frequencies calculated numerically from
                     gradients
%EOF%

#######################################################################
#  MOLECULE INPUT
#######################################################################
cat > hfreqfromg.mol <<%EOF%
BASIS                                 
STO-3G
NH3

    2    0
        7.    1
N          0.0000019235            0.0000000101            0.8537220513
        1.    3
H         -1.7773989973           -0.0000000217            0.0487589947
H          0.8886985392            1.5392766387            0.0487594789
H          0.8886985114           -1.5392766339            0.0487594750
%EOF%

#######################################################################
#  DALTON INPUT
#######################################################################
cat > hfreqfromg.dal <<%EOF%
**DALTON INPUT
.NMDDRV
**NMDDRV
.DORDR
  1  1
.SYMMETRY
  C3v
.NORMAL COORDINATES
**WAVE FUNCTIONS
.HF
*HF INP
.THRESH
 1.0D-12
**PROPERTIES
.SPIN-SPIN
*TRPRSP
*END OF INPUT
%EOF%
#######################################################################



#######################################################################

#######################################################################
#  CHECK SCRIPT
#######################################################################
echo '#!/bin/ksh
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

# Starting geometry and energy
CRIT1=`$GREP "bond distance\: * H * N * 1\.032522" $log | wc -l`
CRIT2=`$GREP "bond angle\: * H * N * H * 104\.164" $log | wc -l`
CRIT3=`$GREP "Final * HF energy\: * \-55\.455419779253" $log | wc -l`
CRIT4=`$GREP "Nuclear repulsion\: * 11\.737180794400" $log | wc -l`
CRIT5=`$GREP "Electronic energy\: * \-67\.192600573652" $log | wc -l`
TEST[1]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5`
CTRL[1]=46
ERROR[1]="STARTING GEOMETRY/ENERGY NOT CORRECT"

# Symmetry input.
CRIT1=`$GREP "1\. irep\:" $log | wc -l`
CRIT2=`$GREP "1\.00 * 1\.00 * 1\.00 * 1\.00 * 1\.00 * 1\.00" $log | wc -l`
CRIT3=`$GREP "2\. irep\:" $log | wc -l`
CRIT4=`$GREP "1\.00 * 1\.00 * 1\.00 \-1\.00 \-1\.00 \-1\.00" $log | wc -l`
CRIT5=`$GREP "3\. irep\:" $log | wc -l`
CRIT6=`$GREP "1\.00 (\-0| \-)\.50 (\-0| \-)\.50 * 1\.00 (\-0| \-)\.50 (\-0| \-)\.50" $log | wc -l`
CRIT7=`$GREP "(0| )\.00 * (0| )\.87 (\-0| \-)\.87 * (0| )\.00 * (0| )\.87 (\-0| \-)\.87" $log | wc -l`
CRIT8=`$GREP "(0| )\.00 (\-0| \-)\.87 * (0| )\.87 * (0| )\.00 * (0| )\.87 (\-0| \-)\.87" $log | wc -l`
CRIT9=`$GREP "1\.00 (\-0| \-)\.50 (\-0| \-)\.50 \-1\.00 * (0| )\.50 * (0| )\.50" $log | wc -l`
TEST[2]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9`
CTRL[2]=12
ERROR[2]="SYMMETRY INPUT NOT CORRECT"

# Hessian
CRIT1=`$GREP "1 * (0| )\.336[0-9][0-9][0-9]" $log | wc -l`
CRIT2=`$GREP "1 * (0| )\.251[0-9][0-9][0-9] * (0| )\.500[0-9][0-9][0-9]" $log | wc -l`
CRIT3=`$GREP "1 * (\-0| \-)\.194[0-9][0-9][0-9] * (\-0| \-)\.144[0-9][0-9][0-9] * (0| )\.112[0-9][0-9][0-9]" $log | wc -l`
CRIT4=`$GREP "2 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9]" $log | wc -l`
CRIT5=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.840[0-9][0-9][0-9]" $log | wc -l`
CRIT6=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (\-0| \-)\.485[0-9][0-9][0-9] * (0| )\.280[0-9][0-9][0-9]" $log | wc -l`
CRIT7=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.317[0-9][0-9][0-9] * (\-0| \-)\.183[0-9][0-9][0-9]" $log | wc -l`
CRIT8=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.310[0-9][0-9][0-9] * (\-0| \-)\.179[0-9][0-9][0-9]" $log | wc -l`
CRIT9=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (\-0| \-)\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9]" $log | wc -l`
CRIT10=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9]" $log | wc -l`
CRIT11=`$GREP "3 * (0| )\.352[0-9][0-9][0-9]" $log | wc -l`
CRIT12=`$GREP "3 * (0| )\.117[0-9][0-9][0-9] * (0| )\.114[0-9][0-9][0-9]" $log | wc -l`
CRIT13=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.840[0-9][0-9][0-9]" $log | wc -l`
CRIT14=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (\-0| \-)\.485[0-9][0-9][0-9] * (0| )\.280[0-9][0-9][0-9]" $log | wc -l`
CRIT15=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.317[0-9][0-9][0-9] * (\-0| \-)\.183[0-9][0-9][0-9] * (0| )\.352[0-9][0-9][0-9]" $log | wc -l`
CRIT16=`$GREP "3 * (0| )\.000[0-9][0-9][0-9] * (0| )\.000[0-9][0-9][0-9] * (0| )\.310[0-9][0-9][0-9] * (\-0| \-)\.179[0-9][0-9][0-9] * (0| )\.117[0-9][0-9][0-9] * (0| )\.114[0-9][0-9][0-9]" $log | wc -l`
TEST[3]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16`
CTRL[3]=18
ERROR[3]="HESSIAN NOT CORRECT"

# Frequencies and normal coordinates.
CRIT1=`$GREP "1 * 3833\.[0-9][0-9] * (0| )\.0174[0-9][0-9]" $log | wc -l`
CRIT2=`$GREP "1 * 1411\.[0-9][0-9] * (0| )\.0064[0-9][0-9]" $log | wc -l`
CRIT3=`$GREP "3 * 2076\.[0-9][0-9] * (0| )\.0094[0-9][0-9]" $log | wc -l`
CRIT4=`$GREP "3 * 4108\.[0-9][0-9] * (0| )\.0187[0-9][0-9]" $log | wc -l`
CRIT5=`$GREP "(0| )\.0000[0-9][0-9][0-9] * (0| )\.0000[0-9][0-9][0-9] * (\-0| \-)\.0627[0-9][0-9][0-9] * (0| )\.0792[0-9][0-9][0-9] * (\-0| \-)\.0001[0-9][0-9][0-9] * (0| )\.0002[0-9][0-9][0-9]" $log | wc -l`
CRIT6=`$GREP "(0| )\.0000[0-9][0-9][0-9] * (0| )\.0000[0-9][0-9][0-9] * (0| )\.0001[0-9][0-9][0-9] * (\-0| \-)\.0002[0-9][0-9][0-9] * (\-0| \-)\.0627[0-9][0-9][0-9] * (0| )\.0792[0-9][0-9][0-9]" $log | wc -l`
CRIT7=`$GREP "(0| )\.0402[0-9][0-9][0-9] * (\-0| \-)\.1143[0-9][0-9][0-9] * (\-0| \-)\.0000[0-9][0-9][0-9] * (0| )\.0000[0-9][0-9][0-9] * (0| )\.0000[0-9][0-9][0-9] * (0| )\.0000[0-9][0-9][0-9]" $log | wc -l`
CRIT8=`$GREP "(\-0| \-)\.5458[0-9][0-9][0-9] * (\-0| \-)\.2201[0-9][0-9][0-9] * (\-0| \-)\.1707[0-9][0-9][0-9] * (\-0| \-)\.7428[0-9][0-9][0-9] * (\-0| \-)\.0005[0-9][0-9][0-9] * (\-0| \-)\.0022[0-9][0-9][0-9]" $log | wc -l`
CRIT9=`$GREP "(0| )\.0000[0-9][0-9][0-9] * (0| )\.0000[0-9][0-9][0-9] * (\-0| \-)\.0023[0-9][0-9][0-9] * (\-0| \-)\.0000[0-9][0-9][0-9] * (0| )\.7520[0-9][0-9][0-9] * (0| )\.0088[0-9][0-9][0-9]" $log | wc -l`
CRIT10=`$GREP "(\-0| \-)\.1865[0-9][0-9][0-9] * (0| )\.5296[0-9][0-9][0-9] * (0| )\.2632[0-9][0-9][0-9] * (\-0| \-)\.3324[0-9][0-9][0-9] * (0| )\.0008[0-9][0-9][0-9] * (\-0| \-)\.0010[0-9][0-9][0-9]" $log | wc -l`
CRIT11=`$GREP "(0| )\.2729[0-9][0-9][0-9] * (0| )\.1100[0-9][0-9][0-9] * (0| )\.5225[0-9][0-9][0-9] * (\-0| \-)\.1780[0-9][0-9][0-9] * (\-0| \-)\.3979[0-9][0-9][0-9] * (\-0| \-)\.3260[0-9][0-9][0-9]" $log | wc -l`
CRIT12=`$GREP "(0| )\.4727[0-9][0-9][0-9] * (0| )\.1906[0-9][0-9][0-9] * (\-0| \-)\.3997[0-9][0-9][0-9] * (\-0| \-)\.3238[0-9][0-9][0-9] * (0| )\.0586[0-9][0-9][0-9] * (\-0| \-)\.5559[0-9][0-9][0-9]" $log | wc -l`
CRIT13=`$GREP "(\-0| \-)\.1865[0-9][0-9][0-9] * (0| )\.5296[0-9][0-9][0-9] * (\-0| \-)\.1309[0-9][0-9][0-9] * (0| )\.1653[0-9][0-9][0-9] * (\-0| \-)\.2283[0-9][0-9][0-9] * (0| )\.2884[0-9][0-9][0-9]" $log | wc -l`
CRIT14=`$GREP "(0| )\.2729[0-9][0-9][0-9] * (0| )\.1100[0-9][0-9][0-9] * (0| )\.5201[0-9][0-9][0-9] * (\-0| \-)\.1800[0-9][0-9][0-9] * (0| )\.4012[0-9][0-9][0-9] * (0| )\.3249[0-9][0-9][0-9]" $log | wc -l`
CRIT15=`$GREP "(\-0| \-)\.4727[0-9][0-9][0-9] * (\-0| \-)\.1906[0-9][0-9][0-9] * (0| )\.3994[0-9][0-9][0-9] * (0| )\.3272[0-9][0-9][0-9] * (0| )\.0611[0-9][0-9][0-9] * (\-0| \-)\.5539[0-9][0-9][0-9]" $log | wc -l`
CRIT16=`$GREP "(\-0| \-)\.1865[0-9][0-9][0-9] * (0| )\.5296[0-9][0-9][0-9] * (\-0| \-)\.1323[0-9][0-9][0-9] * (0| )\.1671[0-9][0-9][0-9] * (0| )\.2275[0-9][0-9][0-9] * (\-0| \-)\.2873[0-9][0-9][0-9]" $log | wc -l`
CRIT17=`$GREP "Number of gradient calculations done\: * 25" $log | wc -l`
TEST[4]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16 \+ $CRIT17`
CTRL[4]=19
ERROR[4]="FREQUENCIES AND NORMAL COORDINATES NOT CORRECT"

PASSED=1
for i in 1 2 3 4 
do
   if [ ${TEST[i]} -ne ${CTRL[i]} ]; then
     echo ${ERROR[i]}
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi

' > hfreqfromg.check
#######################################################################
