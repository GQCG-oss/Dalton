#!/bin/sh
#
# This is the script for generating files for a specific Dalton test job.
#
# For the .check file ksh or bash is preferred, otherwise use sh
# (and hope it is not the old Bourne shell, which will not work)
#
if [ -x /bin/ksh ]; then
   CHECK_SHELL='#!/bin/ksh'
elif [ -x /bin/bash ]; then
   CHECK_SHELL='#!/bin/bash'
else
   CHECK_SHELL='#!/bin/sh'
fi


#######################################################################
#  TEST DESCRIPTION
#######################################################################
cat > dft_lda_molhes_nosym.info <<'%EOF%'
   dft_lda_molhes 
   -------------
   Molecule:         Ethane
   Wave Function:    DFT (LDA) / STO-3G 
   Test Purpose:     Test analytical molecular hessian and dipole
                     gradient 
                     
%EOF%

#######################################################################
#  MOLECULE INPUT
#######################################################################
cat > dft_lda_molhes_nosym.mol <<'%EOF%'
BASIS
STO-3G
LDA molecular hessian without symmetry
Ethane 
    2   0
        6.    2
C      1.4496747688     -0.0000010117     0.0000000000
C     -1.4496747688      0.0000010117     0.0000000000
        1.    6
H      2.1888645654     -0.9728762646     1.6850699397
H      2.1888645654     -0.9728762646    -1.6850699397
H     -2.1888645654      0.9728762646     1.6850699397
H     -2.1888645654      0.9728762646    -1.6850699397
H      2.1888617992      1.9457507963     0.0000000000
H     -2.1888617992     -1.9457507963     0.0000000000
%EOF%

#######################################################################
#  DALTON INPUT
#######################################################################
cat > dft_lda_molhes_nosym.dal <<'%EOF%'
**DALTON INPUT
.RUN WAVE FUNCTION
.PROPERTIES
**WAVE FUNCTIONS
.DFT
 LDA
**PROPERTIES
.MOLGRA
.MOLHES
.DIPGRA
.VIBANA
*END OF INPUT
%EOF%
#######################################################################

 

#######################################################################

#######################################################################
#  CHECK SCRIPT
#######################################################################
echo $CHECK_SHELL >dft_lda_molhes_nosym.check
cat >>dft_lda_molhes_nosym.check <<'%EOF%'
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

# Basis set
CRIT1=`$GREP "C * 1 * 6 * 15 * 5 * \[6s3p\|2s1p\]" $log | wc -l`
CRIT2=`$GREP "H * 1 * 1 * 3 * 1 * \[3s\|1s\]" $log | wc -l`
CRIT3=`$GREP "total\: * 3 * 16 * 81 * 42" $log | wc -l`
TEST[1]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3`
CTRL[1]=8
ERROR[1]="BASIS SET NOT READ CORRECTLY"

# GEOMETRY 
CRIT1=`$GREP "Total number of coordinates\: * 24" $log | wc -l`
CRIT2=`$GREP "1 * C * x * 1\.4496747688" $log | wc -l`
CRIT3=`$GREP "2 * y * (\-0|\-)\.0000010117" $log | wc -l`
CRIT4=`$GREP "3 * z * (0| )\.0000000000" $log | wc -l`
CRIT5=`$GREP "4 * C * x * \-1|\.4496747688" $log | wc -l`
CRIT6=`$GREP "5 * y * (0| )\.0000010117" $log | wc -l`
CRIT7=`$GREP "6 * z * (0| )\.0000000000" $log | wc -l`
CRIT8=`$GREP "7 * H * x * 2\.1888645654" $log | wc -l`
CRIT9=`$GREP "8 * y * (\-0|\-)\.9728762646" $log | wc -l`
CRIT10=`$GREP "9 * z * 1\.6850699397" $log | wc -l`
CRIT11=`$GREP "10 * H * x * 2\.1888645654" $log | wc -l`
CRIT12=`$GREP "11 * y * (\-0|\-)\.9728762646" $log | wc -l`
CRIT13=`$GREP "12 * z * \-1\.6850699397" $log | wc -l`
CRIT14=`$GREP "13 * H * x * \-2\.1888645654" $log | wc -l`
CRIT15=`$GREP "14 * y * (0| )\.9728762646" $log | wc -l`
CRIT16=`$GREP "15 * z * 1\.6850699397" $log | wc -l`
CRIT17=`$GREP "16 * H * x * \-2\.1888645654" $log | wc -l`
CRIT18=`$GREP "17 * y * (0| )\.9728762646" $log | wc -l`
CRIT19=`$GREP "18 * z * \-1\.6850699397" $log | wc -l`
CRIT20=`$GREP "19 * H * x * 2\.1888617992" $log | wc -l`
CRIT21=`$GREP "20 * y * 1\.9457507963" $log | wc -l`
CRIT22=`$GREP "21 * z * (0| )\.0000000000" $log | wc -l`
CRIT23=`$GREP "22 * H * x * \-2\.1888617992" $log | wc -l`
CRIT24=`$GREP "23 * y * \-1\.9457507963" $log | wc -l`
CRIT25=`$GREP "24 * z * (0| )\.0000000000" $log | wc -l`
TEST[2]=`expr   $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ \
                $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ \
                $CRIT11 \+ $CRIT12 \+ $CRIT13 \+ $CRIT14 \+ $CRIT15 \+ \
                $CRIT16 \+ $CRIT17 \+ $CRIT18 \+ $CRIT19 \+ $CRIT20 \+ \
                $CRIT21 \+ $CRIT22 \+ $CRIT23 \+ $CRIT24 \+ $CRIT25`
CTRL[2]=28
ERROR[2]="GEOMETRY NOT READ CORRECTLY"

# Energy: gcc gives 58225 while ifort gives 58165
CRIT1=`$GREP "Final * DFT energy\: * \-78\.089379258[12][0-9]" $log | wc -l`
TEST[3]=`expr   $CRIT1`
CTRL[3]=1
ERROR[3]="DFT ENERGY NOT CORRECT"

# Gradient
CRIT1=`$GREP "C *  (\-0|\-)\.00001842[0-1][0-9] * (0| )\.000003919[0-9] * (0| |\-0|\-)\.0000000000" $log | wc -l`
CRIT2=`$GREP "C *  (0| )\.00001842[0-1][0-9] * (\-0|\-)\.000003919[0-9] * (0| |\-0|\-).0000000000" $log | wc -l`
CRIT3=`$GREP "H * (0| )\.00000068[8-9][0-9] * (\-0|\-)\.000000817[0-9] * (0| )\.000001880[0-9]" $log | wc -l`
CRIT4=`$GREP "H * (0| )\.00000068[8-9][0-9] * (\-0|\-)\.000000817[0-9] * (\-0|\-)\.000001880[0-9]" $log | wc -l`
CRIT5=`$GREP "H * (\-0|\-)\.00000068[8-9][0-9] * (0| )\.000000817[0-9] * (0| )\.000001880[0-9]" $log | wc -l`
CRIT6=`$GREP "H * (\-0|\-)\.00000068[8-9][0-9] * (0| )\.000000817[0-9] * (\-0|\-)\.000001880[0-9]" $log | wc -l`
CRIT7=`$GREP "H * (0| )\.000000472[0-9] * (0| )\.00000211[1-2][0-9] * (0| )\.0000000000" $log | wc -l`
CRIT8=`$GREP "H * (\-0|\-)\.000000472[0-9] * (\-0|\-)\.00000211[1-2][0-9] * (0| |\-0|\-)\.0000000000" $log | wc -l`
TEST[4]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ \
                $CRIT6 \+ $CRIT7 \+ $CRIT8`
CTRL[4]=8
ERROR[4]="MOLECULAR GRADIENT NOT CORRECT"

# Hessian
CRIT1=`$GREP "C * x * (0| )\.5859[4-5][0-9]" $log | wc -l`
CRIT2=`$GREP "C * y * (0| |\-0|\-)\.00000(0|1) * (0| )\.7119[0-1][0-9]" $log | wc -l`
CRIT3=`$GREP "C * z * (0| |\-0|\-)\.000000 * (\-0|\-)\.00000[0-9] * (0| )\.71190[0-9]" $log | wc -l`
CRIT4=`$GREP "C * x * (\-0|\-)\.2593[3-4][0-9] * (0| )\.00000[0-9] * (0| )\.000000 * (0| )\.58594[0-9]" $log | wc -l`
CRIT5=`$GREP "C * y * (0| |\-)\.00000[0-9] * (\-0|\-)\.0959[6-7][0-9] * (0| |\-0|\-)\.00000(0|1) * (\-0| |\-)\.00000[0-9] * (0| )\.7119[0-1][0-9]" $log | wc -l`
CRIT6=`$GREP "C * z * (0| |\-0|\-)\.00000[0-9] * (0| )\.00000[0-9] * (\-0|\-)\.09596[0-9] * (0| )\.00000[0-9] * (\-0| |\-)\.00000[0-9] * (0| )\.7119(0|1)[0-9]" $log | wc -l`
CRIT7=`$GREP "H * x * (\-0|\-)\.09434[0-9] * (0| )\.05375[0-9] * (\-0|\-)\.09310[0-9] * (\-0|\-)\.01452[0-9] * (0| )\.01872[0-9] * (\-0|\-)\.0324[2-3][0-9]" $log | wc -l`
CRIT8=`$GREP "H * y * (0| )\.0526[7-8][0-9] * (\-0|\-)\.13485[0-9] * (0| )\.1256[5-6][0-9] * (\-0|\-)\.00159[0-9] * (0| )\.0005[2-3][0-9] * (\-0|\-)\.00270[0-9]" $log | wc -l`
CRIT9=`$GREP "H * z * (\-0|\-)\.09124[0-9] * (0| )\.1256[5-6][0-9] * (\-0|\-)\.27995[0-9] * (0| )\.00276[0-9] * (\-0|\-)\.00270[0-9] * (0| )\.0036[4-5][0-9]" $log | wc -l`
CRIT10=`$GREP "H * x * (\-0|\-)\.09434[0-9] * (0| )\.05375[0-9] * (0| )\.09310[0-9] * (\-0|\-)\.01452[0-9] * (0| )\.01872[0-9] * (0| )\.0324[2-3][0-9]" $log | wc -l`
CRIT11=`$GREP "H * y * (0| )\.0526[7-8][0-9] * (\-0|\-)\.13485[0-9] * (\-0|\-)\.1256[5-6][0-9] * (\-0|\-)\.00159[0-9] * (0| )\.0005[2-3][0-9] * (0| )\.00270[0-9]" $log | wc -l`
CRIT12=`$GREP "H * z * (0| )\.09124[0-9] * (\-0|\-)\.1256[5-6][0-9] * (\-0|\-)\.27995[0-9] * (\-0|\-)\.00276[0-9] * (0| )\.00270[0-9] * (0| )\.0036[4-5][0-9]" $log | wc -l`
CRIT13=`$GREP "H * x * (\-0|\-)\.0145(2|3)[0-9] * (0| )\.0187(2|3)[0-9] * (0| )\.0324[2-3][0-9] * (\-0|\-)\.09434[0-9] * (0| )\.05375[0-9] * (0| )\.09310[0-9]" $log | wc -l`
CRIT14=`$GREP "H * y * (\-0|\-)\.00159[0-9] * (0| )\.0005[2-3][0-9] * (0| )\.00270[0-9] * (0| )\.0526[7-8][0-9] * (\-0|\-)\.13485[0-9] * (\-0|\-)\.1256[5-6][0-9]" $log | wc -l`
CRIT15=`$GREP "H * z * (\-0|\-)\.0027(5|6)[0-9] * (0| )\.00270[0-9] * (0| )\.0036[4-5][0-9] * (0| )\.09124[0-9] * (\-0|\-)\.1256[5-6][0-9] * (\-0|\-)\.2799(5|6)[0-9]" $log | wc -l`
CRIT16=`$GREP "H * x * (\-0|\-)\.01452[0-9] * (0| )\.01872[0-9] * (\-0|\-)\.03242[0-9] * (\-0|\-)\.09434[0-9] * (0| )\.05375[0-9] * (\-0|\-)\.09310[0-9]" $log | wc -l`
CRIT17=`$GREP "H * y * (\-0|\-)\.00159[0-9] * (0| )\.0005[2-3][0-9] * (\-0|\-)\.00270[0-9] * (0| )\.0526[7-8][0-9] * (\-0|\-)\.13485[0-9] * (0| )\.1256[5-6][0-9]" $log | wc -l`
CRIT18=`$GREP "H * z * (0| )\.00276[0-9] * (\-0|\-)\.00270[0-9] * (0| )\.0036[4-5][0-9] * (\-0|\-)\.09124[0-9] * (0| )\.1256[5-6][0-9] * (\-0|\-)\.27995[0-9]" $log | wc -l`
CRIT19=`$GREP "H * x * (\-0|\-)\.0943[3-4][0-9] * (\-0|\-)\.10750[0-9] * (0| )\.000000 * (\-0|\-)\.01452[0-9] * (\-0|\-)\.03744[0-9] * (0| )\.000000" $log | wc -l`
CRIT20=`$GREP "H * y * (\-0|\-)\.10536[0-9] * (\-0|\-)\.35250[0-9] * (0| )\.000000 * (0| )\.00319[0-9] * (0| )\.00521[0-9] * (0| |\-0|\-)\.000000" $log | wc -l`
CRIT21=`$GREP "H * z * (0| |\-0|\-)\.000000 * (0| )\.00000[0-9] * (\-0|\-)\.06230[0-9] * (0| )\.000000 * (0| |\-0|\-)\.000000 * (\-0|\-)\.00103[0-9]" $log | wc -l`
CRIT22=`$GREP "H * x * (\-0|\-)\.01452[0-9] * (\-0|\-)\.03744[0-9] * (0| )\.000000 * (\-0|\-)\.09434[0-9] * (\-0|\-)\.10750[0-9] * (0| )\.000000" $log | wc -l`
CRIT23=`$GREP "H * y * (0| )\.00319[0-9] * (0| )\.00521[0-9] * (0| )\.000000 * (\-0|\-)\.10536[0-9] * (\-0|\-)\.35250[0-9] * (0| )\.000000" $log | wc -l`
CRIT24=`$GREP "H * z * (0| |\-0|\-)\.000000 * (\-0|\-)\.00000[0-9] * (\-0|\-)\.00103[0-9] * (0| |\-0|\-)\.000000 * (0| )\.000000 * (\-0|\-)\.06230[0-9]" $log | wc -l`
CRIT25=`$GREP "H * x * (0| )\.101[8-9][9,0][0-9]" $log | wc -l`
CRIT26=`$GREP "H * y * (\-0|\-)\.0568[6-7][0-9] * (0| )\.13401[0-9]" $log | wc -l`
CRIT27=`$GREP "H * z * (0| )\.098[4-5][0-9][0-9] * (\-0|\-)\.1344[0-1][0-9] * (0| )\.28921[0-9]" $log | wc -l`
CRIT28=`$GREP "H * x * (0| )\.0044[6-7][0-9] * (\-0|\-)\.00774[0-9] * (\-0|\-)\.01232[0-9] * (0| )\.101[8-9][9,0][0-9]" $log | wc -l`
CRIT29=`$GREP "H * y * (\-0|\-)\.00774[0-9] * (0| )\.0094[5-6][0-9] * (0| )\.018[1-2][9,0][0-9] * (\-0|\-)\.0568[6-7][0-9] * (0| )\.13401[0-9]" $log | wc -l`
CRIT30=`$GREP "H * z * (0| )\.01232[0-9] * (\-0|\-)\.018[1-2][9,0][0-9] * (\-0|\-)\.01777[0-9] * (\-0|\-)\.098[4-5][9,0][0-9] * (0| )\.1344[0-1][0-9] * (0| )\.28921[0-9]" $log | wc -l`
TEST[5]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ \
                $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ \
                $CRIT11 \+ $CRIT12 \+ $CRIT13 \+ $CRIT14 \+ $CRIT15 \+ \
                $CRIT16 \+ $CRIT17 \+ $CRIT18 \+ $CRIT19 \+ $CRIT20 \+ \
                $CRIT21 \+ $CRIT22 \+ $CRIT23 \+ $CRIT24 \+ $CRIT25 \+ \
                $CRIT26 \+ $CRIT27 \+ $CRIT28 \+ $CRIT29 \+ $CRIT30`
CTRL[5]=33
ERROR[5]="HESSIAN NOT CORRECT"

# Rotational constants
CRIT1=`$GREP "78832\.248[0-9] * 19863\.803[0-9] * 19863\.80[2-3][0-9] MHz" $log | wc -l`
CRIT2=`$GREP "2\.6295[5-6][0-9] * (0| )\.66258[0-9] * (0| )\.66258[0-9] cm\-1" $log | wc -l`
TEST[6]=`expr	$CRIT1 \+ $CRIT2`
CTRL[6]=4
ERROR[6]="ROTATIONAL CONSTANTS NOT CORRECT"

# Vibrational frequencies
CRIT1=`$GREP "1 * A * 3466\.4[0-9] * (0| )\.01579[0-9]" $log | wc -l`
CRIT2=`$GREP "2 * A * 3466\.4[0-9] * (0| )\.01579[0-9]" $log | wc -l`
CRIT3=`$GREP "3 * A * 3449\.(2[5-9]|3[0-5]) * (0| )\.01571[0-9]" $log | wc -l`
CRIT4=`$GREP "4 * A * 3449\.(2[5-9]|3[0-5]) * (0| )\.01571[0-9]" $log | wc -l`
CRIT5=`$GREP "5 * A * 3295\.0[0-9] * (0| )\.01501[0-9]" $log | wc -l`
CRIT6=`$GREP "6 * A * 3287\.[0-1][0-9] * (0| )\.01497[0-9]" $log | wc -l`
CRIT7=`$GREP "7 * A * 1661\.0[0-9] * (0| )\.00756[0-9]" $log | wc -l`
CRIT8=`$GREP "8 * A * 1661\.0[0-9] * (0| )\.00756[0-9]" $log | wc -l`
CRIT9=`$GREP "9 * A * 1645\.6[0-9] * (0| )\.00749[0-9]" $log | wc -l`
CRIT10=`$GREP "10 * A * 1645\.6[0-9] * (0| )\.00749[0-9]" $log | wc -l`
CRIT11=`$GREP "11 * A * 1548\.[0-1][0-9] * (0| )\.00705[0-9]" $log | wc -l`
CRIT12=`$GREP "12 * A * 1529\.7[0-9] * (0| )\.0069[6-7][0-9]" $log | wc -l`
CRIT13=`$GREP "13 * A * 1306\.3[0-9] * (0| )\.00595[0-9]" $log | wc -l`
CRIT14=`$GREP "14 * A * 1306\.3[0-9] * (0| )\.00595[0-9]" $log | wc -l`
CRIT15=`$GREP "15 * A * 1105\.4[0-9] * (0| )\.00503[0-9]" $log | wc -l`
CRIT16=`$GREP "16 * A * 886\.3[0-9] * (0| )\.00403[0-9]" $log | wc -l`
CRIT17=`$GREP "17 * A * 886\.3[0-9] * (0| )\.00403[0-9]" $log | wc -l`
CRIT18=`$GREP "18 * A * 307\.[8-9][0-9] * (0| )\.00140[0-9]" $log | wc -l`
TEST[7]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ \
                $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ \
                $CRIT11 \+ $CRIT12 \+ $CRIT13 \+ $CRIT14 \+ $CRIT15 \+ \
                $CRIT16 \+ $CRIT17 \+ $CRIT18`
CTRL[7]=18
ERROR[7]="VIBRATIONAL FREQUENCIES NOT CORRECT"

PASSED=1
for i in 1 2 3 4 5 6 7
do
   if [ ${TEST[i]} -ne ${CTRL[i]} ]; then
     echo ${ERROR[i]}
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi

%EOF%
#######################################################################
