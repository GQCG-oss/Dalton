#!/bin/sh
info='
   dft_lda_molhes 
   -------------
   Molecule:         Ethane
   Wave Function:    DFT (LDA) / STO-3G 
   Test Purpose:     Test analytical molecular hessian and dipole
                     gradient 
'
molecule='BASIS
STO-3G
LDA molecular hessian without symmetry
Ethane 
    2   0
        6.    2
C1      1.4496747688     -0.0000010117     0.0000000000
C2     -1.4496747688      0.0000010117     0.0000000000
        1.    6
H1      2.1888645654     -0.9728762646     1.6850699397
H2      2.1888645654     -0.9728762646    -1.6850699397
H3     -2.1888645654      0.9728762646     1.6850699397
H4     -2.1888645654      0.9728762646    -1.6850699397
H5      2.1888617992      1.9457507963     0.0000000000
H6     -2.1888617992     -1.9457507963     0.0000000000
'

dalton='**DALTON INPUT
.RUN WAVE FUNCTION
.PROPERTIES
**WAVE FUNCTIONS
.DFT
 LDA
**PROPERTIES
.MOLGRA
.MOLHES
.DIPGRA
.VIBANA
**END OF DALTON INPUT
'

test='
check_scf_energy DFT -78.089384320563 1e-10

check_mol_gradient 1 "C1    " -0.0000141557 -0.0000002230  0.0 7e-8
check_mol_gradient 1 "C2    "  0.0000141557  0.0000002230  0.0000000000 7e-8
check_mol_gradient 1 "H1    "  0.0000007949 -0.0000011619  0.0000018232 7e-8
check_mol_gradient 1 "H2    "  0.0000007949 -0.0000011619 -0.0000018232 7e-8
check_mol_gradient 1 "H3    " -0.0000007949  0.0000011619  0.0000018232 7e-8
check_mol_gradient 1 "H4    " -0.0000007949  0.0000011619 -0.0000018232 7e-8
check_mol_gradient 1 "H5    "  0.0000008315  0.0000020051  0.0000000000 7e-8
check_mol_gradient 1 "H6    " -0.0000008315 -0.0000020051  0.0000000000 7e-8

check_mol_hessian 9 1e-5 "
           C1   x      C1   y      C1   z      C2   x      C2   y      C2   z

 C1   x    0.585939
 C1   y    0.000000    0.711910
 C1   z    0.000000    0.000001    0.711908

 C2   x   -0.259337    0.000000    0.000000    0.585940
 C2   y    0.000000   -0.095969    0.000000    0.000000    0.711909
 C2   z    0.000000   -0.000001   -0.095969    0.000000    0.000000    0.711908

 H1   x   -0.094342    0.053754   -0.093104   -0.014526    0.018723   -0.032429
 H1   y    0.052681   -0.134854    0.125660   -0.001597    0.000529   -0.002703
 H1   z   -0.091246    0.125660   -0.279953    0.002766   -0.002704    0.003651

 H2   x   -0.094342    0.053753    0.093104   -0.014526    0.018723    0.032429
 H2   y    0.052681   -0.134853   -0.125660   -0.001597    0.000529    0.002704
 H2   z    0.091246   -0.125660   -0.279953   -0.002766    0.002704    0.003651

 H3   x   -0.014526    0.018723    0.032429   -0.094342    0.053753    0.093104
 H3   y   -0.001597    0.000529    0.002704    0.052681   -0.134853   -0.125660
 H3   z   -0.002766    0.002704    0.003651    0.091246   -0.125660   -0.279953

 H4   x   -0.014526    0.018723   -0.032429   -0.094342    0.053753   -0.093104
 H4   y   -0.001597    0.000529   -0.002704    0.052681   -0.134853    0.125660
 H4   z    0.002766   -0.002704    0.003651   -0.091246    0.125660   -0.279953

 H5   x   -0.094341   -0.107507    0.000000   -0.014526   -0.037446    0.000000
 H5   y   -0.105362   -0.352503    0.000000    0.003194    0.005212    0.000000
 H5   z    0.000000    0.000000   -0.062303    0.000000    0.000000   -0.001032

 H6   x   -0.014525   -0.037446    0.000000   -0.094342   -0.107507    0.000000
 H6   y    0.003194    0.005212    0.000000   -0.105362   -0.352504    0.000000
 H6   z    0.000000    0.000000   -0.001032    0.000000    0.000000   -0.062303
"

check_vibr_freqs 1e-5 "
   1      A      3466.45    0.015794      0.649   0.0154
   2      A      3466.45    0.015794      0.649   0.0154
   3      A      3449.30    0.015716      0.000   0.0000
   4      A      3449.30    0.015716      0.000   0.0000
   5      A      3295.05    0.015013      3.494   0.0827
   6      A      3287.11    0.014977      0.000   0.0000
   7      A      1661.04    0.007568     11.526   0.2728
   8      A      1661.03    0.007568     11.526   0.2728
   9      A      1645.66    0.007498      0.000   0.0000
  10      A      1645.66    0.007498      0.000   0.0000
  11      A      1548.10    0.007054      0.000   0.0000
  12      A      1529.77    0.006970      5.115   0.1210
  13      A      1306.37    0.005952      0.000   0.0000
  14      A      1306.37    0.005952      0.000   0.0000
  15      A      1105.45    0.005037      0.000   0.0000
  16      A       886.37    0.004039     12.270   0.2904
  17      A       886.37    0.004039     12.269   0.2904
  18      A       307.91    0.001403      0.000   0.0000
"
'

. ./functions || { echo "'functions' library not found." ; exit 1; }
check_gen_input "$0" "$info" "$molecule" "$dalton" "$test"
