#!/bin/sh
#
# This is the script for generating files for a specific Dalton test job.
#
# For the .check file ksh or bash is preferred, otherwise use sh
# (and hope it is not the old Bourne shell, which will not work)
#
if [ -x /bin/ksh ]; then
   CHECK_SHELL='#!/bin/ksh'
elif [ -x /bin/bash ]; then
   CHECK_SHELL='#!/bin/bash'
else
   CHECK_SHELL='#!/bin/sh'
fi


#######################################################################
#  TEST DESCRIPTION
#######################################################################
cat > rsp_esr2.info <<'%EOF%'
   rsp_esr2
   --------
   Molecule:         BeOH
   Wave Function:    MCSCF (CAS)
   Test Purpose:     ESR properties
%EOF%

#######################################################################
#  MOLECULE INPUT
#######################################################################
cat > rsp_esr2.mol <<'%EOF%'
INTGRL
ESR parameters for BeOH

   3    1  Z         1.00D-15
       4.    1    4    1    1    1    1
Be     0.00000    0.00000   0.00000
   14    4
22628.599 .00005331 -.0000102 .00001238 -.0000163 .00002035
3372.3181 .00041812 -.0000804 .00009764 -.0001087 .00013929
760.35040 .00222604 -.0004281 .00051672 -.0007272 .00089927
211.74048 .00956276 -.0018487 .00225262 -.0023214 .00303917
67.223468 .03481791 -.0068008 .00822815 -.0124024 .01555533
23.372177 .10594611 -.0213719 .02644133 -.0250911 .03697737
8.7213730 .24566318 -.0530352 .06578965 -.1164622 .15845461
3.4680910 .38607362 -.1004577 .13010642 -.0631167 .08359833
1.4521440 .31037318 -.1375139 .19754924 -.6700337 .95775189
.60861500 .06389402 -.0650704 .07492653 1.2263580 -3.527723
.25768600 -.0015314 .32457317 -1.388722 1.0746878 3.7533891
.10417600 .00118247 .61816433 .15458295 -2.962455 -1.194024
.04242700 -.0002521 .20476749 1.0260181 1.5600035 -1.247780
.01484900 .00007381 .00430350 .02577768 .28184411 1.3591094
    9    3
33.710184 .00103783 -.0012142 .00258725 -.0022873
8.0576495 .00660868 -.0056126 .02089535 -.0516249
2.8364714 .02155898 -.0254797 .05737162 -.0217907
1.0999657 .06087782 -.0114415 .26426850 -1.011218
.44339640 .20355732 -.5138507 1.0647600 .73527735
.18222640 .45796695 -.4908092 -1.436307 .91566937
.07572410 .36859063 .72214518 -.0547326 -1.931695
.03168540 .06306415 .43076218 .77703464 1.1633019
.01108990 .00210971 .00225563 -.0320504 .20468349
    4    2
1.4000000 .00667733 -.0103868 .18372869 -1.379488
.49000000 .24681337 .89258071 .84246998 1.3773530
.17150000 .65744628 -.1507099 -1.494497 -.8809108
.06002500 .25351913 -.6812165 1.1174804 .39975521
    3    1
.50000000 .32812970 -1.103944 .76590034
.20000000 .65980420 .65022981 -1.491275
.08000000 .16284725 .35201447 1.3276033
       8.    1    4    1    1    1    1
O      2.58783    0.0000    0.000
   14    4
105374.95 .00004590 -.0000105 .00000896 -.0000109 .00001811 -.0000224 .00002623
15679.240 .00036065 -.0000825 .00007048 -.0000822 .00012131 -.0001947 .00053679
3534.5447 .00191977 -.0004412 .00037567 -.0004675 .00080932 -.0008912 .00034041
987.36516 .00820666 -.0018864 .00161462 -.0018465 .00257695 -.0046992 .01582333
315.97875 .02972570 -.0069540 .00593400 -.0075585 .01377944 -.0138134 -.0046794
111.65428 .09045579 -.0217208 .01878662 -.0210868 .02811115 -.0628944 .27278165
42.699451 .21740537 -.0568513 .04946829 -.0667511 .13747540 -.1285556 -.1473296
17.395596 .36876567 -.1139635 .10303987 -.1093673 .12206903 -.4617198 2.6786762
7.4383090 .33727977 -.1620201 .16205865 -.2731431 .73734928 -.4946086 -6.726794
3.2228620 .09675046 -.0333800 .00093665 .20971367 -1.705751 3.7909700 7.2541671
1.2538770 .00256736 .36550685 -.8224251 1.2034807 -.3504060 -5.906611 -5.232285
.49515500 .00137461 .55200311 -.1017902 -.6774694 3.1429946 5.4974482 3.2451096
.19166500 -.0001410 .22363927 .42539393 -1.429884 -3.347481 -3.298510 -1.534112
.06708300 .00006829 .00657453 .68770275 1.4891068 1.4012375 1.0457181 .42569636
    9    3
200.00000 .00089331 -.0008384 .00126180 -.0019528 .00307588 -.0095326 .02825071
46.533367 .00736901 -.0068491 .01116281 -.0243404 .03750571 -.0076271 -.0122603
14.621809 .03493921 -.0328505 .05183165 -.0944754 .18584407 -.5723415 1.6957347
5.3130640 .11529855 -.1100060 .19788446 -.5489856 1.0270651 -.2947287 -2.997962
2.1025250 .25832314 -.3135263 .57076519 -.3495476 -1.567541 1.9952689 3.1191936
.85022300 .36962312 -.3196011 -.1789291 1.4659089 .38159176 -3.068932 -2.489170
.33759700 .32387894 .22172426 -.8982077 -.7571894 1.1466648 3.0398273 1.6589021
.12889200 .14679893 .56226160 .26666430 -.5905673 -1.662704 -2.143406 -.9028050
.04511200 .03361269 .30132513 .62589942 .79593212 .97284427 .90601969 .32262057
    4    2
3.7500000 .12849338 -.2182055 .62420931 -1.217839
1.3125000 .52118843 -.4817695 .24030630 1.7038152
.45937500 .43457843 .13575954 -1.183642 -1.362414
.16078100 .14574094 .82977340 .92087218 .61572759
    3    1
2.3500000 .36341106 -.8835406 1.0001262
.94000000 .56215546 .22624078 -1.647676
.37600000 .26352789 .67223250 1.1796696
       1.    1    3    1    1    1
H      4.36047 -.01504    0.000
    8    3
188.61445 .00096385 -.0013119 .00242240 -.0115701 .01478099
28.276596 .00749196 -.0103451 .02033817 -.0837154 .09403187
6.4248300 .03759541 -.0504953 .08963935 -.4451663 .53618016
1.8150410 .14339498 -.2073855 .44229071 -1.146271 -.6089639
.59106300 .34863630 -.4350885 .57571439 2.5031871 -1.114889
.21214900 .43829736 -.0247297 -.9802890 -1.582849 3.4820812
.07989100 .16510661 .32252599 -.6721538 .03096569 -3.762539
.02796200 .02102287 .70727538 1.1417685 .30862864 1.6766932
    4    2
2.3050000 .11279019 -.2108688 .75995011 -1.442742
.80675000 .41850753 -.5943796 .16461590 2.3489914
.28236200 .47000773 .08968888 -1.371014 -1.991152
.09882700 .18262603 .86116340 1.0593155 .90505601
    3    1
1.8190000 .27051341 -.7938035 1.3082770
.72760000 .55101250 -.0914252 -2.021059
.29104000 .33108664 .86200334 1.2498888
%EOF%

#######################################################################
#  DALTON INPUT
#######################################################################
cat > rsp_esr2.dal <<'%EOF%'
**DALTON INPUT
.RUN RESPONSE
**INTEGRALS
.FC
.SD
**WAVE FUNCTIONS
.TITLE
beoh
.HF
.MCSCF
.NSYM
 2
*SCF INPUT
.DOUBLY OCCUPIED
 4 2
.OPEN SHELL
 1
*CONFIGURATION INPUT
.SYMMETRY
 1
.SPIN MULT
 2
.ELECTRONS
 9
.INACTIVE
 2 0
.CAS SPACE
 7 2
*OPTIMIZATION
.DETERMI
.TRACI
.MAX CI
 50
**RESPONSE
.TRPFLG
*ESR
.MAX IT
 95
.TRPPRP
FC Be 01
.TRPPRP
FC O  02
.TRPPRP
FC H  03
.TRPPRP
SD 001 x
.TRPPRP
SD 001 y
.TRPPRP
SD 001 z
.TRPPRP
SD 002 x
.TRPPRP
SD 002 y
.TRPPRP
SD 002 z
.TRPPRP
SD 003 x
.TRPPRP
SD 003 y
.TRPPRP
SD 003 z
.TRPPRP
SD 004 x
.TRPPRP
SD 004 y
.TRPPRP
SD 004 z
.TRPPRP
SD 005 x
.TRPPRP
SD 005 y
.TRPPRP
SD 005 z
.TRPPRP
SD 006 x
.TRPPRP
SD 006 y
.TRPPRP
SD 006 z
.TRPPRP
SD 007 x
.TRPPRP
SD 007 y
.TRPPRP
SD 007 z
.TRPPRP
SD 008 x
.TRPPRP
SD 008 y
.TRPPRP
SD 008 z
.TRPPRP
SD 009 x
.TRPPRP
SD 009 y
.TRPPRP
SD 009 z
**END OF DALTON INPUT
%EOF%
#######################################################################



#######################################################################

#######################################################################
#  CHECK SCRIPT
#######################################################################
echo $CHECK_SHELL >rsp_esr2.check
cat >>rsp_esr2.check <<'%EOF%'
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

# Integral setup
CRIT1=`$GREP "Calculation of one\- and two\-electron Hamiltonian integrals\." $log | wc -l`
CRIT2=`$GREP "The following one\-electron property integrals are calculated" $log | wc -l`
CRIT3=`$GREP "\- overlap integrals" $log | wc -l`
CRIT4=`$GREP "\- Fermi contact integrals" $log | wc -l`
CRIT5=`$GREP "\(Dirac delta function integrals\)" $log | wc -l`
CRIT6=`$GREP "\- spin\-dipole integrals" $log | wc -l`
CRIT7=`$GREP "\(electron spin \- nuclear moment coupling\)" $log | wc -l`
CRIT8=`$GREP "two-electron integrals are transformed to P-supermatrix elements" $log | wc -l`
CRIT9=`$GREP "Integrals for all indirect spin\-spin coupling and/or shielding tensors are calculated\." $log | wc -l`
TEST[1]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9`
CTRL[1]=9
ERROR[1]="INTEGRAL SETUP NOT CORRECT"

# Symmetry
CRIT1=`$GREP "Number of coordinates in each symmetry\: * 6 * 3" $log | wc -l`
CRIT2=`$GREP "Number of orbitals in each symmetry\: * 50 * 24" $log | wc -l`
TEST[2]=`expr	$CRIT1 \+ $CRIT2`
CTRL[2]=2
ERROR[2]="SYMMETRY NOT CORRECT"

# Energy
CRIT1=`$GREP "Final MCSCF energy\: * \-90\.2755499943[0-9][0-9]" $log | wc -l`
TEST[3]=`expr	$CRIT1`
CTRL[3]=1
ERROR[3]="ENERGY NOT CORRECT"

# ESR parameters
CRIT1=`$GREP "TRIPLET OPERATOR\: \"FC Be 01\" LAGRANGIAN\: * (0| )\.571695 AVERAGE\: * 2\.805693 TOTAL\: * 3\.37738." $log | wc -l`
CRIT2=`$GREP "TRIPLET OPERATOR\: \"FC O * 02\" LAGRANGIAN\: (\-0| \-)\.00802[0-9] AVERAGE\: * (0| )\.5528(8|9). TOTAL\: * (0| )\.5448(6|7)[0-9]" $log | wc -l`
CRIT3=`$GREP "TRIPLET OPERATOR\: \"FC H * 03\" LAGRANGIAN\: * (0| )\.003256 AVERAGE\: * (0| )\.008743 TOTAL\: * (0| )\.011999" $log | wc -l`
CRIT4=`$GREP "TRIPLET OPERATOR\: \"SD * 001 z\" LAGRANGIAN\: * (0| )\.002178 AVERAGE\: (\-0| \-)\.043424 TOTAL\: (\-0| \-)\.041246" $log | wc -l`
CRIT5=`$GREP "TRIPLET OPERATOR\: \"SD * 002 z\" LAGRANGIAN\: (\-0| \-)\.019432 AVERAGE\: (\-0| \-)\.04419. TOTAL\: (\-0| \-)\.06362." $log | wc -l`
CRIT6=`$GREP "TRIPLET OPERATOR\: \"SD * 003 z\" LAGRANGIAN\: * (0| )\.001676 AVERAGE\: (\-0| \-)\.003111 TOTAL\: (\-0| \-)\.001434" $log | wc -l`
CRIT7=`$GREP "TRIPLET OPERATOR\: \"SD * 004 x\" LAGRANGIAN\: (\-0| \-)\.004355 AVERAGE\: * (0| )\.086848 TOTAL\: * (0| )\.082493" $log | wc -l`
CRIT8=`$GREP "TRIPLET OPERATOR\: \"SD * 004 y\" LAGRANGIAN\: (\-0| \-)\.000012 AVERAGE\: (\-0| \-)\.000118 TOTAL\: (\-0| \-)\.000130" $log | wc -l`
CRIT9=`$GREP "TRIPLET OPERATOR\: \"SD * 005 x\" LAGRANGIAN\: (\-0| \-)\.000012 AVERAGE\: (\-0| \-)\.000118 TOTAL\: (\-0| \-)\.000130" $log | wc -l`
CRIT10=`$GREP "TRIPLET OPERATOR\: \"SD * 005 y\" LAGRANGIAN\: * (0| )\.002178 AVERAGE\: (\-0| \-)\.043424 TOTAL\: (\-0| \-)\.041246" $log | wc -l`
CRIT11=`$GREP "TRIPLET OPERATOR\: \"SD * 006 x\" LAGRANGIAN\: * (0| )\.03885(8|9) AVERAGE\: * (0| )\.08837(6|7) TOTAL\: * (0| )\.12723." $log | wc -l`
CRIT12=`$GREP "TRIPLET OPERATOR\: \"SD * 006 y\" LAGRANGIAN\: (\-0| \-)\.000332 AVERAGE\: (\-0| \-)\.000080 TOTAL\: (\-0| \-)\.000411" $log | wc -l`
CRIT13=`$GREP "TRIPLET OPERATOR\: \"SD * 007 x\" LAGRANGIAN\: (\-0| \-)\.000332 AVERAGE\: (\-0| \-)\.000080 TOTAL\: (\-0| \-)\.000411" $log | wc -l`
CRIT14=`$GREP "TRIPLET OPERATOR\: \"SD * 007 y\" LAGRANGIAN\: (\-0| \-)\.01942(6|7) AVERAGE\: (\-0| \-)\.044185 TOTAL\: (\-0| \-)\.063612" $log | wc -l`
CRIT15=`$GREP "TRIPLET OPERATOR\: \"SD * 008 x\" LAGRANGIAN\: (\-0| \-)\.003353 AVERAGE\: * (0| )\.006221 TOTAL\: * (0| )\.00286(8|9)" $log | wc -l`
CRIT16=`$GREP "TRIPLET OPERATOR\: \"SD * 008 y\" LAGRANGIAN\: * (0| )\.000036 AVERAGE\: (\-0| \-)\.000005 TOTAL\: * (0| )\.000030" $log | wc -l`
CRIT17=`$GREP "TRIPLET OPERATOR\: \"SD * 009 x\" LAGRANGIAN\: * (0| )\.000036 AVERAGE\: (\-0| \-)\.000005 TOTAL\: * (0| )\.000030" $log | wc -l`
CRIT18=`$GREP "TRIPLET OPERATOR\: \"SD * 009 y\" LAGRANGIAN\: * (0| )\.001676 AVERAGE\: (\-0| \-)\.003111 TOTAL\: (\-0| \-)\.001434" $log | wc -l`
CRIT19=`$GREP "TRIPLET OPERATOR\: \"SD * 001 x\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT20=`$GREP "TRIPLET OPERATOR\: \"SD * 001 y\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT21=`$GREP "TRIPLET OPERATOR\: \"SD * 002 x\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT22=`$GREP "TRIPLET OPERATOR\: \"SD * 002 y\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT23=`$GREP "TRIPLET OPERATOR\: \"SD * 003 x\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT24=`$GREP "TRIPLET OPERATOR\: \"SD * 003 y\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT25=`$GREP "TRIPLET OPERATOR\: \"SD * 004 z\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT26=`$GREP "TRIPLET OPERATOR\: \"SD * 005 z\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT27=`$GREP "TRIPLET OPERATOR\: \"SD * 006 z\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT28=`$GREP "TRIPLET OPERATOR\: \"SD * 007 z\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT29=`$GREP "TRIPLET OPERATOR\: \"SD * 008 z\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
CRIT30=`$GREP "TRIPLET OPERATOR\: \"SD * 009 z\" contribution \= (0| )\.0 by symmetry" $log | wc -l`
TEST[4]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16 \+ $CRIT17 \+ $CRIT18 \+ \
		$CRIT19 \+ $CRIT20 \+ $CRIT21 \+ $CRIT22 \+ $CRIT23 \+ $CRIT24 \+ \
		$CRIT25 \+ $CRIT26 \+ $CRIT27 \+ $CRIT28 \+ $CRIT29 \+ $CRIT30`
CTRL[4]=30
ERROR[4]="ESR PARAMETERS NOT CORRECT"

PASSED=1
for i in 1 2 3 4
do
   if [ ${TEST[i]} -lt ${CTRL[i]} ]; then
     echo "${ERROR[i]} ( test = ${TEST[i]}; control = ${CTRL[i]} ); "
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi

%EOF%
#######################################################################
