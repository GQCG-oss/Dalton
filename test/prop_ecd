#!/bin/sh
#
# This is the script for generating files for a specific Dalton test job.
#
# For the .check file ksh or bash is preferred, otherwise use sh
# (and hope it is not the old Bourne shell, which will not work)
#
if [ -x /bin/ksh ]; then
   CHECK_SHELL='#!/bin/ksh'
elif [ -x /bin/bash ]; then
   CHECK_SHELL='#!/bin/bash'
else
   CHECK_SHELL='#!/bin/sh'
fi


#######################################################################
#  TEST DESCRIPTION
#######################################################################
cat > prop_ecd.info <<'%EOF%'
   prop_ecd
   --------
   Molecule:         C2H4
   Wave Function:    SCF
   Test Purpose:     Electronic circular dichroism parameters (ECD)
%EOF%

#######################################################################
#  MOLECULE INPUT
#######################################################################
cat > prop_ecd.mol <<'%EOF%'
INTGRL
Electronic circular dichroism parameters

    2    1 YZ      *  1.00D-13
        6.    1    2    1    1
C#1   0.000000            0.000000           0.666000                 *
  12   5
4233.     .001220
634.9     .009342
146.1     .045452
42.50     .154657
14.19     .358866
5.148     .438632
1.967     .145918
5.148               -0.168367
0.4962              1.060091
0.1533                        1.0
0.044                                   1.000
0.017                                             1.000
    7   4
18.16     .018539
3.986     .115436
1.143     .386188
0.3594    0.640114
0.1146              1.0
0.040                         1.000
0.016                                   1.000
        1.    2    1    1
H#1   0.284567           -0.910839           1.192778                 *
H#3  -0.073654            0.946415           1.229639                 *
    4   2
19.2384   .032828
2.89872   .231204
0.653472  .817226
0.177552            1.0
%EOF%

#######################################################################
#  DALTON INPUT
#######################################################################
cat > prop_ecd.dal <<'%EOF%'
**DALTON INPUT
.RUN PROPERTIES
**WAVE FUNCTIONS
.HF
.TITLE
C2H4
**PROPERTIES
.EXCITA
.ECD
*EXCITA
.MAXPHP
  300
.NEXCIT
    8    8
.PRINT
    1
.ROTVEL
**END OF DALTON INPUT
%EOF%
#######################################################################



#######################################################################

#######################################################################
#  CHECK SCRIPT
#######################################################################
echo $CHECK_SHELL >prop_ecd.check
cat >>prop_ecd.check <<'%EOF%'
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

# Atombasis
CRIT1=`$GREP "C\# * 2 * 6\.0000 * 33 * 17 * \[12s7p\|5s4p\]" $log | wc -l`
CRIT2=`$GREP "H\# * 4 * 1\.0000 * 4 * 2 * \[4s\|2s\]" $log | wc -l`
CRIT3=`$GREP "total\: * 6 * 16\.0000 * 82 * 42" $log | wc -l`
TEST[1]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3`
CTRL[1]=3
ERROR[1]="ATOMBASIS NOT READ CORRECTLY"

# Geomatry
CRIT1=`$GREP "Coordinates are entered in Angstrom.* and converted to atomic units\." $log | wc -l`
CRIT2=`$GREP "Total number of coordinates\: * 18" $log | wc -l`
CRIT3=`$GREP "1 * x * (\-0| 0| \-|  )\.0000000000" $log | wc -l`
CRIT4=`$GREP "2 * y * (\-0| 0| \-|  )\.0000000000" $log | wc -l`
CRIT5=`$GREP "3 * z * 1\.2585575992" $log | wc -l`
CRIT6=`$GREP "4 * x * (\-0| 0| \-|  )\.0000000000" $log | wc -l`
CRIT7=`$GREP "5 * y * (\-0| 0| \-|  )\.0000000000" $log | wc -l`
CRIT8=`$GREP "6 * z * \-1\.2585575992" $log | wc -l`
CRIT9=`$GREP "7 * x * (0| )\.5377536942" $log | wc -l`
CRIT10=`$GREP "8 * y * \-1\.7212362540" $log | wc -l`
CRIT11=`$GREP "9 * z * 2\.2540237479" $log | wc -l`
CRIT12=`$GREP "10 * x * (0| )\.5377536942" $log | wc -l`
CRIT13=`$GREP "11 * y * 1\.7212362540" $log | wc -l`
CRIT14=`$GREP "12 * z * \-2\.2540237479" $log | wc -l`
CRIT15=`$GREP "13 * x * (\-0|\-)\.1391858880" $log | wc -l`
CRIT16=`$GREP "14 * y * 1\.7884651506" $log | wc -l`
CRIT17=`$GREP "15 * z * 2\.3236809426" $log | wc -l`
CRIT18=`$GREP "16 * x * (\-0|\-)\.1391858880" $log | wc -l`
CRIT19=`$GREP "17 * y * \-1\.7884651506" $log | wc -l`
CRIT20=`$GREP "18 * z * \-2\.3236809426" $log | wc -l`
TEST[2]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16 \+ $CRIT17 \+ $CRIT18 \+ \
		$CRIT19 \+ $CRIT20`
CTRL[2]=20
ERROR[2]="GEOMETRY NOT READ CORRECTLY"

# Symmetry
CRIT1=`$GREP "Number of coordinates in each symmetry\: * 9 * 9" $log | wc -l`
CRIT2=`$GREP "Number of orbitals in each symmetry\: * 21 * 21" $log | wc -l`
TEST[3]=`expr	$CRIT1 \+ $CRIT2`
CTRL[3]=2
ERROR[3]="SYMMETRY NOT CORRECT"

# Energy
CRIT1=`$GREP "Final * HF energy\: * \-77\.996769749" $log | wc -l`
TEST[4]=`expr	$CRIT1`
CTRL[4]=1
ERROR[4]="ENERGY NOT CORRECT"

# Excitation setup
CRIT1=`$GREP "Number of excitation energies\: * 8 * 8 * 0 * 0 * 0 * 0 * 0 * 0" $log | wc -l`
CRIT2=`$GREP "Conventional rotational strength" $log | wc -l`
CRIT3=`$GREP "Center of mass gauge origin *\: * (0| )\.028660 * (\-0|0| )\.000000 * (\-0|0| )\.000000" $log | wc -l`
TEST[5]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3`
CTRL[5]=3
ERROR[5]="EXCITATION SETUP NOT CORRECT"

# Electric transition dipole moments (June 2009 version)
#  1        1     0.251717    -0.7015  0.0000  0.0000   -0.6702  0.0000  0.0000
#  1        2     0.286551    -0.0927  0.0000  0.0000   -0.0988  0.0000  0.0000
#  1        3     0.309268     0.2739  0.0000  0.0000    0.2567  0.0000  0.0000
#  1        4     0.315071     0.0026  0.0000  0.0000   -0.0006  0.0000  0.0000
#  1        5     0.357947     0.2671  0.0000  0.0000    0.1876  0.0000  0.0000
#  1        6     0.368135     0.1280  0.0000  0.0000    0.1127  0.0000  0.0000
#  1        7     0.380247    -0.3745  0.0000  0.0000   -0.3382  0.0000  0.0000
#  1        8     0.390742     0.0434  0.0000  0.0000    0.0469  0.0000  0.0000
#------------------------------------------------------------------------------
#  2        1     0.248586     0.0000 -0.0040 -1.0926    0.0000 -0.0010 -1.3159
#  2        2     0.273424     0.0000  0.0180 -0.1681    0.0000  0.0283 -0.2076
#  2        3     0.279423     0.0000  0.2249 -0.0861    0.0000  0.2291 -0.0900
#  2        4     0.323006     0.0000  0.0117 -0.0036    0.0000  0.0071  0.0126
#  2        5     0.335031     0.0000 -0.1674  0.0595    0.0000 -0.1739  0.0732
#  2        6     0.341675     0.0000 -0.0482  0.4587    0.0000 -0.0320  0.5332
#  2        7     0.349583     0.0000 -0.0461  0.5185    0.0000 -0.0360  0.6223
#  2        8     0.358428     0.0000  0.1050 -0.2896    0.0000  0.1119 -0.2785
CRIT1=`$GREP "1 * 1 * (0| )\.2517.* \-*0*\.70.* \-*0*\.00.* \-*0*\.00.* \-*0*\.67.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT2=`$GREP "1 * 2 * (0| )\.286.* \-*0*\.09.* \-*0*\.00.* \-*0*\.00.* \-*0*\.09.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT3=`$GREP "1 * 3 * (0| )\.309.* \-*0*\.27.* \-*0*\.00.* \-*0*\.00.* \-*0*\.25.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT4=`$GREP "1 * 4 * (0| )\.315.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT5=`$GREP "1 * 5 * (0| )\.3579.* \-*0*\.26.* \-*0*\.00.* \-*0*\.00.* \-*0*\.18.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT6=`$GREP "1 * 6 * (0| )\.3681.* \-*0*\.12.* \-*0*\.00.* \-*0*\.00.* \-*0*\.11.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT7=`$GREP "1 * 7 * (0| )\.3802.* \-*0*\.37.* \-*0*\.00.* \-*0*\.00.* \-*0*\.33.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT8=`$GREP "1 * 8 * (0| )\.3907.* \-*0*\.04.* \-*0*\.00.* \-*0*\.00.* \-*0*\.04.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT9=`$GREP "2 * 1 * (0| )\.248.* \-*0*\.00.* \-*0*\.00.* \-*1\.09.* \-*0*\.00.* \-*0*\.00.* \-*1\.31" $log | wc -l`
CRIT10=`$GREP "2 * 2 * (0| )\.2734.* \-*0*\.00.* \-*0*\.01.* \-*0*\.16.* \-*0*\.00.* \-*0*\.02.* \-*0*\.20" $log | wc -l`
CRIT11=`$GREP "2 * 3 * (0| )\.2794.* \-*0*\.00.* \-*0*\.22.* \-*0*\.08.* \-*0*\.00.* \-*0*\.22.* \-*0*\.09" $log | wc -l`
CRIT12=`$GREP "2 * 4 * (0| )\.3230.* \-*0*\.00.* \-*0*\.01.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.01" $log | wc -l`
CRIT13=`$GREP "2 * 5 * (0| )\.3350.* \-*0*\.00.* \-*0*\.16.* \-*0*\.0[56].* \-*0*\.00.* \-*0*\.17.* \-*0*\.07" $log | wc -l`
CRIT14=`$GREP "2 * 6 * (0| )\.341.* \-*0*\.00.* \-*0*\.04.* \-*0*\.45.* \-*0*\.00.* \-*0*\.03.* \-*0*\.53" $log | wc -l`
CRIT15=`$GREP "2 * 7 * (0| )\.349.* \-*0*\.00.* \-*0*\.04.* \-*0*\.51.* \-*0*\.00.* \-*0*\.03.* \-*0*\.62" $log | wc -l`
CRIT16=`$GREP "2 * 8 * (0| )\.3584.* \-*0*\.00.* \-*0*\.10.* \-*0*\.2[89].* \-*0*\.00.* \-*0*\.11.* \-*0*\.27" $log | wc -l`
TEST[6]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16`
CTRL[6]=16
ERROR[6]="ELECTRIC TRANSITION DIPOLE MOMENTS NOT CORRECT"

# Magnetic transition dipole moments (May 2009 output)
#  1      1     6.8496    0.15514  0.00000  0.00000   0.16512  0.00000  0.00000
#  1      2     7.7975    0.00491  0.00000  0.00000   0.00488  0.00000  0.00000
#  1      3     8.4156   -0.12729  0.00000  0.00000  -0.13643  0.00000  0.00000
#  1      4     8.5735   -0.00127  0.00000  0.00000  -0.00095  0.00000  0.00000
#  1      5     9.7402   -0.10834  0.00000  0.00000  -0.11995  0.00000  0.00000
#  1      6    10.0175   -0.01278  0.00000  0.00000  -0.01371  0.00000  0.00000
#  1      7    10.3470    0.20417  0.00000  0.00000   0.22464  0.00000  0.00000
#  1      8    10.6326   -0.01882  0.00000  0.00000  -0.01857  0.00000  0.00000
#------------------------------------------------------------------------------
#  2      1     6.7644    0.00000  0.07575  0.25472   0.00000  0.08428  0.27576
#  2      2     7.4402    0.00000 -0.00992  0.02624   0.00000 -0.01160  0.02579
#  2      3     7.6035    0.00000  0.00450 -0.00510   0.00000  0.00796 -0.00544
#  2      4     8.7894    0.00000 -0.02768 -0.15486   0.00000 -0.02495 -0.16515
#  2      5     9.1167    0.00000 -0.06557  0.03428   0.00000 -0.02756  0.03597
#  2      6     9.2974    0.00000 -0.12259  0.53644   0.00000 -0.13989  0.55973
#  2      7     9.5126    0.00000 -0.11737  0.26733   0.00000 -0.12610  0.28446
#  2      8     9.7533    0.00000 -0.83770 -0.10357   0.00000 -0.89516 -0.10794
CRIT1=`$GREP "1 * 1 * 6\.8496.* \-*0*\.15.* \-*0*\.00.* \-*0*\.00.* \-*0*\.16.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT2=`$GREP "1 * 2 * 7\.7975.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT3=`$GREP "1 * 3 * 8\.4156.* \-*0*\.12.* \-*0*\.00.* \-*0*\.00.* \-*0*\.13.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT4=`$GREP "1 * 4 * 8\.5735.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT5=`$GREP "1 * 5 * 9\.7402.* \-*0*\.10.* \-*0*\.00.* \-*0*\.00.* \-*0*\.1[12].* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT6=`$GREP "1 * 6 * 10\.0175.* \-*0*\.01.* \-*0*\.00.* \-*0*\.00.* \-*0*\.01.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT7=`$GREP "1 * 7 * 10\.3470.* \-*0*\.20.* \-*0*\.00.* \-*0*\.00.* \-*0*\.22.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT8=`$GREP "1 * 8 * 10\.6326.* \-*0*\.01.* \-*0*\.00.* \-*0*\.00.* \-*0*\.01.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT9=`$GREP "2 * 1 * 6\.7644.* \-*0*\.00.* \-*0*\.07.* \-*0*\.25.* \-*0*\.00.* \-*0*\.08.* \-*0*\.27" $log | wc -l`
CRIT10=`$GREP "2 * 2 * 7\.4402.* \-*0*\.00.* \-*0*\.0[01].* \-*0*\.02.* \-*0*\.00.* \-*0*\.01.* \-*0*\.02" $log | wc -l`
CRIT11=`$GREP "2 * 3 * 7\.6035.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00.* \-*0*\.00" $log | wc -l`
CRIT12=`$GREP "2 * 4 * 8\.7894.* \-*0*\.00.* \-*0*\.02.* \-*0*\.15.* \-*0*\.00.* \-*0*\.02.* \-*0*\.16" $log | wc -l`
CRIT13=`$GREP "2 * 5 * 9\.1167.* \-*0*\.00.* \-*0*\.06.* \-*0*\.03.* \-*0*\.00.* \-*0*\.02.* \-*0*\.03" $log | wc -l`
CRIT14=`$GREP "2 * 6 * 9\.2974.* \-*0*\.00.* \-*0*\.12.* \-*0*\.53.* \-*0*\.00.* \-*0*\.1[34].* \-*0*\.5[56]" $log | wc -l`
CRIT15=`$GREP "2 * 7 * 9\.5126.* \-*0*\.00.* \-*0*\.11.* \-*0*\.26.* \-*0*\.00.* \-*0*\.12.* \-*0*\.28" $log | wc -l`
CRIT16=`$GREP "2 * 8 * 9\.7533.* \-*0*\.00.* \-*0*\.83.* \-*0*\.10.* \-*0*\.00.* \-*0*\.89.* \-*0*\.10" $log | wc -l`
TEST[7]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16`
CTRL[7]=16
ERROR[7]="MAGNETIC TRANSITION DIPOLE MOMENTS NOT CORRECT"

# Oscillator and Rotational Strengths
CRIT1=`$GREP "1 * 1 * 6\.8496.* (0| )\.0826 * (0| )\.0754 * \-51\.307 * \-49\.017 * \-52\.170" $log | wc -l`
CRIT2=`$GREP "1 * 2 * 7\.7975.* (0| )\.0016 * (0| )\.0019 * (\-0|\-)\.215 * (\-0|\-)\.228 * (\-0|\-)\.227" $log | wc -l`
CRIT3=`$GREP "1 * 3 * 8\.4156.* (0| )\.0155 * (0| )\.0136 * \-16\.435 * \-15\.403 * \-16\.509" $log | wc -l`
CRIT4=`$GREP "1 * 4 * 8\.5735.* (0| )\.0000 * (0| )\.0000 * (\-0|\-)\.002 * (0| )\.000 * (0| )\.000" $log | wc -l`
CRIT5=`$GREP "1 * 5 * 9\.7402.* (0| )\.0170 * (0| )\.0084 * \-13\.643 * \-9\.58(0|1) * \-10\.608" $log | wc -l`
CRIT6=`$GREP "1 * 6 * 10\.0175.* (0| )\.0040 * (0| )\.0031 * (\-0|\-)\.771 * (\-0|\-)\.679 * (\-0|\-)\.728" $log | wc -l`
CRIT7=`$GREP "1 * 7 * 10\.3470.* (0| )\.0356 * (0| )\.0290 * \-36\.047 * \-32\.555 * \-35\.819" $log | wc -l`
CRIT8=`$GREP "1 * 8 * 10\.6326.* (0| )\.0005 * (0| )\.0006 * (\-0|\-)\.385 * (\-0|\-)\.416 * (\-0|\-)\.411" $log | wc -l`
CRIT9=`$GREP "2 * 1 * 6\.7644.* (0| )\.1978 * (0| )\.2870 * \-131\.353 \-158\.057 \-171\.114" $log | wc -l`
CRIT10=`$GREP "2 * 2 * 7\.4402.* (0| )\.0052 * (0| )\.0080 * \-2\.164 * \-2\.700 * \-2\.679" $log | wc -l`
CRIT11=`$GREP "2 * 3 * 7\.6035.* (0| )\.0108 * (0| )\.0113 * (0| )\.684 * (0| )\.702 * 1\.090" $log | wc -l`
CRIT12=`$GREP "2 * 4 * 8\.7894.* (0| )\.0000 * (0| )\.0000 * (0| )\.110 * \-1\.010 * \-1\.062" $log | wc -l`
CRIT13=`$GREP "2 * 5 * 9\.1167.* (0| )\.0071 * (0| )\.0080 * 6\.137 * 6\.558 * 3\.501" $log | wc -l`
CRIT14=`$GREP "2 * 6 * 9\.2974.* (0| )\.0485 * (0| )\.0650 * 118\.80(0|1) * 136\.69(3|4) * 142\.81(0|1)" $log | wc -l`
CRIT15=`$GREP "2 * 7 * 9\.5126.* (0| )\.0632 * (0| )\.0906 * 67\.90(1|2) * 80\.42(0|1) * 85\.59(4|5)" $log | wc -l`
CRIT16=`$GREP "2 * 8 * 9\.7533.* (0| )\.0227 * (0| )\.0215 * \-27\.336 * \-30\.587 * \-33\.045" $log | wc -l`
TEST[8]=`expr	$CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ \
		$CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ \
		$CRIT13 \+ $CRIT14 \+ $CRIT15 \+ $CRIT16`
CTRL[8]=16
ERROR[8]="OSCILLATOR AND ROTATIONAL STRENGTHS NOT CORRECT"

PASSED=1
for i in 1 2 3 4 5 6 7 8
do
   if [ ${TEST[i]} -lt ${CTRL[i]} ]; then
     echo "${ERROR[i]} ( test = ${TEST[i]}; control = ${CTRL[i]} ); "
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi

%EOF%
#######################################################################
