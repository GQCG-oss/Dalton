#!/bin/ksh
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

#
# Test of two-photon transition tensor S
#
CRIT1=`$GREP " * 1 * 1 * 4\.25 * \-*0*\.0 * \-*0*\.0 * \-*0*\.0 * \-*0*\.0 * \-*0*\.5 * \-*0*\.4" $log | wc -l`
CRIT2=`$GREP " * 1 * 2 * 8\.40 * \-*7\.4 * \-*3\.4 * \-*0*\.3 * \-*5\.8 * \-*0*\.0 * \-*0*\.0" $log | wc -l`
CRIT3=`$GREP " * 1 * 3 * 8\.76 * \-*0*\.0 * \-*0*\.0 * \-*0*\.0 * \-*0*\.0 * \-*0*\.7 * \-*1\.8" $log | wc -l`
CRIT4=`$GREP " * 1 * 4 * 10\.36 * \-*0*\.0 * \-*0*\.0 * \-*0*\.0 * \-*0*\.0 * \-*1\.0 * \-*1\.1" $log | wc -l`
TEST[1]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 `
CTRL[1]=4
ERROR[1]="TWO-PHOTON TRANSITION TENSOR NOT CORRECT"

#
# Test of two-photon absorption
#
CRIT1=`$GREP " * 1 * 1 * 4\.25 * Linear   * 0*\.[23]..E\-08 * (0| )\.285E\-01 * (0| )\.114E\+00 * (0| )\.151E\-02 * 1\.50" $log | wc -l`
CRIT2=`$GREP " * 1 * 1 * 4\.25 * Circular * 0*\.[23]..E\-08 * (0| )\.285E\-01 * (0| )\.171E\+00 * (0| )\.226E\-02 * 1\.50" $log | wc -l`
CRIT3=`$GREP " * 1 * 2 * 8\.40 * Linear   * 0*\.412E\+01 * (0| )\.444E\+01 * (0| )\.260E\+02 * (0| )\.134E\+01 * ( |0)\.71" $log | wc -l`
CRIT4=`$GREP " * 1 * 2 * 8\.40 * Circular * 0*\.412E\+01 * (0| )\.444E\+01 * (0| )\.184E\+02 * (0| )\.950E\+00 * ( |0)\.71" $log | wc -l`
CRIT5=`$GREP " * 1 * 3 * 8\.76 * Linear   * 0*\.317E\-06 * (0| )\.253E\+00 * (0| )\.101E\+01 * (0| )\.570E\-01 * 1\.50" $log | wc -l`
CRIT6=`$GREP " * 1 * 3 * 8\.76 * Circular * 0*\.317E\-06 * (0| )\.253E\+00 * (0| )\.152E\+01 * (0| )\.855E\-01 * 1\.50" $log | wc -l`
CRIT7=`$GREP " * 1 * 4 * 10\.36 * Linear  * 0*\.[45]..E\-07 * (0| )\.146E\+00 * (0| )\.582E\+00 * (0| )\.458E\-01 * 1\.50" $log | wc -l`
CRIT8=`$GREP " * 1 * 4 * 10\.36 * Circular * 0*\.[45]..E\-07 * (0| )\.146E\+00 * (0| )\.873E\+00 * (0| )\.687E\-01 * 1\.50" $log | wc -l`
TEST[2]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 `
CTRL[2]=8
ERROR[2]="TWO-PHOTON ABSORPTION PROPERTIES NOT CORRECT"

PASSED=1 
for i in 1 2
do
   if [ ${TEST[i]} -ne ${CTRL[i]} ]; then
     echo "${ERROR[i]} ( test = ${TEST[i]}; control = ${CTRL[i]} ); "
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi                
