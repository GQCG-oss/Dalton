#!/bin/ksh
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

#
# quantum-classical border option
#
 CRIT1=`$GREP "from site:    37" $log | wc -l`
 CRIT2=`$GREP "from site:     9" $log | wc -l`
 CRIT3=`$GREP "from site:    26" $log | wc -l`
 CRIT4=`$GREP "from site:    39" $log | wc -l`
 CRIT5=`$GREP "from site:     1" $log | wc -l`
 CRIT6=`$GREP "from site:    10" $log | wc -l`
 CRIT7=`$GREP "to neighbouring site:    25" $log | wc -l`
 CRIT8=`$GREP "to neighbouring site:     2" $log | wc -l`
 CRIT9=`$GREP "to neighbouring site:    42" $log | wc -l`
CRIT10=`$GREP "to neighbouring site:     4" $log | wc -l`
CRIT11=`$GREP "Redistributing multipoles upto 0th order" $log | wc -l`
TEST[1]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 `
CTRL[1]=18
ERROR[1]="REDISTRIBUTION OF PARAMETERS NOT CORRECT"

#
# redistribution of charges
#
CRIT1=`$GREP "C * 2 * 0*\.2359" $log | wc -l`
CRIT2=`$GREP "C * 4 * 0*\.0820" $log | wc -l`
CRIT3=`$GREP "N * 25 * \-0*\.2940" $log | wc -l`
CRIT4=`$GREP "H * 42 * 0*\.2712" $log | wc -l`
TEST[2]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 `
CTRL[2]=4
ERROR[2]="REDISTRIBUTION OF CHARGES NOT CORRECT"

PASSED=1
for i in 1 2
do
   if [ ${TEST[i]} -ne ${CTRL[i]} ]; then
     echo "${ERROR[i]} ( test = ${TEST[i]}; control = ${CTRL[i]} ); "
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi
