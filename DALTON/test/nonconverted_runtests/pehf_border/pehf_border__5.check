#!/bin/ksh
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi

#
# quantum-classical border option
#
 CRIT1=`$GREP "from site:    37" $log | wc -l`
 CRIT2=`$GREP "from site:     9" $log | wc -l`
 CRIT3=`$GREP "from site:    26" $log | wc -l`
 CRIT4=`$GREP "from site:    39" $log | wc -l`
 CRIT5=`$GREP "from site:     1" $log | wc -l`
 CRIT6=`$GREP "from site:    10" $log | wc -l`
 CRIT7=`$GREP "to neighbouring sites:    25    27    41" $log | wc -l`
 CRIT8=`$GREP "to neighbouring sites:     2     4    16" $log | wc -l`
 CRIT9=`$GREP "to neighbouring sites:    25    27    38" $log | wc -l`
CRIT10=`$GREP "to neighbouring sites:    42    25    27" $log | wc -l`
CRIT11=`$GREP "to neighbouring sites:     2     4    11" $log | wc -l`
CRIT12=`$GREP "to neighbouring sites:     4    13     2" $log | wc -l`
CRIT13=`$GREP "Redistributing multipoles upto 2nd order and polarizabilities" $log | wc -l`
TEST[1]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 \+ $CRIT11 \+ $CRIT12 \+ $CRIT13 `
CTRL[1]=18
ERROR[1]="REDISTRIBUTION OF PARAMETERS NOT CORRECT"

#
# redistribution of charges
#
 CRIT1=`$GREP "C * 2 * ( |0)\.3936" $log | wc -l`
 CRIT2=`$GREP "C * 4 * (\-|\-0)\.0641" $log | wc -l`
 CRIT3=`$GREP "H * 11 * ( |0)\.0292" $log | wc -l`
 CRIT4=`$GREP "H * 13 * ( |0)\.1626" $log | wc -l`
 CRIT5=`$GREP "H * 16 * ( |0)\.1530" $log | wc -l`
 CRIT6=`$GREP "N * 25 * (\-|\-0)\.2603" $log | wc -l`
 CRIT7=`$GREP "C * 27 * (\-|\-0)\.1907" $log | wc -l`
 CRIT8=`$GREP "H * 38 * ( |0)\.2188" $log | wc -l`
 CRIT9=`$GREP "H * 41 * ( |0)\.1939" $log | wc -l`
CRIT10=`$GREP "H * 42 * ( |0)\.1810" $log | wc -l`
TEST[2]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 `
CTRL[2]=10
ERROR[2]="REDISTRIBUTION OF CHARGES NOT CORRECT"

#
# redistribution of ORDER 1
#
 CRIT1=`$GREP "C * 2 * (\-|\-0)\.1213 * (\-|\-0)\.2392 * ( |0)\.1322" $log | wc -l`
 CRIT2=`$GREP "C * 4 * ( |0)\.1537 * (\-|\-0)\.0681 * ( |0)\.0764" $log | wc -l`
 CRIT3=`$GREP "H * 11 * ( |0)\.2449 * ( |0)\.1227 * ( |0)\.0243" $log | wc -l`
 CRIT4=`$GREP "H * 13 * ( |0)\.2741 * (\-|\-0)\.1517 * ( |0)\.3303" $log | wc -l`
 CRIT5=`$GREP "H * 16 * (\-|\-0)\.3498 * (\-|\-0)\.2781 * (\-|\-0)\.0453" $log | wc -l`
 CRIT6=`$GREP "N * 25 * (\-|\-0)\.0269 * ( |0)\.0302 * (\-|\-0)\.0403" $log | wc -l`
 CRIT7=`$GREP "C * 27 * ( |0)\.1783 * ( |0)\.2098 * (\-|\-0)\.0623" $log | wc -l`
 CRIT8=`$GREP "H * 38 * (\-|\-0)\.1042 * (\-|\-0)\.0122 * (\-|\-0)\.0787" $log | wc -l`
 CRIT9=`$GREP "H * 41 * ( |0)\.1662 * ( |0)\.3350 * ( |0)\.0075" $log | wc -l`
CRIT10=`$GREP "H * 42 * ( |0)\.2344 * (\-|\-0)\.0123 * ( |0)\.2789" $log | wc -l`
TEST[3]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 `
CTRL[3]=10
ERROR[3]="REDISTRIBUTION OF DIPOLES NOT CORRECT"

#
# redistribution of ORDER 2
#
 CRIT1=`$GREP "C * 2 * (\-|\-0)\.3469 * ( |0)\.0555 * (\-|\-0)\.5663 * ( |0)\.5876 * (\-|\-0)\.3199 * (\-|\-0)\.2407" $log | wc -l`
 CRIT2=`$GREP "C * 4 * (\-|\-0)\.1550 * (\-|\-0)\.1742 * ( |0)\.0477 * (\-|\-0)\.0053 * (\-|\-0)\.0105 * ( |0)\.1604" $log | wc -l`
 CRIT3=`$GREP "H * 11 * ( |0)\.1025 * ( |0)\.2861 * (\-|\-0)\.0392 * ( |0)\.0665 * ( |0)\.0797 * (\-|\-0)\.1689" $log | wc -l`
 CRIT4=`$GREP "H * 13 * ( |0)\.0401 * (\-|\-0)\.1665 * ( |0)\.3623 * (\-|\-0)\.2084 * (\-|\-0)\.1845 * ( |0)\.1684" $log | wc -l`
 CRIT5=`$GREP "H * 16 * ( |0)\.2101 * ( |0)\.3945 * ( |0)\.0453 * ( |0)\.0498 * ( |0)\.0424 * (\-|\-0)\.2598" $log | wc -l`
 CRIT6=`$GREP "N * 25 * ( |0)\.0004 * (\-|\-0)\.0627 * ( |0)\.8026 * ( |0)\.5304 * ( |0)\.0374 * (\-|\-0)\.5309" $log | wc -l`
 CRIT7=`$GREP "C * 27 * ( |0)\.2422 * (\-|\-0)\.1382 * ( |0)\.0205 * (\-|\-0)\.1156 * (\-|\-0)\.0887 * (\-|\-0)\.1266" $log | wc -l`
 CRIT8=`$GREP "H * 38 * ( |0)\.0777 * ( |0)\.0385 * ( |0)\.2529 * (\-|\-0)\.0062 * ( |0)\.0434 * (\-|\-0)\.0714" $log | wc -l`
 CRIT9=`$GREP "H * 41 * (\-|\-0)\.1014 * ( |0)\.1480 * (\-|\-0)\.0363 * ( |0)\.3074 * ( |0)\.0873 * (\-|\-0)\.2061" $log | wc -l`
CRIT10=`$GREP "H * 42 * ( |0)\.1163 * (\-|\-0)\.0495 * ( |0)\.2555 * (\-|\-0)\.2454 * (\-|\-0)\.0097 * ( |0)\.1291" $log | wc -l`
TEST[4]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 `
CTRL[4]=10
ERROR[4]="REDISTRIBUTION OF QUADRUPOLES NOT CORRECT"

#
# redistribution of polarizabilities
#
 CRIT1=`$GREP "C * 2 * 11\.6056 * \-2\.6373 * \-4\.1145 * 13\.8197 * 1\.1167 * 11\.0058" $log | wc -l`
 CRIT2=`$GREP "C * 4 * 11\.5368 * \-3\.8309 * \-1\.5308 * 11\.8834 * ( |0)\.4532 * 13\.8267" $log | wc -l`
 CRIT3=`$GREP "H * 11 * 5\.3172 * ( |0)\.9187 * \-1\.0825 * 5\.0159 * ( |0)\.7631 * 3\.3944" $log | wc -l`
 CRIT4=`$GREP "H * 13 * 2\.2290 * (\-|\-0)\.8550 * 1\.8156 * 1\.1107 * \-1\.0876 * 4\.0963" $log | wc -l`
 CRIT5=`$GREP "H * 16 * 4\.0720 * 2\.3372 * ( |0)\.5003 * 2\.2216 * ( |0)\.3466 * ( |0)\.8480" $log | wc -l`
 CRIT6=`$GREP "N * 25 * 10\.1451 * \-5\.5059 * ( |0)\.5678 * 16\.1546 * (\-|\-0)\.7334 * 6\.8055" $log | wc -l`
 CRIT7=`$GREP "C * 27 * 16\.6693 * \-1\.7001 * \-1\.3533 * 11\.1132 * \-1\.0914 * 8\.0420" $log | wc -l`
 CRIT8=`$GREP "H * 38 * 4\.6288 * (\-|\-0)\.9651 * 1\.2769 * 4\.2356 * ( |0)\.2819 * 2\.5813" $log | wc -l`
 CRIT9=`$GREP "H * 41 * 2\.3791 * 1\.6953 * (\-|\-0)\.3538 * 4\.6384 * ( |0)\.2247 * ( |0)\.7171" $log | wc -l`
CRIT10=`$GREP "H * 42 * 3\.1705 * (\-|\-0)\.3775 * 1\.7604 * ( |0)\.7385 * ( |0)\.0429 * 2\.9944" $log | wc -l`
TEST[5]=`expr $CRIT1 \+ $CRIT2 \+ $CRIT3 \+ $CRIT4 \+ $CRIT5 \+ $CRIT6 \+ $CRIT7 \+ $CRIT8 \+ $CRIT9 \+ $CRIT10 `
CTRL[5]=10
ERROR[5]="REDISTRIBUTION OF POLARIZABILITIES NOT CORRECT"

PASSED=1 
for i in 1 2 3 4 5
do
   if [ ${TEST[i]} -ne ${CTRL[i]} ]; then
     echo "${ERROR[i]} ( test = ${TEST[i]}; control = ${CTRL[i]} ); "
     PASSED=0
   fi
done

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM
  exit 1
fi
