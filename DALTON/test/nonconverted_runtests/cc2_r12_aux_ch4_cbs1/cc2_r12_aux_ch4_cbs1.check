#!/bin/ksh
log=$1

if [ `uname` = Linux ]; then
   GREP="egrep -a"
else
   GREP="egrep"
fi   

if $GREP -q "not implemented for parallel calculations" $log; then
   echo "TEST ENDED AS EXPECTED"
   exit 0
fi

#           Total SCF   energy:                   -40.1917720926
#           Total MP2-R12/B energy:               -40.3873962174
#           Total CC2-R12/B energy:               -40.3886100200
#
#+=============================================================================+
#|  sym. | Exci.  |        CC2-R12/B  Excitation energies            | ||T1||  |
#|(spin, |        +------------------------------------------------------------+
#| spat) |        |     Hartree    |       eV.      |     cm-1       |    %    |
#+=============================================================================+
#| ^1A   |    1   |     0.4873526  |      13.26154  |    106961.542  |  97.36  |
#| ^1A   |    2   |     0.4873526  |      13.26154  |    106961.542  |  97.37  |
#| ^1A   |    3   |     0.5386058  |      14.65621  |    118210.308  |  97.14  |
#+-----------------------------------------------------------------------------+
#| ^1B2  |    1   |     0.4136515  |      11.25603  |     90786.017  |  97.05  |
#| ^1B2  |    2   |     0.4784300  |      13.01874  |    105003.244  |  97.01  |
#| ^1B2  |    3   |     0.4873904  |      13.26257  |    106969.831  |  97.18  |
#+-----------------------------------------------------------------------------+
#| ^1B1  |    1   |     0.4136515  |      11.25603  |     90786.017  |  97.05  |
#| ^1B1  |    2   |     0.4784300  |      13.01874  |    105003.244  |  97.01  |
#| ^1B1  |    3   |     0.4873904  |      13.26257  |    106969.831  |  97.18  |
#+-----------------------------------------------------------------------------+
#| ^1B3  |    1   |     0.4136515  |      11.25603  |     90786.017  |  97.05  |
#| ^1B3  |    2   |     0.4784300  |      13.01874  |    105003.244  |  97.01  |
#| ^1B3  |    3   |     0.4873904  |      13.26257  |    106969.831  |  97.18  |
#+=============================================================================+
#
#           Total SCF   energy:                   -40.1917720926
#           Total RSTAR(R12)/B energy:            -40.3886100200
#           Total CCSD(R12)/B energy:             -40.4034406713
#
#+=============================================================================+
#|  sym. | Exci.  |        CCSD(R12)/ Excitation energies            | ||T1||  |
#|(spin, |        +------------------------------------------------------------+
#| spat) |        |     Hartree    |       eV.      |     cm-1       |    %    |
#+=============================================================================+
#| ^1A   |    1   |     0.4825182  |      13.12999  |    105900.497  |  95.82  |
#| ^1A   |    2   |     0.4825182  |      13.12999  |    105900.497  |  95.83  |
#| ^1A   |    3   |     0.5380974  |      14.64237  |    118098.718  |  96.12  |
#+-----------------------------------------------------------------------------+
#| ^1B2  |    1   |     0.4104396  |      11.16863  |     90081.079  |  95.70  |
#| ^1B2  |    2   |     0.4723962  |      12.85456  |    103678.990  |  95.00  |
#| ^1B2  |    3   |     0.4844071  |      13.18139  |    106315.063  |  95.95  |
#+-----------------------------------------------------------------------------+
#| ^1B1  |    1   |     0.4104396  |      11.16863  |     90081.079  |  95.70  |
#| ^1B1  |    2   |     0.4723962  |      12.85456  |    103678.990  |  95.00  |
#| ^1B1  |    3   |     0.4844071  |      13.18139  |    106315.063  |  95.95  |
#+-----------------------------------------------------------------------------+
#| ^1B3  |    1   |     0.4104396  |      11.16863  |     90081.079  |  95.70  |
#| ^1B3  |    2   |     0.4723962  |      12.85456  |    103678.990  |  95.00  |
#| ^1B3  |    3   |     0.4844071  |      13.18139  |    106315.063  |  95.95  |
#+=============================================================================+
#
#
CRIT1=`$GREP "Total MP2-R12/B energy: *\-40\.387396217" $log | wc -l`
TEST[1]=`expr	$CRIT1`
CTRL[1]=2
ERROR[1]="MP2-R12/B ENERGY NOT CORRECT"
CRIT2=`$GREP "Total CC2-R12/B energy: *\-40\.388610020" $log | wc -l`
TEST[2]=`expr	$CRIT1`
CTRL[2]=2
ERROR[2]="CC2-R12/B ENERGY NOT CORRECT"
CRIT3=`$GREP "\^1A .* 13\.26154" $log | wc -l`
CRIT4=`$GREP "\^1A .* 14\.65621" $log | wc -l` 
TEST[3]=`expr   $CRIT3 \+ $CRIT4`
CTRL[3]=3
ERROR[3]="CC2-R12 Sym. A EXCITATION ENERGIES NOT CORRECT"
CRIT5=`$GREP "\^1B[123] .* 11\.25603" $log | wc -l`
CRIT6=`$GREP "\^1B[123] .* 13\.01874" $log | wc -l`
CRIT7=`$GREP "\^1B[123] .* 13\.26257" $log | wc -l`
TEST[4]=`expr   $CRIT5 \+ $CRIT6 \+ $CRIT7`
CTRL[4]=9
ERROR[4]="CC2-R12 Sym. B EXCITATION ENERGIES NOT CORRECT"
CRIT8=`$GREP "Total CCSD\(R12\)/B energy: *\-40\.4034406713" $log | wc -l`
TEST[5]=`expr   $CRIT8`
CTRL[5]=2
ERROR[5]="CCSD(R12)/B ENERGY NOT CORRECT"
CRIT9=`$GREP "\^1A .* 13\.12999" $log | wc -l`
CRIT10=`$GREP "\^1A .* 14\.64237" $log | wc -l`
TEST[6]=`expr   $CRIT9 \+ $CRIT10`
CTRL[6]=3
ERROR[6]="CCSD(R12) Sym. A EXCITATION ENERGIES NOT CORRECT"
CRIT11=`$GREP "\^1B[123] .* 11\.16863" $log | wc -l`
CRIT12=`$GREP "\^1B[123] .* 12\.85456" $log | wc -l`
CRIT13=`$GREP "\^1B[123] .* 13\.18139" $log | wc -l`
TEST[7]=`expr   $CRIT5 \+ $CRIT6 \+ $CRIT7`
CTRL[7]=9
ERROR[7]="CCSD(R12) Sym. B EXCITATION ENERGIES NOT CORRECT"

PASSED=1
for i in 1 2 3 4 5 6 7
do 
   if [ ${TEST[i]} -ne ${CTRL[i]} ]; then
     echo "${ERROR[i]} ( test = ${TEST[i]}; control = ${CTRL[i]} ); "
     PASSED=0
   fi
done 

if [ $PASSED -eq 1 ]
then
  echo TEST ENDED PROPERLY
  exit 0
else
  echo THERE IS A PROBLEM 
  exit 1
fi

