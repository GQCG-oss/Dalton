\chapter{Frozen density embedding}\label{ch:fde-embedding}

\index{frozen density embedding}\index{FDE}\index{environment model}\index{embedding model}\index{multiscale modeling}\index{embedding}\index{QM/QM}\index{quantum mechanics / quantum mechanics}\index{solvent effects}\index{enviroment effects}\index{subsystem DFT}

This chapter provides a brief outline of the frozen density embedding (FDE) approach and
the capabilities available in the \latestrelease\ release.  

\begin{center}
\fbox{
\parbox[h][\height][l]{12cm}{
\small
\noindent
{\bf Reference literature:}
\begin{list}{}{}
\item DFT-in-DFT/WFT-in-DFT with static potentials: A.~S.~P.~Gomes, C.~R.~Jacob, L.~Visscher, \newblock{\em Phys.~Chem.~Chem.~Phys.},{\bf 10}, 5353 (2008) 
\item PyADF for subsystem calculations:  C.~R.~Jacob {\em et al}, \newblock{\em J.~Comput.~Chem.},{\bf 32}, 2328 (2011) 
\item General subsystem response, FDE library code : S.~H\"ofener, A.~S.~P.~Gomes, L.~Visscher, \newblock {\em J.~Chem.~Phys.}, {\bf 139}, 044104 (2012).
\item (LR)CC-in-DFT excitation energies : S.~H\"ofener, A.~S.~P.~Gomes, L.~Visscher, \newblock {\em J.~Chem.~Phys.}, {\bf 139}, 104106 (2013).
\end{list}
}}
\end{center} 
\section{General considerations}
%!Note, that the current implementation
%does not support point-group symmetry or analytical molecular gradients and Hessians.

The current implementation is restricted to only (a) the import of a static (thus precalculated
with another code, such as ADF, Dirac, PyADF etc) embedding potential and (b) the export of the 
electron densities (and its first and second derivatives) and electrostatic potentials for the 
system for which the calculations were perfomed, both on suitable integration grids. One should note
these grids can be different from one another, and .

In case (a) the embedding potential is treated as any other one-electron operator and added to the
one-electron part of the Fock matrix, so it may be included in any of the wavefunctions types
available in {\dalton}. 

This simple approach has been shown to work fairly well for certain linear response properties, such as 
excitation energies insofar as they are well-localized on the subsystem of interest\textcolor{red}{pccp2013,JCP2012, JCP2013},
and should provide a quantitatively correct picture for such situations.

That said, one should keep in mind that other contributions are important as well. One is the response of the embedding potential 
to external perturbations for the system of interest -- which in the LR case introduces second-order contributions analogous 
to the exchange-correlation kernel in TDDDFT calculations to the electronic Hessian, and to the property gradient in the 
case of perturbation-dependent bases (e.g. in NMR shieldings or magnetizabilities). Another is the electronic coupling 
between subsystems (here the subsystem of interest and the environment). These contributions will be made available in future 
releases.

In case (b), the quantities which are exported are the ingredients for the calculation of the embedding potential with
external codes (PyADF, Dirac, ADF). 

\section{Input description}

All FDE input is controlled through the \Sec{*DALTON} section and \Sec{*FDE} subsection (see input options in 
Chapter~\ref{ch:general} under the \Sec{FDE} input section (subsection~\ref{subsec:fde} for the complete list of 
allowed kewords), so the following input description is relevant for all wavefunctions types, and all other 
specifications of wave function, properties etc.\ remain unchanged and thus follow the input described in 
other chapters. 


The simplest type of calculation is perfomed with only a static embedding potential. For example, 
for a FDE-HF wave function for the ground state would require:
\begin{verbatim}
**DALTON
.RUN WAVE FUNCTIONS
.FDE
**WAVE FUNCTIONS
.HF
**END OF DALTON
\end{verbatim}
To modify the default options, a \Sec{*FDE} subsection is needed within the Sec{*DALTON} section.
As one can see in Chapter~\ref{ch:general} under the \Sec{FDE} input section (subsection~\ref{subsec:fde}),
one can import an embedding potential contained in a file with a non-standard (EMBPOT) name, for instance
with: 
\begin{verbatim}
**DALTON
.RUN WAVE FUNCTIONS
.FDE
*FDE
vemb
**WAVE FUNCTIONS
.HF
**END OF DALTON
\end{verbatim}
The export of electrostatic potential and electron densities can be made, for instance, via the
input:
\begin{verbatim}
**DALTON
.RUN WAVE FUNCTIONS
.FDE
*FDE
vemb
.GRIDOUT
embout
.LEVEL
HF
**WAVE FUNCTIONS
.HF
**END OF DALTON
\end{verbatim}
where apart from the keyword to specify the output grid filename (.GRIDOUT), one may choose the level of theory with which to
obtain these quantities (.LEVEL).  

Section~\ref{sec:daltoninp} in Chapter~\ref{ch:starting} provides an introduction to the \dalton\ (and \molinp) 
input in general. The format of the \molinp\ file is described in detail in \ref{ch:molinp} and requires no
changes in a FDE calculation. 

However, one must be careful if point group symmetry is exploited: while the code will be able to exploit point group 
symmetry in the construction of Fock matrices etc, at present it cannot verify whether the symmetry requested is 
compatible with that of the total system for which the embedding potential has been calculated, or whether  
the orientation of the subsystem of interest in {\dalton} and that of the (total) system used when generating the import 
and export grids coincide. It is therefore up to the user to ensure the different components are consistent
when symmetry is used, or disable it altogether, at the risk of producing meaningless results if such care is not
taken.

