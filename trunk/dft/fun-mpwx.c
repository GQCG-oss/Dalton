/*-*-mode: C; c-indentation-style: "bsd"; c-basic-offset: 4; -*-*/
/* fun-mpwx.c:

   Automatically generated code implementing MPWX functional and
   its derivatives. It is generated by func-codegen.pl being a part of
   a "Automatic code generation framework for analytical functional
   derivative evaluation", Pawel Salek, 2005

    This functional is connected by making following changes:
    1. add "extern Functional mpwxFunctional;" to 'functionals.h'
    2. add "&mpwxFunctional," to 'functionals.c'
    3. add "fun-mpwx.c" to 'Makefile.am', 'Makefile.in' or 'Makefile'.

   mPWx exchange functional (actually gradient correction, for full
   exchange functional, mPWx + Slater)

   Implemented by David Wilson (david.wilson@latrobe.edu.au).
   Sept 2007

   NOTE: The original Adamo/Barone JCP reference had a typo [1] as published in [2].
   (i) b is 0.00426, not 0.0046 as originally published
   (ii) exponent (d) is 3.72, not 3.73. 
 
   References
   [1] C. Adamo and V. Barone, J. Chem. Phys., 108, 664-675 (1998).
   [2] Y. Zhao and D. G. Truhlar, J. Phys. Chem. A, 109, 5656-5667 (2005).


    This functional has been generated from following input:
    ------ cut here -------
rho:  rhoa + rhob;
grad: sqrt(grada*grada + gradb*gradb + 2*gradab);
zeta: (rhoa-rhob)/(rhoa+rhob);

Ax:    -3.0/4.0*((6.0/%PI)^(1/3));
Axinv: 1.0/Ax;
bb:    0.00426;
beta:  5*((36*%PI)^(-5/3));
cc:    1.6455;
dd:    3.72;
em6:   10^(-6);
bmb:   bb-beta;

xa:    grada*rhoa^(-4/3);
xb:    gradb*rhob^(-4/3);
xa2:   xa^2;
xb2:   xb^2;
xad:   xa^(dd);
xbd:   xb^(dd);

F0a:   bb*xa^2-bmb*xa^2*exp(-cc*xa^2)-em6*xad;
F0b:   bb*xb^2-bmb*xb^2*exp(-cc*xb^2)-em6*xbd;
F1a:   1+6*bb*xa*asinh(xa)-em6*xad*Axinv;
F1b:   1+6*bb*xb*asinh(xb)-em6*xbd*Axinv;
Exa:   rhoa^(4.0/3.0)*F0a/F1a;
Exb:   rhob^(4.0/3.0)*F0b/F1b;

K(rhoa,rhob,grada,gradb,gradab):=-(Exa+Exb);




    ------ cut here -------
*/

 
/* strictly conform to XOPEN ANSI C standard */
#if !defined(SYS_DEC)
/* XOPEN compliance is missing on old Tru64 4.0E Alphas and pow() prototype
 * is not specified. */
#define _XOPEN_SOURCE          500
#define _XOPEN_SOURCE_EXTENDED 1
#endif
#include <math.h>
#include <stddef.h>
 
#define __CVERSION__
 
#include "functionals.h"
 
/* INTERFACE PART */
static int mpwx_isgga(void) { return 1; } /* FIXME: detect! */
static int mpwx_read(const char *conf_line);
static real mpwx_energy(const FunDensProp* dp);
static void mpwx_first(FunFirstFuncDrv *ds,   real factor,
                         const FunDensProp* dp);
static void mpwx_second(FunSecondFuncDrv *ds, real factor,
                          const FunDensProp* dp);
static void mpwx_third(FunThirdFuncDrv *ds,   real factor,
                         const FunDensProp* dp);
static void mpwx_fourth(FunFourthFuncDrv *ds,   real factor,
                          const FunDensProp* dp);
 
Functional mPWxFunctional = {
  "mPWx",       /* name */
  mpwx_isgga,   /* gga-corrected */
  mpwx_read,
  NULL,
  mpwx_energy,
  mpwx_first,
  mpwx_second,
  mpwx_third,
  mpwx_fourth
};
 
/* IMPLEMENTATION PART */
static int
mpwx_read(const char *conf_line)
{
    fun_set_hf_weight(0);
    return 1;
}

static real
mpwx_energy(const FunDensProp *dp)
{
    real res;
    real rhoa = dp->rhoa, rhob = dp->rhob;
    real grada = dp->grada, gradb = dp->gradb, gradab = dp->gradab;

    real t1, t2, t3, t4, t5, t6, t7, t8, t9, t10;
    real t11, t12;

    t1 = pow(3.141592653589793,0.333333333333333);
    t2 = 1/pow(rhoa,1.333333333333333);
    t3 = grada*t2;
    t4 = pow(t3,3.72);
    t5 = pow(grada,2.0);
    t6 = 1/pow(rhoa,2.666666666666667);
    t7 = 0.00426-0.138888888888889/(pow(3.141592653589793,
        1.666666666666667)*pow(36.0,0.666666666666667));
    t8 = 1/pow(rhob,1.333333333333333);
    t9 = gradb*t8;
    t10 = pow(t9,3.72);
    t11 = pow(gradb,2.0);
    t12 = 1/pow(rhob,2.666666666666667);

   /* code */
    res = -1.0*(-1.0*t11*t12*t7/pow(2.718281828459045,1.6455*
        t11*t12)+0.00426*t11*t12-1.0E-6*t10)*pow(rhob,1.333333333333333)/
        (0.02556*gradb*asinh(t9)*t8+7.337616108654726E-7*t1*t10+1.0)-
        1.0*(-1.0*t5*t6*t7/pow(2.718281828459045,1.6455*t5*t6)+0.00426*
        t5*t6-1.0E-6*t4)*pow(rhoa,1.333333333333333)/(7.337616108654726E-7*
        t1*t4+0.02556*grada*asinh(t3)*t2+1.0);

    return res;
}

static void
mpwx_first_helper(real rhoa, real grada, real *res)
{    real t1, t2, t3, t4, t5, t6, t7, t8, t9, t10;
    real t11, t12, t13, t14, t15, t16, t17, t18;
    real t19;

    t1 = pow(3.141592653589793,0.333333333333333);
    t2 = 1/pow(rhoa,1.333333333333333);
    t3 = grada*t2;
    t4 = pow(t3,3.72);
    t5 = asinh(t3);
    t6 = 7.337616108654726E-7*t1*t4+0.02556*grada*t5*t2+1.0;
    t7 = 1/
        t6;
    t8 = pow(grada,2.0);
    t9 = 1/pow(rhoa,2.666666666666667);
    t10 = 0.00426-0.138888888888889/(pow(3.141592653589793,
        1.666666666666667)*pow(36.0,0.666666666666667));
    t11 = 1/pow(2.718281828459045,1.6455*t8*t9);
    t12 = -1.0*t10*t11*t8*t9+0.00426*t8*t9-1.0E-6*t4;
    t13 = 1/sqrt(t8*t9+1.0);
    t14 = 1/pow(rhoa,3.666666666666667);
    t15 = 1/pow(rhoa,2.333333333333333);
    t16 = 1/pow(t6,2.0);
    t17 = pow(rhoa,1.333333333333333);
    t18 = 1/pow(fabs(rhoa),3.626666666666667);
    t19 = pow(grada,2.72);

   /* code */
    res[0] = -1.0*t17*t7*(-4.388*t10*t11*pow(grada,4.0)/pow(rhoa,
        6.333333333333333)+4.96E-6*t15*t18*pow(grada,3.72)+2.666666666666667*
        t10*t11*t14*t8-0.01136*t8*t14)-1.333333333333333*t12*t7*pow(rhoa,
        0.333333333333333)+t12*t16*t17*(-3.639457589892744E-6*t1*t15*
        pow(t3,2.72)*grada-0.03408*grada*t5*t15-0.03408*t8*t13*t14);
    res[1] = t16*t17*t12*(2.729593192419558E-6*t1*t19*t2*
        t18+0.02556*t5*t2+0.02556*grada*t13*t9)-1.0*t17*t7*(3.291*
        t10*t11*pow(grada,3.0)/pow(rhoa,5.333333333333333)-2.0*t10*
        t11*t9*grada+0.00852*grada*t9-3.72E-6*t19*t2*t18);
}

static void
mpwx_first(FunFirstFuncDrv *ds, real factor, const FunDensProp *dp)
{
    real res[2];

    mpwx_first_helper(dp->rhoa, dp->grada, res);
   /* Final assignment */
    ds->df1000 += factor*res[0];
    ds->df0010 += factor*res[1];


    if(fabs(dp->rhoa-dp->rhob)>1e-13 ||
       fabs(dp->grada-dp->gradb)>1e-13)
        mpwx_first_helper(dp->rhob, dp->gradb, res);
    ds->df0100 += factor*res[0];
    ds->df0001 += factor*res[1];

}

static void
mpwx_second_helper(real rhoa, real grada, real *res)
{
    real t1, t2, t3, t4, t5, t6, t7, t8, t9, t10;
    real t11, t12, t13, t14, t15, t16, t17, t18;
    real t19, t20, t21, t22, t23, t24, t25, t26;
    real t27, t28, t29, t30, t31, t32, t33, t34;
    real t35, t36, t37, t38, t39, t40;

    t1 = pow(3.141592653589793,0.333333333333333);
    t2 = 1/pow(rhoa,1.333333333333333);
    t3 = grada*t2;
    t4 = pow(t3,3.72);
    t5 = asinh(t3);
    t6 = 7.337616108654726E-7*t1*t4+0.02556*grada*t5*t2+1.0;
    t7 = 1/
        t6;
    t8 = pow(rhoa,0.333333333333333);
    t9 = pow(grada,2.0);
    t10 = 1/pow(rhoa,2.666666666666667);
    t11 = 0.00426-0.138888888888889/(pow(3.141592653589793,
        1.666666666666667)*pow(36.0,0.666666666666667));
    t12 = 1/pow(2.718281828459045,1.6455*t9*t10);
    t13 = -1.0*t10*t11*t12*t9-1.0E-6*t4+0.00426*t9*t10;
    t14 = sqrt(t9*
        t10+1.0);
    t15 = 1/t14;
    t16 = 1/pow(rhoa,3.666666666666667);
    t17 = -0.03408*t9*t15*t16;
    t18 = 1/pow(rhoa,2.333333333333333);
    t19 = -0.03408*grada*t5*t18;
    t20 = 1/pow(t6,2.0);
    t21 = pow(rhoa,1.333333333333333);
    t22 = pow(grada,4.0);
    t23 = 1/pow(rhoa,6.333333333333333);
    t24 = pow(grada,3.72);
    t25 = fabs(rhoa);
    t26 = 1/pow(t25,3.626666666666667);
    t27 = 2.666666666666667*t11*t12*t16*t9+4.96E-6*t24*t18*
        t26-0.01136*t9*t16-4.388*t11*t22*t23*t12;
    t28 = pow(grada,3.0);
    t29 = 1/pow(rhoa,5.333333333333333);
    t30 = pow(grada,2.72);
    t31 = -2.0*t10*t11*t12*grada-3.72E-6*t30*t2*t26+3.291*
        t11*t28*t29*t12+0.00852*grada*t10;
    t32 = 2.729593192419558E-6*t1*t30*t2*t26+0.02556*t5*t2+
        0.02556*grada*t15*t10;
    t33 = 1/pow(rhoa,4.666666666666667);
    t34 = 1/pow(rhoa,7.333333333333333);
    t35 = 1/pow(t25,5.626666666666667);
    t36 = 1/pow(rhoa,3.333333333333333);
    t37 = 1/pow(t14,3.0);
    t38 = -3.639457589892744E-6*t1*t24*t18*t26+t19+t17;
    t39 = 1/
        pow(t6,3.0);
    t40 = pow(grada,1.72);

   /* code */
    res[0] = t13*t20*t21*(-3.639457589892744E-6*t1*t18*pow(t3,
        2.72)*grada+t19+t17)-1.0*t21*t27*t7-1.333333333333333*t7*t8*
        t13;
    res[1] = t20*t21*t13*t32-1.0*t21*t31*t7;
    res[2] = -1.0*t21*t7*(-19.254544*t11*t12*pow(grada,6.0)/
        pow(rhoa,10.0)-9.777777777777779*t11*t12*t33*t9-1.798826666666667E-5*
        t24*t2*t35+0.041653333333333*t9*t33-1.1573333333333333E-5*
        t24*t36*t26+39.492*t11*t22*t34*t12)-0.444444444444444*t13*
        t7/pow(rhoa,0.666666666666667)-2.0*t13*t21*pow(t38,2.0)*t39+
        2.0*t20*t21*t27*t38+2.666666666666667*t20*t8*t13*t38-2.666666666666667*
        t7*t8*t27+t20*t21*t13*(8.492067709749736E-6*t1*t24*t36*t26+
        1.3199099526011019E-5*t1*t24*t2*t35+0.07952*grada*t5*t36+0.1704*
        t9*t15*t33-0.04544*t22*t37*t34);
    res[3] = -1.0*t21*t7*(14.440908*t11*t12*pow(grada,5.0)/
        pow(rhoa,9.0)+5.333333333333333*t11*t12*t16*grada+1.84512E-5*
        t30*t18*t26-0.02272*grada*t16-26.328*t11*t28*t23*t12)-2.0*
        t13*t21*t32*t38*t39+t20*t21*t27*t32+1.333333333333333*t20*
        t8*t13*t32-1.333333333333333*t7*t8*t31+t20*t21*t38*t31+t20*
        t21*t13*(-1.3538782234401007E-5*t1*t30*t18*t26-0.03408*t5*
        t18-0.10224*grada*t15*t16+0.03408*t28*t37*t23);
    res[4] = -1.0*t21*t7*(-10.830681*t11*t12*t22/pow(rhoa,
        8.0)-1.0118400000000001E-5*t40*t2*t26+16.455*t11*t9*t29*t12-
        2.0*t10*t11*t12+0.00852*t10)-2.0*t13*t21*pow(t32,2.0)*t39+
        2.0*t20*t21*t31*t32+t20*t21*t13*(7.424493483381199E-6*t1*t40*
        t2*t26+0.05112*t15*t10-0.02556*t9*t37*t29);

}

static void
mpwx_second(FunSecondFuncDrv *ds, real factor, const FunDensProp* dp)
{
    real res[5];
 
    mpwx_second_helper(dp->rhoa, dp->grada, res);

    ds->df1000 += factor*res[0];
    ds->df0010 += factor*res[1];

    ds->df2000 += factor*res[2];
    ds->df1010 += factor*res[3];
    ds->df0020 += factor*res[4];


    if(fabs(dp->rhoa-dp->rhob)>1e-13 ||
       fabs(dp->grada-dp->gradb)>1e-13)
        mpwx_second_helper(dp->rhob, dp->gradb, res);
    ds->df0100 += factor*res[0];
    ds->df0001 += factor*res[1];

    ds->df0200 += factor*res[2];
    ds->df0101 += factor*res[3];
    ds->df0002 += factor*res[4];

}

static void
mpwx_third_helper(real rhoa, real grada, real *res)
{
    real t1, t2, t3, t4, t5, t6, t7, t8, t9, t10;
    real t11, t12, t13, t14, t15, t16, t17, t18;
    real t19, t20, t21, t22, t23, t24, t25, t26;
    real t27, t28, t29, t30, t31, t32, t33, t34;
    real t35, t36, t37, t38, t39, t40, t41, t42;
    real t43, t44, t45, t46, t47, t48, t49, t50;
    real t51, t52, t53, t54, t55, t56, t57, t58;
    real t59, t60, t61, t62, t63;

    t1 = pow(3.141592653589793,0.333333333333333);
    t2 = 1/pow(rhoa,1.333333333333333);
    t3 = grada*t2;
    t4 = pow(t3,3.72);
    t5 = asinh(t3);
    t6 = 7.337616108654726E-7*t1*t4+0.02556*grada*t5*t2+1.0;
    t7 = 1/
        t6;
    t8 = pow(rhoa,0.333333333333333);
    t9 = pow(grada,2.0);
    t10 = 1/pow(rhoa,2.666666666666667);
    t11 = 0.00426-0.138888888888889/(pow(3.141592653589793,
        1.666666666666667)*pow(36.0,0.666666666666667));
    t12 = 1/pow(2.718281828459045,1.6455*t9*t10);
    t13 = -1.0*t10*t11*t12*t9-1.0E-6*t4+0.00426*t9*t10;
    t14 = sqrt(t9*
        t10+1.0);
    t15 = 1/t14;
    t16 = 1/pow(rhoa,3.666666666666667);
    t17 = -0.03408*t9*t15*t16;
    t18 = 1/pow(rhoa,2.333333333333333);
    t19 = -0.03408*grada*t5*t18;
    t20 = 1/pow(t6,2.0);
    t21 = pow(rhoa,1.333333333333333);
    t22 = pow(grada,4.0);
    t23 = 1/pow(rhoa,6.333333333333333);
    t24 = pow(grada,3.72);
    t25 = fabs(rhoa);
    t26 = 1/pow(t25,3.626666666666667);
    t27 = 2.666666666666667*t11*t12*t16*t9+4.96E-6*t24*t18*
        t26-0.01136*t9*t16-4.388*t11*t22*t23*t12;
    t28 = pow(grada,3.0);
    t29 = 1/pow(rhoa,5.333333333333333);
    t30 = pow(grada,2.72);
    t31 = -2.0*t10*t11*t12*grada-3.72E-6*t30*t2*t26+3.291*
        t11*t28*t29*t12+0.00852*grada*t10;
    t32 = 2.729593192419558E-6*t1*t30*t2*t26+0.02556*t5*t2+
        0.02556*grada*t15*t10;
    t33 = 1/pow(rhoa,0.666666666666667);
    t34 = 1/pow(rhoa,4.666666666666667);
    t35 = pow(grada,6.0);
    t36 = 1/pow(rhoa,10.0);
    t37 = 1/pow(rhoa,7.333333333333333);
    t38 = 1/pow(t25,5.626666666666667);
    t39 = 1/pow(rhoa,3.333333333333333);
    t40 = -9.777777777777779*t11*t12*t34*t9-1.798826666666667E-5*
        t24*t2*t38+0.041653333333333*t9*t34-1.1573333333333333E-5*
        t24*t39*t26+39.492*t11*t22*t37*t12-19.254544*t11*t35*t36*t12;
    t41 = 1/
        pow(t14,3.0);
    t42 = 8.492067709749736E-6*t1*t24*t39*t26+1.3199099526011019E-5*
        t1*t24*t2*t38+0.07952*grada*t5*t39+0.1704*t9*t15*t34-0.04544*
        t22*t41*t37;
    t43 = -3.639457589892744E-6*t1*t24*t18*t26+t19+t17;
    t44 = 1/
        pow(t6,3.0);
    t45 = pow(t43,2.0);
    t46 = pow(grada,5.0);
    t47 = 1/pow(rhoa,9.0);
    t48 = 5.333333333333333*t11*t12*t16*grada+1.84512E-5*
        t30*t18*t26-0.02272*grada*t16+14.440908*t11*t46*t47*t12-26.328*
        t11*t28*t23*t12;
    t49 = -1.3538782234401007E-5*t1*t30*t18*t26-0.03408*t5*
        t18-0.10224*grada*t15*t16+0.03408*t28*t41*t23;
    t50 = 1/pow(rhoa,8.0);
    t51 = pow(grada,1.72);
    t52 = -1.0118400000000001E-5*t51*t2*t26-10.830681*t11*
        t22*t50*t12+16.455*t11*t9*t29*t12-2.0*t10*t11*t12+0.00852*
        t10;
    t53 = 7.424493483381199E-6*t1*t51*t2*t26+0.05112*t15*
        t10-0.02556*t9*t41*t29;
    t54 = pow(t32,2.0);
    t55 = 1/pow(rhoa,5.666666666666667);
    t56 = 1/pow(rhoa,11.0);
    t57 = 1/pow(rhoa,8.333333333333334);
    t58 = 1/pow(rhoa,0.333333333333333);
    t59 = 1/pow(t25,7.626666666666667);
    t60 = 1/pow(rhoa,4.333333333333333);
    t61 = 1/pow(t14,5.0);
    t62 = 1/pow(t6,4.0);
    t63 = pow(grada,0.72);

   /* code */
    res[0] = t13*t20*t21*(-3.639457589892744E-6*t1*t18*pow(t3,
        2.72)*grada+t19+t17)-1.0*t21*t27*t7-1.333333333333333*t7*t8*
        t13;
    res[1] = t20*t21*t13*t32-1.0*t21*t31*t7;
    res[2] = -1.0*t21*t40*t7-2.0*t13*t21*t44*t45+2.0*t20*
        t21*t27*t43+2.666666666666667*t20*t8*t13*t43+t20*t21*t13*t42-
        2.666666666666667*t7*t8*t27-0.444444444444444*t7*t33*t13;
    res[3] = -1.0*t21*t48*t7+t20*t21*t13*t49-2.0*t13*t21*
        t32*t43*t44+t20*t21*t27*t32+1.333333333333333*t20*t8*t13*t32-
        1.333333333333333*t7*t8*t31+t20*t21*t43*t31;
    res[4] = -1.0*t21*t52*t7-2.0*t13*t21*t44*t54+t20*t21*
        t13*t53+2.0*t20*t21*t31*t32;
    res[5] = -1.0*t21*t7*(-84.488939072*t11*t12*pow(grada,
        8.0)/pow(rhoa,13.66666666666667)+45.62962962962963*t11*t12*
        t55*t9+1.0121398044444446E-4*t24*t58*t59-0.194382222222222*
        t9*t55+6.595697777777779E-5*t24*t18*t38+3.857777777777778E-5*
        t24*t60*t26-332.5128888888888*t11*t22*t57*t12+365.836336*t11*
        t35*t56*t12)+0.296296296296296*t13*t7/pow(rhoa,1.666666666666667)+
        6.0*t13*t21*pow(t43,3.0)*t62-6.0*t21*t27*t44*t45-8.0*t44*t8*
        t13*t45-6.0*t13*t21*t42*t43*t44+3.0*t20*t21*t40*t43+8.0*t20*
        t8*t27*t43+1.333333333333333*t20*t33*t13*t43+3.0*t20*t21*t27*
        t42+4.0*t20*t8*t13*t42-4.0*t7*t8*t40-1.333333333333333*t7*
        t33*t27+t20*t21*t13*(-2.8306892365832456E-5*t1*t24*t60*t26-
        4.83966982620404E-5*t1*t24*t18*t38-7.4266933333022E-5*t1*t24*
        t58*t59-0.265066666666667*grada*t5*t60-0.901226666666667*t9*
        t15*t55+0.560426666666667*t22*t41*t57-0.18176*t35*t61*t56);
    res[6] = -1.0*t21*t7*(63.366704304*t11*t12*pow(grada,
        7.0)/pow(rhoa,12.66666666666667)-19.55555555555556*t11*t12*
        t34*grada-6.691635200000001E-5*t30*t2*t38+0.083306666666667*
        grada*t34-4.30528E-5*t30*t39*t26+190.1466666666666*t11*t28*
        t37*t12-245.495436*t11*t46*t36*t12)+6.0*t13*t21*t32*t45*t62-
        4.0*t13*t21*t43*t44*t49+2.0*t20*t21*t27*t49+2.666666666666667*
        t20*t8*t13*t49-2.666666666666667*t7*t8*t48+2.0*t20*t21*t43*
        t48-2.0*t21*t31*t44*t45-4.0*t21*t27*t32*t43*t44-2.0*t13*t21*
        t32*t42*t44-5.333333333333333*t44*t8*t13*t43*t32+t20*t21*t40*
        t32+2.666666666666667*t20*t8*t27*t32+0.444444444444444*t20*
        t33*t13*t32+2.666666666666667*t20*t8*t43*t31+t20*t21*t42*t31-
        0.444444444444444*t7*t33*t31+t20*t21*t13*(3.159049188026902E-5*
        t1*t30*t39*t26+4.910065023676099E-5*t1*t30*t2*t38+0.07952*
        t5*t39+0.42032*grada*t15*t34-0.35216*t28*t41*t37+0.13632*t46*
        t61*t36);
    res[7] = -1.0*t21*t7*(-47.525028228*t11*t12*t35/pow(rhoa,
        11.66666666666667)+5.018726400000001E-5*t51*t18*t26+5.333333333333333*
        t11*t12*t16-0.02272*t16+158.849988*t11*t22*t47*t12-96.536*
        t11*t9*t23*t12)+6.0*t13*t21*t43*t54*t62-2.0*t21*t27*t44*t54-
        2.666666666666667*t44*t8*t13*t54-2.0*t13*t21*t43*t44*t53+t20*
        t21*t27*t53+1.333333333333333*t20*t8*t13*t53-1.333333333333333*
        t7*t8*t52+t20*t21*t43*t52-4.0*t13*t21*t32*t44*t49+2.0*t20*
        t21*t31*t49+2.0*t20*t21*t32*t48-4.0*t21*t31*t32*t43*t44+2.666666666666667*
        t20*t8*t31*t32+t20*t21*t13*(-3.682548767757074E-5*t1*t51*t18*
        t26-0.13632*t15*t16+0.20448*t9*t41*t23-0.10224*t22*t61*t47);
    res[8] = -1.0*t21*t7*(35.643771171*t11*t12*t46/pow(rhoa,
        10.66666666666667)-1.7403648000000005E-5*t63*t2*t26-97.47612899999999*
        t11*t28*t50*t12+39.492*t11*grada*t29*t12)+6.0*t13*t21*pow(t32,
        3.0)*t62-6.0*t21*t31*t44*t54-6.0*t13*t21*t32*t44*t53+3.0*t20*
        t21*t31*t53+3.0*t20*t21*t32*t52+t20*t21*t13*(1.2770128791415663E-5*
        t1*t63*t2*t26-0.10224*grada*t41*t29+0.07668*t28*t61*t50);

}

static void
mpwx_third(FunThirdFuncDrv *ds, real factor, const FunDensProp* dp)
{
    real res[9];
 
    mpwx_third_helper(dp->rhoa, dp->grada, res);

    ds->df1000 += factor*res[0];
    ds->df0010 += factor*res[1];

    ds->df2000 += factor*res[2];
    ds->df1010 += factor*res[3];
    ds->df0020 += factor*res[4];

    ds->df3000 += factor*res[5];
    ds->df2010 += factor*res[6];
    ds->df1020 += factor*res[7];
    ds->df0030 += factor*res[8];


    if(fabs(dp->rhoa-dp->rhob)>1e-13 ||
       fabs(dp->grada-dp->gradb)>1e-13)
        mpwx_third_helper(dp->rhob, dp->gradb, res);

    ds->df0100 += factor*res[0];
    ds->df0001 += factor*res[1];

    ds->df0200 += factor*res[2];
    ds->df0101 += factor*res[3];
    ds->df0002 += factor*res[4];

    ds->df0300 += factor*res[5];
    ds->df0201 += factor*res[6];
    ds->df0102 += factor*res[7];
    ds->df0003 += factor*res[8];

}

static void
mpwx_fourth_helper(real rhoa, real grada, real *res)
{
    real t1, t2, t3, t4, t5, t6, t7, t8, t9, t10;
    real t11, t12, t13, t14, t15, t16, t17, t18;
    real t19, t20, t21, t22, t23, t24, t25, t26;
    real t27, t28, t29, t30, t31, t32, t33, t34;
    real t35, t36, t37, t38, t39, t40, t41, t42;
    real t43, t44, t45, t46, t47, t48, t49, t50;
    real t51, t52, t53, t54, t55, t56, t57, t58;
    real t59, t60, t61, t62, t63, t64, t65, t66;
    real t67, t68, t69, t70, t71, t72, t73, t74;
    real t75, t76, t77, t78, t79, t80, t81, t82;
    real t83, t84, t85, t86, t87, t88, t89;

    t1 = pow(3.141592653589793,0.333333333333333);
    t2 = 1/pow(rhoa,1.333333333333333);
    t3 = grada*t2;
    t4 = pow(t3,3.72);
    t5 = asinh(t3);
    t6 = 7.337616108654726E-7*t1*t4+0.02556*grada*t5*t2+1.0;
    t7 = 1/
        t6;
    t8 = pow(rhoa,0.333333333333333);
    t9 = pow(grada,2.0);
    t10 = 1/pow(rhoa,2.666666666666667);
    t11 = 0.00426-0.138888888888889/(pow(3.141592653589793,
        1.666666666666667)*pow(36.0,0.666666666666667));
    t12 = 1/pow(2.718281828459045,1.6455*t9*t10);
    t13 = -1.0*t10*t11*t12*t9-1.0E-6*t4+0.00426*t9*t10;
    t14 = sqrt(t9*
        t10+1.0);
    t15 = 1/t14;
    t16 = 1/pow(rhoa,3.666666666666667);
    t17 = -0.03408*t9*t15*t16;
    t18 = 1/pow(rhoa,2.333333333333333);
    t19 = -0.03408*grada*t5*t18;
    t20 = 1/pow(t6,2.0);
    t21 = pow(rhoa,1.333333333333333);
    t22 = pow(grada,4.0);
    t23 = 1/pow(rhoa,6.333333333333333);
    t24 = pow(grada,3.72);
    t25 = fabs(rhoa);
    t26 = 1/pow(t25,3.626666666666667);
    t27 = 2.666666666666667*t11*t12*t16*t9+4.96E-6*t24*t18*
        t26-0.01136*t9*t16-4.388*t11*t22*t23*t12;
    t28 = pow(grada,3.0);
    t29 = 1/pow(rhoa,5.333333333333333);
    t30 = pow(grada,2.72);
    t31 = -2.0*t10*t11*t12*grada-3.72E-6*t30*t2*t26+3.291*
        t11*t28*t29*t12+0.00852*grada*t10;
    t32 = 2.729593192419558E-6*t1*t30*t2*t26+0.02556*t5*t2+
        0.02556*grada*t15*t10;
    t33 = 1/pow(rhoa,0.666666666666667);
    t34 = 1/pow(rhoa,4.666666666666667);
    t35 = pow(grada,6.0);
    t36 = 1/pow(rhoa,10.0);
    t37 = 1/pow(rhoa,7.333333333333333);
    t38 = 1/pow(t25,5.626666666666667);
    t39 = 1/pow(rhoa,3.333333333333333);
    t40 = -9.777777777777779*t11*t12*t34*t9-1.798826666666667E-5*
        t24*t2*t38+0.041653333333333*t9*t34-1.1573333333333333E-5*
        t24*t39*t26+39.492*t11*t22*t37*t12-19.254544*t11*t35*t36*t12;
    t41 = 1/
        pow(t14,3.0);
    t42 = 8.492067709749736E-6*t1*t24*t39*t26+1.3199099526011019E-5*
        t1*t24*t2*t38+0.07952*grada*t5*t39+0.1704*t9*t15*t34-0.04544*
        t22*t41*t37;
    t43 = -3.639457589892744E-6*t1*t24*t18*t26+t19+t17;
    t44 = 1/
        pow(t6,3.0);
    t45 = pow(t43,2.0);
    t46 = pow(grada,5.0);
    t47 = 1/pow(rhoa,9.0);
    t48 = 5.333333333333333*t11*t12*t16*grada+1.84512E-5*
        t30*t18*t26-0.02272*grada*t16+14.440908*t11*t46*t47*t12-26.328*
        t11*t28*t23*t12;
    t49 = -1.3538782234401007E-5*t1*t30*t18*t26-0.03408*t5*
        t18-0.10224*grada*t15*t16+0.03408*t28*t41*t23;
    t50 = 1/pow(rhoa,8.0);
    t51 = pow(grada,1.72);
    t52 = -1.0118400000000001E-5*t51*t2*t26-10.830681*t11*
        t22*t50*t12+16.455*t11*t9*t29*t12-2.0*t10*t11*t12+0.00852*
        t10;
    t53 = 7.424493483381199E-6*t1*t51*t2*t26+0.05112*t15*
        t10-0.02556*t9*t41*t29;
    t54 = pow(t32,2.0);
    t55 = 1/pow(rhoa,1.666666666666667);
    t56 = 1/pow(rhoa,5.666666666666667);
    t57 = pow(grada,8.0);
    t58 = 1/pow(rhoa,13.66666666666667);
    t59 = 1/pow(rhoa,11.0);
    t60 = 1/pow(rhoa,8.333333333333334);
    t61 = 1/pow(rhoa,0.333333333333333);
    t62 = 1/pow(t25,7.626666666666667);
    t63 = 1/pow(rhoa,4.333333333333333);
    t64 = 45.62962962962963*t11*t12*t56*t9+1.0121398044444446E-4*
        t24*t61*t62-0.194382222222222*t9*t56+6.595697777777779E-5*
        t24*t18*t38+3.857777777777778E-5*t24*t63*t26-332.5128888888888*
        t11*t22*t60*t12+365.836336*t11*t35*t59*t12-84.488939072*t11*
        t57*t58*t12;
    t65 = 1/pow(t14,5.0);
    t66 = -2.8306892365832456E-5*t1*t24*t63*t26-4.83966982620404E-5*
        t1*t24*t18*t38-7.4266933333022E-5*t1*t24*t61*t62-0.265066666666667*
        grada*t5*t63-0.901226666666667*t9*t15*t56+0.560426666666667*
        t22*t41*t60-0.18176*t35*t65*t59;
    t67 = 1/pow(t6,4.0);
    t68 = pow(t43,3.0);
    t69 = pow(grada,7.0);
    t70 = 1/pow(rhoa,12.66666666666667);
    t71 = -19.55555555555556*t11*t12*t34*grada-6.691635200000001E-5*
        t30*t2*t38+0.083306666666667*grada*t34-4.30528E-5*t30*t39*
        t26+63.366704304*t11*t69*t70*t12+190.1466666666666*t11*t28*
        t37*t12-245.495436*t11*t46*t36*t12;
    t72 = 3.159049188026902E-5*t1*t30*t39*t26+4.910065023676099E-5*
        t1*t30*t2*t38+0.07952*t5*t39+0.42032*grada*t15*t34-0.35216*
        t28*t41*t37+0.13632*t46*t65*t36;
    t73 = 1/pow(rhoa,11.66666666666667);
    t74 = 5.018726400000001E-5*t51*t18*t26+5.333333333333333*
        t11*t12*t16-0.02272*t16-47.525028228*t11*t35*t73*t12+158.849988*
        t11*t22*t47*t12-96.536*t11*t9*t23*t12;
    t75 = -3.682548767757074E-5*t1*t51*t18*t26-0.13632*t15*
        t16+0.20448*t9*t41*t23-0.10224*t22*t65*t47;
    t76 = 1/pow(rhoa,10.66666666666667);
    t77 = pow(grada,0.72);
    t78 = -1.7403648000000005E-5*t77*t2*t26+39.492*t11*grada*
        t29*t12-97.47612899999999*t11*t28*t50*t12+35.643771171*t11*
        t46*t76*t12;
    t79 = 1.2770128791415663E-5*t1*t77*t2*t26-0.10224*grada*
        t41*t29+0.07668*t28*t65*t50;
    t80 = pow(t32,3.0);
    t81 = 1/pow(rhoa,6.666666666666667);
    t82 = 1/pow(rhoa,14.66666666666667);
    t83 = 1/pow(rhoa,12.0);
    t84 = 1/pow(rhoa,9.333333333333334);
    t85 = pow(rhoa,0.666666666666667);
    t86 = 1/pow(t25,9.626666666666667);
    t87 = 1/pow(t14,7.0);
    t88 = 1/pow(t6,5.0);
    t89 = 1/pow(grada,0.28);

   /* code */
    res[0] = t13*t20*t21*(-3.639457589892744E-6*t1*t18*pow(t3,
        2.72)*grada+t19+t17)-1.0*t21*t27*t7-1.333333333333333*t7*t8*
        t13;
    res[1] = t20*t21*t13*t32-1.0*t21*t31*t7;
    res[2] = -1.0*t21*t40*t7-2.0*t13*t21*t44*t45+2.0*t20*
        t21*t27*t43+2.666666666666667*t20*t8*t13*t43+t20*t21*t13*t42-
        2.666666666666667*t7*t8*t27-0.444444444444444*t7*t33*t13;
    res[3] = -1.0*t21*t48*t7+t20*t21*t13*t49-2.0*t13*t21*
        t32*t43*t44+t20*t21*t27*t32+1.333333333333333*t20*t8*t13*t32-
        1.333333333333333*t7*t8*t31+t20*t21*t43*t31;
    res[4] = -1.0*t21*t52*t7-2.0*t13*t21*t44*t54+t20*t21*
        t13*t53+2.0*t20*t21*t31*t32;
    res[5] = -1.0*t21*t64*t7+6.0*t13*t21*t67*t68+t20*t21*
        t13*t66-6.0*t21*t27*t44*t45-8.0*t44*t8*t13*t45-6.0*t13*t21*
        t42*t43*t44+3.0*t20*t21*t40*t43+8.0*t20*t8*t27*t43+1.333333333333333*
        t20*t33*t13*t43+3.0*t20*t21*t27*t42+4.0*t20*t8*t13*t42-4.0*
        t7*t8*t40-1.333333333333333*t7*t33*t27+0.296296296296296*t7*
        t55*t13;
    res[6] = t20*t21*t13*t72-1.0*t21*t7*t71+6.0*t13*t21*t32*
        t45*t67-4.0*t13*t21*t43*t44*t49+2.0*t20*t21*t27*t49+2.666666666666667*
        t20*t8*t13*t49-2.666666666666667*t7*t8*t48+2.0*t20*t21*t43*
        t48-2.0*t21*t31*t44*t45-4.0*t21*t27*t32*t43*t44-2.0*t13*t21*
        t32*t42*t44-5.333333333333333*t44*t8*t13*t43*t32+t20*t21*t40*
        t32+2.666666666666667*t20*t8*t27*t32+0.444444444444444*t20*
        t33*t13*t32+2.666666666666667*t20*t8*t43*t31+t20*t21*t42*t31-
        0.444444444444444*t7*t33*t31;
    res[7] = t20*t21*t13*t75-1.0*t21*t7*t74+6.0*t13*t21*t43*
        t54*t67-2.0*t21*t27*t44*t54-2.666666666666667*t44*t8*t13*t54-
        2.0*t13*t21*t43*t44*t53+t20*t21*t27*t53+1.333333333333333*
        t20*t8*t13*t53-1.333333333333333*t7*t8*t52+t20*t21*t43*t52-
        4.0*t13*t21*t32*t44*t49+2.0*t20*t21*t31*t49+2.0*t20*t21*t32*
        t48-4.0*t21*t31*t32*t43*t44+2.666666666666667*t20*t8*t31*t32;
    res[8] = 6.0*t13*t21*t67*t80+t20*t21*t13*t79-1.0*t21*
        t7*t78-6.0*t21*t31*t44*t54-6.0*t13*t21*t32*t44*t53+3.0*t20*
        t21*t31*t53+3.0*t20*t21*t32*t52;
    res[9] = -1.0*t21*t7*(-370.737464647936*t11*t12*pow(grada,
        10.0)/pow(rhoa,17.33333333333333)-258.5679012345679*t11*t12*
        t81*t9-7.719252908562964E-4*t24*t85*t86+1.101499259259259*
        t9*t81-4.048559217777778E-4*t24*t2*t62-2.938083555555556E-4*
        t24*t39*t38-1.6717037037037035E-4*t24*t29*t26+2971.163555555555*
        t11*t22*t84*t12-5483.266252444444*t11*t35*t83*t12+2759.972009685333*
        t11*t57*t82*t12)-0.493827160493827*t13*t7/pow(rhoa,2.666666666666667)-
        24.0*t13*t21*pow(t43,4.0)*t88+24.0*t21*t27*t67*t68+32.0*t67*
        t8*t13*t68+36.0*t13*t21*t42*t45*t67-8.0*t13*t21*t43*t44*t66+
        4.0*t20*t21*t27*t66+5.333333333333333*t20*t8*t13*t66-5.333333333333333*
        t7*t8*t64+4.0*t20*t21*t43*t64-12.0*t21*t40*t44*t45-32.0*t44*
        t8*t27*t45-5.333333333333332*t44*t33*t13*t45-24.0*t21*t27*
        t42*t43*t44-6.0*t13*t21*pow(t42,2.0)*t44-32.0*t44*t8*t13*t42*
        t43+16.0*t20*t8*t40*t43+5.333333333333332*t20*t33*t27*t43-
        1.185185185185185*t20*t55*t13*t43+6.0*t20*t21*t40*t42+2.666666666666666*
        t20*t33*t13*t42-2.666666666666666*t7*t33*t40+1.185185185185185*
        t7*t55*t27+16.0*t20*t8*t42*t27+t20*t21*t13*(1.2266320025194064E-4*
        t1*t24*t29*t26+2.1558529225818E-4*t1*t24*t39*t38+2.97067733332088E-4*
        t1*t24*t2*t62+5.664091448865145E-4*t1*t24*t85*t86+1.148622222222222*
        grada*t5*t29+5.460373333333334*t9*t15*t81-5.871857777777778*
        t22*t41*t84+4.241066666666667*t35*t65*t83-1.211733333333333*
        t57*t87*t82);
    res[10] = -1.0*t21*t7*(278.053098485952*t11*t12*pow(grada,
        9.0)/pow(rhoa,16.33333333333333)+91.25925925925925*t11*t12*
        t56*grada+3.765160072533334E-4*t30*t61*t62-0.388764444444444*
        grada*t56+2.453599573333334E-4*t30*t18*t38+1.4350933333333335E-4*
        t30*t63*t26-1480.218666666666*t11*t28*t60*t12+3289.317933333333*
        t11*t46*t59*t12-1879.878894352*t11*t69*t58*t12)-24.0*t13*t21*
        t32*t68*t88-6.0*t13*t21*t43*t44*t72+3.0*t20*t21*t27*t72+4.0*
        t20*t8*t13*t72-4.0*t7*t8*t71+3.0*t20*t21*t43*t71+6.0*t21*t31*
        t67*t68+18.0*t13*t21*t45*t49*t67+18.0*t21*t27*t32*t45*t67+
        18.0*t13*t21*t32*t42*t43*t67-2.0*t13*t21*t32*t44*t66-12.0*
        t21*t27*t43*t44*t49-6.0*t13*t21*t42*t44*t49+3.0*t20*t21*t40*
        t49+1.333333333333333*t20*t33*t13*t49-6.0*t21*t44*t45*t48+
        3.0*t20*t21*t42*t48-1.333333333333333*t7*t33*t48-6.0*t21*t31*
        t42*t43*t44-6.0*t21*t32*t40*t43*t44-6.0*t21*t27*t32*t42*t44-
        16.0*t44*t8*t13*t49*t43+8.0*t20*t8*t48*t43+t20*t21*t64*t32+
        24.0*t67*t8*t13*t45*t32-16.0*t44*t8*t27*t43*t32-2.666666666666666*
        t44*t33*t13*t43*t32-8.0*t44*t8*t13*t42*t32+4.0*t20*t8*t40*
        t32+1.333333333333333*t20*t33*t27*t32-0.296296296296296*t20*
        t55*t13*t32+t20*t21*t66*t31+0.296296296296296*t7*t55*t31-8.0*
        t44*t8*t45*t31+1.333333333333333*t20*t33*t43*t31+4.0*t20*t8*
        t42*t31+8.0*t20*t8*t49*t27+t20*t21*t13*(-1.0530163960089674E-4*
        t1*t30*t63*t26-1.800357175347903E-4*t1*t30*t18*t38-2.762729919988419E-4*
        t1*t30*t61*t62-0.265066666666667*t5*t63-2.06752*grada*t15*
        t56+3.142933333333333*t28*t41*t60-2.77184*t46*t65*t59+0.9088*
        t69*t87*t58);
    res[11] = -1.0*t21*t7*(-208.539823864464*t11*t12*t57/
        pow(rhoa,15.33333333333333)-1.8201247744000003E-4*t51*t2*t38-
        19.55555555555556*t11*t12*t34+0.083306666666667*t34-1.1710361600000001E-4*
        t51*t39*t26+1251.492410004*t11*t35*t70*t12+634.7973333333333*
        t11*t9*t37*t12-1853.24986*t11*t22*t36*t12)-24.0*t13*t21*t45*
        t54*t88-4.0*t13*t21*t43*t44*t75+2.0*t20*t21*t27*t75+2.666666666666667*
        t20*t8*t13*t75-2.666666666666667*t7*t8*t74+2.0*t20*t21*t43*
        t74-4.0*t13*t21*t32*t44*t72+2.0*t20*t21*t31*t72+2.0*t20*t21*
        t32*t71+12.0*t21*t27*t43*t54*t67+6.0*t13*t21*t42*t54*t67+6.0*
        t13*t21*t45*t53*t67+24.0*t13*t21*t32*t43*t49*t67+12.0*t21*
        t31*t32*t45*t67-2.0*t21*t40*t44*t54+16.0*t67*t8*t13*t43*t54-
        5.333333333333333*t44*t8*t27*t54-0.888888888888889*t44*t33*
        t13*t54-4.0*t21*t27*t43*t44*t53-2.0*t13*t21*t42*t44*t53-5.333333333333333*
        t44*t8*t13*t43*t53+t20*t21*t40*t53+2.666666666666667*t20*t8*
        t27*t53+0.444444444444444*t20*t33*t13*t53-2.0*t21*t44*t45*
        t52+2.666666666666667*t20*t8*t43*t52+t20*t21*t42*t52-0.444444444444444*
        t7*t33*t52-4.0*t13*t21*t44*pow(t49,2.0)+4.0*t20*t21*t48*t49-
        8.0*t21*t31*t43*t44*t49-8.0*t21*t27*t32*t44*t49-8.0*t21*t32*
        t43*t44*t48-4.0*t21*t31*t32*t42*t44-10.66666666666667*t44*
        t8*t13*t49*t32+5.333333333333333*t20*t8*t48*t32-10.66666666666667*
        t44*t8*t43*t31*t32+0.888888888888889*t20*t33*t31*t32+5.333333333333333*
        t20*t8*t49*t31+t20*t21*t13*(8.592613791433175E-5*t1*t51*t39*
        t26+1.3355376864398991E-4*t1*t51*t2*t38+0.49984*t15*t34-1.4768*
        t9*t41*t37+1.73808*t22*t65*t36-0.6816*t35*t87*t70);
    res[12] = -1.0*t21*t7*(156.404867898348*t11*t12*t69/pow(rhoa,
        14.33333333333333)+8.632209408000002E-5*t77*t18*t26-807.9254798759999*
        t11*t46*t73*t12+953.099928*t11*t28*t47*t12-210.624*t11*grada*
        t23*t12)-24.0*t13*t21*t43*t80*t88+6.0*t21*t27*t67*t80+8.0*
        t67*t8*t13*t80-2.0*t13*t21*t43*t44*t79+t20*t21*t27*t79+1.333333333333333*
        t20*t8*t13*t79-1.333333333333333*t7*t8*t78+t20*t21*t43*t78-
        6.0*t13*t21*t32*t44*t75+3.0*t20*t21*t31*t75+3.0*t20*t21*t32*
        t74+18.0*t13*t21*t49*t54*t67+18.0*t21*t31*t43*t54*t67+18.0*
        t13*t21*t32*t43*t53*t67-6.0*t21*t44*t48*t54-8.0*t44*t8*t31*
        t54-6.0*t13*t21*t44*t49*t53+3.0*t20*t21*t48*t53-6.0*t21*t31*
        t43*t44*t53-6.0*t21*t27*t32*t44*t53+3.0*t20*t21*t49*t52-6.0*
        t21*t32*t43*t44*t52-12.0*t21*t31*t32*t44*t49-8.0*t44*t8*t13*
        t53*t32+4.0*t20*t8*t52*t32+4.0*t20*t8*t53*t31+t20*t21*t13*
        (-6.333983880542168E-5*t1*t77*t18*t26+0.54528*grada*t41*t23-
        1.0224*t28*t65*t47+0.5112*t46*t87*t73);
    res[13] = -1.0*t21*t7*(-117.303650923761*t11*t12*t35/
        pow(rhoa,13.33333333333333)-1.2530626560000006E-5*t89*t2*t26+
        499.0127963939999*t11*t22*t76*t12-422.3965589999999*t11*t9*
        t50*t12+39.492*t11*t29*t12)-24.0*t13*t21*pow(t32,4.0)*t88+
        24.0*t21*t31*t67*t80-8.0*t13*t21*t32*t44*t79+4.0*t20*t21*t31*
        t79+4.0*t20*t21*t32*t78+36.0*t13*t21*t53*t54*t67-12.0*t21*
        t44*t52*t54-6.0*t13*t21*t44*pow(t53,2.0)+6.0*t20*t21*t52*t53-
        24.0*t21*t31*t32*t44*t53+t20*t21*t13*(9.194492729819279E-6*
        t1*t89*t2*t26-0.10224*t41*t29+0.53676*t9*t65*t50-0.3834*t22*
        t87*t76);

}

static void
mpwx_fourth(FunFourthFuncDrv *ds, real factor, const FunDensProp* dp)
{
    real res[14];
 
    mpwx_fourth_helper(dp->rhoa, dp->grada, res);

    ds->df1000 += factor*res[0];
    ds->df0010 += factor*res[1];

    ds->df2000 += factor*res[2];
    ds->df1010 += factor*res[3];
    ds->df0020 += factor*res[4];

    ds->df3000 += factor*res[5];
    ds->df2010 += factor*res[6];
    ds->df1020 += factor*res[7];
    ds->df0030 += factor*res[8];

    ds->df4000 += factor*res[9];
    ds->df3010 += factor*res[10];
    ds->df2020 += factor*res[11];
    ds->df1030 += factor*res[12];
    ds->df0040 += factor*res[13];


    if(fabs(dp->rhoa-dp->rhob)>1e-13 ||
       fabs(dp->grada-dp->gradb)>1e-13)
        mpwx_fourth_helper(dp->rhob, dp->gradb, res);

    ds->df0100 += factor*res[0];
    ds->df0001 += factor*res[1];

    ds->df0200 += factor*res[2];
    ds->df0101 += factor*res[3];
    ds->df0002 += factor*res[4];

    ds->df0300 += factor*res[5];
    ds->df0201 += factor*res[6];
    ds->df0102 += factor*res[7];
    ds->df0003 += factor*res[8];

    ds->df0400 += factor*res[9];
    ds->df0301 += factor*res[10];
    ds->df0202 += factor*res[11];
    ds->df0103 += factor*res[12];
    ds->df0004 += factor*res[13];

}
