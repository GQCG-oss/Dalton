\chapter{Linear and non-linear response functions, RESPONSE}
\label{ch:response}

\section{Directives for evaluation of molecular response functions}\label{sec:rspinp}

The directives in the following subsections may be included in the input to \resp.
They are organized according to the program section names in which they
appear.

\resp\ is the most general part of the code for calculating 
many different electronic linear, quadratic, or cubic molecular
response properties based on SCF or MCSCF or CI wave functions.
No nuclear contributions are added.

Some of these SCF/MCSCF properties can also be requested
from \Sec{*PROPERTIES} input modules.
NOTE: for such properties you should request them either here or
in \Sec{*PROPERTIES}, otherwise you will calculate them twice!
Usually the output is nicest in
the \Sec{*PROPERTIES} module (e.g. collected in tables and in
often used units, most properties are only given in atomic
units in \resp), and nuclear contributions are included if relevant.
Some specific properties, especially those involving nuclear derivatives,
can only be calculated via \Sec{*PROPERTIES}.

Calculations of coupled cluster response properties are performed
by different modules and are described
in the chapter on coupled cluster calculations.

In addition, SOPPA\index{SOPPA}\index{polarization propagator}
(Second-Order Polarization Propagator 
approximation) or SOPPA(CCSD)\index{SOPPA(CCSD)} (Second Order Polarization
Propagator Approximation with Coupled Cluster Singles and Doubles Amplitudes) 
for the calculation of linear response
\index{linear response}\index{response!linear}
properties and excitation energies with transition moments
may be requested in this input section. The current
implementation of the SOPPA method is described 
in Ref.~\cite{mjpekdtehjajjojcp} and of the SOPPA(CCSD) method in 
Ref.~\cite{soppaccsd}. Note that a SOPPA calculation
requires the keyword \Key{SOPPA}, whereas a SOPPA(CCSD) calculation requires
the keyword \Key{SOPPA(CCSD)}.
%M. J. Packer, E. K. Dalskov, T. Enevoldsen, H. J. Aa. Jensen, and
%J. Oddershede, J. Chem. Phys., submitted. 


\subsection{General: \Sec{*RESPONSE}}

General-purpose directives are given in the \Sec{*RESPONSE} section.

After the last directive of the \Sec{*RESPONSE} input group
should follow another {\ttfamily{**<something>}} input group
(or \Sec{*END OF DALTON INPUT} if this was the last input to \dalton).

\begin{description}

\item{\Key{RSPCI}}
Configuration interaction\index{Configuration Interaction!response}\index{CI!response}
response calculation. 
This is equivalent to a CI sum-over-states\index{response!CI sum-over-states}
calculation of response properties,
but of course calculated directly without diagonalization of the full
CI Hamiltonian matrix.
The final wave function from \Sec{*WAVE FUNCTIONS} must be \Key{CI}.

\item{\Key{SOPPA}}
Requests the second order polarization propagator approximation 
in the linear response module.
The SOPPA\index{SOPPA}\index{polarization propagator!SOPPA}\index{response!SOPPA}
flag requires that
the preceding {\sir} calculation has generated the MP2 correlation
coefficients and written them to disk (set \Key{RUN RESPONSE} in \Sec{*DALTON}
input as well as \Key{HF} and \Key{MP2} in \Sec{*WAVE FUNCTIONS}). See
example input in Chapter~\ref{ch:starting}.

\item{\Key{SOPPA(CCSD)}}
Requests the second order polarization propagator approximation with coupled 
cluster singles and doubles amplitudes in the linear response module.
The SOPPA(CCSD)\index{SOPPA(CCSD)}\index{polarization propagator!SOPPA(CCSD)}
\index{response!SOPPA(CCSD)} flag requires that the preceding Coupled Cluster 
calculation has generated the CCSD amplitudes and written them to disk 
(set \Key{RUN RESPONSE} in 
\Sec{*DALTON} input, \Key{HF} and \Key{CC} in \Sec{*WAVE FUNCTIONS}  and 
\Key{SOPPA(CCSD)} in \Sec{CC INPUT}). See example input in 
Chapter~\ref{ch:starting}.

\item{\Key{SOPW4}}
Calculate explicitly the W4 term described by Odderhede {\it et
al.\/}~\cite{jopjdycpr2}. This term is already included in the normal
SOPPA\index{SOPPA}\index{polarization propagator!SOPPA} or 
SOPPA(CCSD)\index{SOPPA(CCSD)} result, and used mostly for comparing to older
calculations. Note that this keyword requires that \Key{SOPPA} or 
\Key{SOPPA(CCSD)}is set.

\item{\Key{HIRPA}}
Invoke the higher RPA approximation for the calculation of linear
response properties\index{linear response!higher RPA}.
This approximation is identical to that of McKoy
and coworkers~\cite{jrtsvmjcp58,tsjrvmjcp58}. The requirements to the
preceding wave function 
calculation is the same as for the \Key{SOPPA} keyword.
This keyword overrides a simultaneous specification of \Key{SOPPA}.

\item{\Key{TRPFLG}}
Triplet flag. This option is set whenever triplet
(spin-dependent)\index{triplet response}
operators must be used in a response calculation
\cite{jodlypjjcp91,ovhapjhjajthjojcp97}.
This flag forces triplet linear response for \Sec{LINEAR},
both for second order properties and electronic excitations
(without and with \Key{SINGLE RESIDUE}).

\item{\Key{NOAVDI}}
Do not use Fock type decoupling of the two-electron density matrix.
Add $F^ID$ instead of $(F^I+F^A)D$ to $E^{[2]}$ approximate
orbital diagonal. Not recommended as the approximate orbital diagonal
normally will become more different from the exact orbital diagonal.

\item{\Key{INPTEST}}
Input test. For debugging purposes only. The program stops after the
input section.

\item{\Key{MAXPHP}}\\
\verb|READ *, MAXPHP|\\
Change the maximum dimension of $H_0$ subspace.   Default is 100.
PHP is a subblock of the CI matrix which is calculated explicitly
in order to obtain improved CI trial vectors compared to the
straight Davidson algorithm\cite{erdjcp17}.  The configurations
corresponding to 
the lowest diagonal elements are selected, unless \Key{PHPRESIDUAL} is
specified. MAXPHP is the maximum dimension of PHP, the 
actual dimension will be less if MAXPHP will split degenerate configurations.
 
\item{\Key{MAXRM}}\\
\verb|READ *, MAXRM |\\
Change the maximum dimension of the reduced space. Default is 200.
When solving a linear system of equations or an eigenvalue equation,
the reduced space is increased by the number of
frequencies/excitations in each iteration. For single root
calculations this should exceed the number of iterations required.
MAXRM should be increased if many frequencies or excitation energies
are to be calculated.
Sharp convergence thresholds also requires
more iterations and thus larger dimension of reduced space.

\item{\Key{NODOIT}}
Turns off direct one-index transformation \cite{ovhahjajjcc15}. 
In this way all one-index transformed integrals are stored on disk.

\item{\Key{NOITRA}}
No integral transformation. Normally the two-electron integrals are 
transformed in the beginning of a response calculation. In some cases
this is not desirable, e.g., if the response part is only used for
calculating average values of operator, or if the transformed two-electron
integrals already exist from a previous response calculation. 

\item{\Key{S0MIX}}
Sum rule is calculated in mixed representation, that is, calculate
$N_e=\langle0\mid [r,p] \mid0\rangle$ provided that dipole length and
velocity integrals are available on the property integral file 
(calculated with \Sec{*HERMIT} options \Key{DIPLEN} and \Key{DIPVEL}).
The calculated quantity gives a measure of the quality of the basis
set\index{basis set!quality}.

\item{\Key{OPTORB}}
Orbital trial vectors are calculated with optimal orbital
trial\index{optimal orbital trial vector} vector
algorithm \cite{tuhjahjajpjjcp84}.

\item{\Key{ORBSFT}}\\
\verb|READ *, ORBSFT|\\
Change the amount for shifting the orbital
diagonal\index{orbital diagonal Hessian} of the MCSCF Hessian.
May be used if there is a large number of negative eigenvalues.
Default is $10^{-4}$. 

\item{\Key{ORBSPC}}
Calculation with only orbital operators. 

\item{\Key{PHPRESIDUAL}}
Select configurations for PHP matrix based on largest residual
rather than lowest diagonal elements.

\item{\Key{PROPAV}} \\
\verb|READ '(A)', LABEL|\\
Property average\index{property average}. The average value of an
operator is calculated. 
The line following this option must contain the
label of the operator given in the integral property file.
(See section \ref{ch:hermit}.)

\item{\Key{QRREST}}
Restart quadratic response\index{quadratic response}\index{response!quadratic}
calculation.
Requires that all needed linear response solutions and excitation vectors
are available on the RSPVEC file.
\end{description}

\subsection{Linear response calculation: \Sec{LINEAR}}

A\index{linear response}\index{response!linear} linear response
\cite{jodlypjjcp91,pjhjajjojcp89} calculation is performed for a given
choice of operators,
-$\langle\!\langle A; B \rangle\!\rangle_{\omega}$.
(Note that {\em minus} the linear response properties are written to output.)

In the same \resp\ calculation these linear response properties can be calculated
together with excitation energies
and with long range dispersion coefficients, but not 
together with quadratic or cubic response.

\begin{description}

\item{\Key{TRIPLET}} Defines $A$ and $B$ to be triplet operators.
Will also make a simultaneous \Sec{LINEAR} \Key{SINGLE RESIDUE} calculation to
a calculation of triplet excitation energies and transition moments.

\item{\Key{DIPLEN}}
Sets $A$ and $B$ to dipole operators\index{dipole length}.

\item{\Key{DIPVEL}}
Sets $A$ and $B$ to velocity operators\index{dipole velocity}.

\item{\Key{DIPMAG}}
Sets $A$ and $B$ to angular momentum operators\index{angular momentum}.

\item{\Key{QUADMOM}}
Sets $A$ and $B$ to the quadrupole\index{quadrupole operator} operators.

\item{\Key{SPIN-O}}
Sets $A$ and $B$ to spin-orbit operators\index{spin-orbit}.

\item{\Key{PROPRT}}\\
\verb|READ '(A)', LABEL|\\
Sets $A$ and $B$ to a given operator with label; LABEL.
(The calculation of the operator must be specified to the integral
module, see section \ref{ch:hermit}.)

\item{\Key{FREQUE}}\\
\verb|READ *, NFREQ|\\
\verb|READ *, FREQ(1:NFREQ)|\\
Response equations are evaluated at given
frequencies\index{frequency}. Two lines following 
this option must contain 1) The number of frequencies, 2) Frequencies.
Remember to increase \Key{MAXRM} if many frequencies are specified.

\item{\Key{THCLR}}\\
\verb|READ *, THCLR|\\
Relative convergence threshold for all requested linear response functions.
Default is 1.0D-3; note that this number should be at least 10 times
bigger than the final gradient norm in the SCF/MCSCF
wave function optimization. The accuracy of the linear response 
properties will be quadratic in this threshold; thus the default
corresponds to convergence to approximately 6 digits.

\item{\Key{PRINT}}\\
\verb|READ *,IPRLR|\\
Sets print level for linear response module. Default is 2.
 
\item{\Key{RESTLR}}
Restart\index{restart!linear response} of response calculation. This
can only be used if the  
operator specified is the same which was used \textit{last} in the previous
response calculation.

\item{\Key{MAXIT}}\\
\verb|READ (LUCMDS,*) MAXITL|\\
Maximum number of iterations for solving a linear response 
equation. Default is 60.

\item{\Key{MAXITO}}\\
\verb|READ (LUCMDS,*) MAXITO|\\
Maximum number of iterations in the optimal orbital
algorithm\index{optimal orbital trial vector}
\cite{tuhjahjajpjjcp84}. 
Default is 5.

%\item{\Key{OLSEN}}
%CI trial vectors are obtained with Olsen algorithm (for the single
%residue calculation only).

\end{description}

\subsection{Linear response excitation energies calculation: \Sec{LINEAR} with \Key{SINGLE RESIDUE}}

Single residues\index{single residue!linear response} of the linear
response\index{linear response!single residue}\index{response!excitations} function is
computed. Residues of a linear response function correspond to
transition moments\index{transition moment!linear response} and the associated poles
correspond to vertical electronic excitation energies.
%\cite{jodlypjjcp91,pjhjajjojcp89}

In the same \resp\ calculation these excitation properties can be calculated
together with linear response properties
and with long range dispersion coefficients, but not 
together with quadratic or cubic response.

\begin{description}

\item{\Key{SINGLE RESIDUE}} Required to get excitation energies, without
this keyword the linear response function will be evaluated.

\item{\Key{TRIPLET}} Calculate triplet excitation energies and transition moments.
Will also make a simultaneous linear response calculation of triplet symmetry.

\item{\Key{ROOTS}}\\
\verb|READ '*',(ROOTS(I) I=1,NSYM)|\\
Number of roots.  The line following this option contains the number
of excited states\index{excited state} per symmetry. Excitation
energies\index{excitation energy} are calculated for each state and if
any operators are given, 
symmetry-allowed transition moments\index{transition moment} are
calculated between the 
reference state and the excited states.
Remember to increase \Key{MAXRM} if many frequencies are specified.

\item{\Key{DIPLEN}}
Calculate transition moments for all dipole operators\index{dipole length}.

\item{\Key{DIPVEL}}
Calculate transition moments for all velocity operators\index{dipole velocity}.

\item{\Key{DIPMAG}}
Calculate transition moments for all angular momentum operators\index{angular momentum}.

\item{\Key{QUADMOM}}
Calculate transition moments for all quadrupole\index{quadrupole operator} operators.

\item{\Key{SPIN-O}}
Calculate transition moments for all spin-orbit operators\index{spin-orbit}.
Warning: this option implies \Key{TRIPLET} and
forces the excitations to be of triplet symmetry,
and all operators -- including
e.g. \Key{DIPLEN} -- will be assumed by the program to be of triplet symmetry!!

\item{\Key{PROPRT}}\\
\verb|READ '(A)', LABEL|\\
Calculate either singlet or triplet transition moments for a given operator with label; LABEL.
(The calculation of the operator must be specified to the integral
module, see section \ref{ch:hermit}.)

\item{\Key{PRINT}}\\
\verb|READ *,IPRPP|\\
Sets print level for single residue linear response module. Default is 2.

\item{\Key{MAXIT}}\\
\verb|READ *, MAXITP|\\
Maximum number of iterations for solving the linear response eigenvalue
equation. Default is 60.

\item{\Key{MAXITO}}\\
\verb|READ *, MAXITO|\\
Maximum number of iterations in the optimal orbital
algorithm\index{optimal orbital trial vector}
\cite{tuhjahjajpjjcp84}. 
Default is 5.

\item{\Key{RESTPP}}
Restart\index{restart!excitation energy} of response
calculation. This can only be used if the root which is 
specified is the same which was used \textit{last} in the previous
response calculation.

\item{\Key{THCPP}}\\
\verb|READ *, THCPP|\\
Threshold for solving the single residue linear response eigenvalue equation. 
Default is 1.0D-3; note that this number should be at least 10 times
bigger than the final gradient norm in the SCF/MCSCF
wave function optimization.
The accuracy of the pole (excitation energy) will be 
quadratic in this threshold, thus the default corresponds to approximately
6 digits. The accuracy of transition moments will be linear in this threshold.

\item{\Key{OLSEN}}
CI trial vectors are obtained with Olsen algorithm.

\end{description}

\subsection{Quadratic response calculation: \Sec{QUADRA}}

Calculation of third order properties\index{properties!third order}
 as quadratic response
functions\index{quadratic response}\index{response!quadratic}.
$A$, $B$, and $C$-named options refer to the operators in the quadratic
response function 
$\langle\!\langle A;B,C \rangle\!\rangle_{\omega_b,\omega_c}$
\cite{ovhapjhjajthjojcp97,hhhjajpjjojcp97,haovhkpjthjcp98}

The second order properties from the linear response functions
$\langle\!\langle A;B,\rangle\!\rangle_{\omega_b}$ are also printed
(if $A$ and $B$ operators have the same spin symmetry),
as they can be obtained at no extra computational cost.

\begin{description}

\item{\Key{SHG}}
Only response functions connected with second harmonic
generation\index{second harmonic generation}\index{response!second harmonic generation}\index{quadratic response!second harmonic generation}
are computed, $\beta(-2\omega,\omega,\omega)$ .
Can be specified together with \Key{POCKEL}.
Frequencies must be specified with \Key{FREQUE}.
Remember to specify operators as well, e.g. \Key{DIPLEN}.

\item{\Key{POCKEL}}
Only response functions connected with electro-optical
Pockels effect\index{Pockels effect}\index{response!Pockels effect}\index{quadratic response!Pockels effect}
$\beta(-\omega; \omega,0)$, are computed.
Can be specified together with \Key{SHG}.
Frequencies must be specified with \Key{FREQUE}.
Remember to specify operators as well, e.g. \Key{DIPLEN}.

\item{\Key{DIPLEN}}
Sets $A$, $B$, and $C$ to dipole operators\index{dipole length}.

\item{\Key{DIPLNX}}
Sets $A$, $B$, and $C$ to the $x$ dipole operator\index{dipole length}.

\item{\Key{DIPLNY}}
Sets $A$, $B$, and $C$ to the $y$ dipole operator\index{dipole length}.

\item{\Key{DIPLNZ}}
Sets $A$, $B$, and $C$ to the $z$ dipole operator\index{dipole length}.

\item[\Key{APROP}, \Key{BPROP}, \Key{CPROP}]
Specify the operators $A$, $B$, and $C$. The line following this
option should be the label of the operator as it appears in the file
AOPROPER.

\item[\Key{ASPIN}, \Key{BSPIN}, \Key{CSPIN}]
Spin information for quadratic response calculations.
The line following these options contains the spin
rank\index{spin rank} of the operators 
$A$, $B$, and $C$, respectively, 0 for singlet operators and 1 for triplet
operators.
In a triplet response calculations two of these operators are of rank one,
and the remaining operator of rank zero.

\item{\Key{FREQUE}}\\
\verb|READ *, NFREQ|\\
\verb|READ *, FREQ(1:NFREQ)|\\
Response equations are evaluated at given
frequencies\index{frequency!quadratic response}. Two lines 
following this option must contain 1) The number of frequencies, 2)
Frequencies.
For the Kerr effect only the $B$-frequency is set,
and in other cases both $B$ and $C$-frequencies are set.
May not be used together with \Key{BFREQ} or \Key{CFREQ}.
Default is one frequency of each type: zero (static).

\item[\Key{BFREQ}, \Key{CFREQ}]
Individual specification of the frequencies $\omega_b$ and $\omega_c$.
Input as in \Key{FREQUE} above.
May not be used for \Key{SHG} and \Key{POCKEL}.
May not be used together with \Key{FREQUE}.
Default is one frequency of each type: zero (static).

\item{\Key{MAXIT}}
Maximum number of iterations for solving a linear response equation.
Default is 60.

\item{\Key{MAXITO}}
Maximum number of iterations in the optimal
orbital\index{optimal orbital trial vector} algorithm 
\cite{tuhjahjajpjjcp84}. 
Default is 5.

\item{\Key{PRINT}}\\
\verb|READ *,IPRHYP|\\
Print level.

\item{\Key{THCLR}}
Threshold for solving the linear response equations.
Default is $10^{-3}$.

\end{description}

\subsection{Quadratic response calculation of second order transition moments:
\Sec{QUADRA} with \Key{SINGLE RESIDUE}}

%Calculation of third order properties as quadratic response
%functions\index{quadratic response}\index{response!quadratic}.
%$A, B$, and $C$-named options refer to the operators in the quadratic
%response function 
%$\langle\!\langle A;B,C \rangle\!\rangle_{\omega_b,\omega_c}$
%\cite{ovhapjhjajthjojcp97,hhhjajpjjojcp97,haovhkpjthjcp98}

\begin{description}

\item{\Key{SINGLE RESIDUE}}
Required to
compute the single residue\index{single residue!quadratic response} of the quadratic
response function\index{quadratic response!single residue}\index{response!quadratic, single residue}.
For the case of dipole operators this corresponds to two-photon
transition
moments\index{two-photon!transition moment}\index{transition moment}\index{transition moment!two-photon}.

\item{\Key{ROOTS}}\\
\verb|READ '*',(ROOTS(I) I=1,NSYM)|\\
Number of roots.  The line following this option contains the number
of excited states\index{excited state!second order moment} per symmetry. Excitation
energies\index{excitation energy!second order moment} are calculated for each state and if
any operators are given, 
symmetry-allowed second order transition moments\index{transition moment!second order} are
calculated between the 
reference state and the excited states.
Remember to increase \Key{MAXRM} if many frequencies are specified.

\item{\Key{PHOSPHORESCENCE}}
Specifies a phosphoresence\index{phosphoresence} calculation, i.e.,
the spin-orbit\index{spin-orbit} 
induced singlet-triplet transition\index{singlet-triplet transition}. This keyword sets up the  
calculation so that no further response input is required except \Key{ROOTS}; the
$A$ operator is set to the dipole operators\index{dipole length} and
the $B$ operator  
is set to the spin-orbit\index{spin-orbit}
operators. \cite{ovhapjhjajthjojcp97,haovbmaqc27} 
The reference state {\em must} be a singlet spin state.

\item{\Key{MCDBTERM}}
Specifies the calculation of all individual components to the 
${\cal{B}}(0\to f)$ term of magnetic circular dicrhoism
(MCD)\index{magnetic circular dichroism}\index{B-term}\index{MCD}.
This keyword sets up the calculation so that no further response input is required except \Key{ROOTS}. 
The $A$ operator is set equal to the $\alpha$ component of dipole 
operator\index{dipole length} and
the $B$ operator to the $\beta$ component of the angular momentum\index{angular momentum}
operator. The resulting "mixed" two-photon transition moment to state $f$ 
is then multiplied for the dipole-allowed one-photon transition moment 
from state $f$ (for the $\gamma$ component, with $\alpha \neq \beta \neq \gamma$).
\cite{Coriani:MCDRSP} 

\item{\Key{DIPLEN}}
Sets $A$ and $B$ to $x, y, z$ dipole operators\index{dipole length}.

\item{\Key{DIPLNX}}
Sets $A$ and $B$ to the $x$ dipole operator\index{dipole length}.

\item{\Key{DIPLNY}}
Sets $A$ and $B$ to the $y$ dipole operator\index{dipole length}.

\item{\Key{DIPLNZ}}
Sets $A$ and $B$ to the $z$ dipole operator\index{dipole length}.

\item{\Key{BFREQ}, \Key{FREQUE}}\\
\verb|READ *, NFREQ|\\
\verb|READ *, FREQ(1:NFREQ)|\\
The frequencies $\omega_b$ in atomic units.
Response equations are evaluated at given
frequencies\index{frequency}. Two lines 
following this option must contain 1) The number of frequencies, 2)
Frequencies.

\item{\Key{ISPABC}}\\
\verb|READ *, ISPINA,ISPINB,ISPINC|\\
Spin symmetry of $A$-operators (ISPINA), $B$-operators (ISPINB),
and the excitation operator (ISPINC): "0" for singlet and "1" for triplet.
Default is "0,0,0", i.e. all of singlet spin symmetry.
Note: triplet operators are only implemented for singlet reference states.
%hjaaj June 2001: .ASPIN etc. should be defined for .SINGLE
%\item[\Key{ASPIN}, \Key{BSPIN}, \Key{CSPIN}]
%\index{quadratic response}\index{response!quadratic}
%Spin information for quadratic response calculations.
%The line following these options contains the spin
%rank\index{spin rank} of the operators 
%$A$, $B$, and $C$, respectively, 0 for singlet operators and 1 for triplet
%operators. If \Key{SINGLE} is specified, \Key{CSPIN} denotes the
%spin of the excited state. If \Key{DOUBLE} is specified,
%both \Key{BSPIN} and \Key{CSPIN} denote excited state spins.
%In a triplet response calculations two of these operators are of rank one,
%and the remaining operator of rank zero.

\item[\Key{APROP}, \Key{BPROP}]
Specify the operators $A$ and $B$, respectively. The line following this
option should be the label of the operator as it appears in the file
AOPROPER.

\item{\Key{PRINT}}\\
\verb|READ *,IPRSMO|\\
Print level.

\item{\Key{MAXITL}}
Maximum number of iterations for linear equations in this section.
Default is 60.

\item{\Key{MAXITP}}
Maximum number of iterations in solving the linear
response\index{linear response}\index{response!linear} eigenvalue 
equations.
Default is 60.

\item{\Key{MAXITO}}
Maximum number of iterations in the optimal
orbital\index{optimal orbital trial vector} algorithm 
\cite{tuhjahjajpjjcp84}. 
Default is 5.

\item{\Key{THCLR}}
\verb|READ *, THCLR|\\
Threshold for solving the linear response equations.
Default is $10^{-3}$.

\item{\Key{THCPP}}\\
\verb|READ *, THCPP|\\
Threshold for solving the linear response
\index{linear response}\index{response!linear}
eigenvalue equation. Default is $10^{-3}$.

\end{description}


\subsection{Quadratic response calculation of transition moments between excited states:
\Sec{QUADRA} with \Key{DOUBLE RESIDUE}}

Calculation of third-order properties as quadratic response
functions\index{quadratic response}\index{response!quadratic}.
$A,B$, and $C$-named options refer to the operators in the quadratic
response function 
$\langle\!\langle A;B,C \rangle\!\rangle_{\omega_b,\omega_c}$
\cite{ovhapjhjajthjojcp97,hhhjajpjjojcp97,haovhkpjthjcp98}

\begin{description}

\item{\Key{DOUBLE RESIDUE}}
Computes the double residue\index{quadratic response!double residue}
of the quadratic
response function\index{double residue!quadratic response}\index{response!quadratic, double residue}.
Double residues of the quadratic repsonse function correspond to transition
moments between excited states\index{transition moment!between excited states},
$\langle B \mid A \mid C \rangle$. 

\item{\Key{DIPLEN}}
Sets $A$ to dipole operators\index{dipole length}.

\item{\Key{DIPLNX}}
Sets $A$ to the $x$ dipole operator\index{dipole length}.

\item{\Key{DIPLNY}}
Sets $A$ to the $y$ dipole operator\index{dipole length}.

\item{\Key{DIPLNZ}}
Sets $A$ to the $z$ dipole operator\index{dipole length}.

\item[\Key{PROPRT}]
%hjaaj June 2001, ought to define as well: \item[\Key{APROP}]
Specify another $A$ operator. The line following this
option should be the label of the operator as it appears in the file
AOPROPER. This option may be repeated for different property operators.

\item{\Key{ISPABC}}\\
\verb|READ *, ISPINA,ISPINB,ISPINC|\\
Spin symmetry of $A$-operators (ISPINA)
and the left and right excitation operators (ISPINB and ISPINC):
"0" for singlet and "1" for triplet.
Default is "0,0,0", i.e. all of singlet spin symmetry.
Note: triplet operators are only implemented for singlet reference states.
%hjaaj June 2001: .ASPIN etc. should be defined for .DOUBLE
%\item[\Key{ASPIN}, \Key{BSPIN}, \Key{CSPIN}]
%\index{quadratic response}\index{response!quadratic}
%Spin information for quadratic response calculations.
%The line following these options contains the spin
%rank\index{spin rank} of the operators 
%$A$, $B$, and $C$, respectively, 0 for singlet operators and 1 for triplet
%operators. If \Key{SINGLE} is specified, \Key{CSPIN} denotes the
%spin of the excited state. If \Key{DOUBLE} is specified,
%both \Key{BSPIN} and \Key{CSPIN} denote excited state spins.
%In a triplet response calculations two of these operators are of rank one,
%and the remaining operator of rank zero.


\item{\Key{PRINT}}\\
\verb|READ *,IPRPP|\\
Print level for solving linear response eigenvalue equations.

\item{\Key{IPREXM}}\\
\verb|READ *,IPREXM|\\
Print level for special excited state transition moment routines.


\item{\Key{THCPP}}\\
\verb|READ *, THCPP|\\
Threshold for solving the linear response
eigenvalue equation. Default is $10^{-3}$.

\item{\Key{MAXIT}}
Maximum number of iterations for solving linear response
eigenvalue equation in this section.

\item{\Key{MAXITO}}
Maximum number of iterations in the optimal
orbital\index{optimal orbital trial vector} algorithm 
\cite{tuhjahjajpjjcp84}. 
Default is 5.

\end{description}


\subsection{Cubic response calculation: \Sec{CUBIC}}
Calculation of fourth-order properties as cubic response functions\index{cubic response}\index{response!cubic}
\cite{pndjovhacpl242,djpnhajcp105,pndjhapdkrthhkcpl253}.
$A,B$,$C$, and $D$-named options refer to the operators in the cubic
response function 
$\langle\!\langle A;B,C,D \rangle\!\rangle_{\omega_b,\omega_c,\omega_d}$

\begin{description}

\item[\Key{APROP}, \Key{BPROP}, \Key{CPROP}, \Key{DPROP}]
Specify the operators $A$, $B$, $C$, and $D$. The line following this
option should be the label of the operator as it appears in the file
AOPROPER.

\item[\Key{BFREQ}, \Key{CFREQ}, \Key{DFREQ}]
The frequencies\index{frequency!cubic response}
$\omega_b$, $\omega_c$, and $\omega_d$, respectively. Input as in
\Key{FREQUE}.

\item{\Key{FREQUE}}\\
\verb|READ *, NFREQ|\\
\verb|READ *, FREQ(1:NFREQ)|\\
Sets the frequencies\index{frequency!cubic response} whenever a optical process is specified.
Can also be used for the residue calculation and it does then set 
both $\omega_b$ and $\omega_c$ for the single residue and only
$\omega_b$ for the double residue.

\item{\Key{THG   }}
Only response functions connected to the third harmonic
generation\index{third harmonic generation} are
computed, $\gamma(-3\omega;\omega,\omega,\omega)$ \cite{djpnylhajcp105}.

\item{\Key{DC-SHG}}
Only response functions connected to the static electric field-induced
second harmonic generation\index{electric field!induced SHG} are computed,
$\gamma(-2\omega;\omega,\omega,0)$.

\item{\Key{DC-KERR}}
Only response functions connected to the static electric field induced
Kerr effect\index{electric field!induced Kerr} are computed,
$\gamma(-\omega;\omega,0,0)$.

\item{\Key{IDRI  }}
Only response functions connected to the intensity dependent 
refractive\index{refractive index!intensity dependent} index are computed,
$\gamma(-\omega;\omega,-\omega,\omega)$.

\item{\Key{DIPLEN}}
Sets $A$, $B$, $C$, and $D$ to dipole operators\index{dipole length}.

\item{\Key{DIPLNX}}
Sets $A$, $B$, $C$, and $D$ to the $x$ dipole operator\index{dipole length}.

\item{\Key{DIPLNY}}
Sets $A$, $B$, $C$, and $D$ to the $y$ dipole operator\index{dipole length}.

\item{\Key{DIPLNZ}}
Sets $A$, $B$, $C$ and $D$ to the $z$ dipole operator\index{dipole length}.

\item{\Key{MAXIT }}
Maximum nuber of iterations for solving linear equations, default value is 20.

\item{\Key{MAXITO}}
Maximum number of ORPCTL-microiterations, default value is 10.

\item{\Key{PRINT}}
Print flag for output, default value is 2. Timer information is printed
out if printflag greater than 5. Response vectors printed out if
printflag greater than 10.

\item{\Key{THCLR}}
Threshold for convergence of response vectors, default value is $10^{-4}$.

\item{\Key{THRNRM}}
Threshold for norm of property vector $X^{[1]}$ in order to solve the linear
equation \\
$\left( E^{[2]} - S^{[2]} \right)N^{X} = X^{[1]}$, default
value is $10^{-9}$. 

%hjaaj June 2001: is triplet tested ?? (was not listed in dalton1.1 manual)
%item{\Key{ISABCD}}\\
%verb|READ *, ISPINA,ISPINB,ISPINC,ISPIND|\\

%hjaaj June 2001
%\Key{INVEXP} is a programmers test option 

\end{description}

\subsection{Cubic response calculation of third-order transition moments:
\Sec{CUBIC} with \Key{SINGLE RESIDUE}}
Calculation of single residues\index{single residue!cubic response} of
cubic response functions\index{cubic response!single residue}\index{response!cubic, single residue}
\cite{pndjovhacpl242,djpnhajcp105,pndjhapdkrthhkcpl253}.
$A,B$,$C$, and $D$-named options refer to the operators in the cubic
response function 
$\langle\!\langle A;B,C,D \rangle\!\rangle_{\omega_b,\omega_c,\omega_d}$

\begin{description}

\item{\Key{SINGLE}}
Computes the single residue\index{single residue!cubic response} of the cubic
response function\index{cubic response!single residue}.
In the case of dipole operators this corresponds to
three-photon absorption\index{three-photon!absorption}.

\item[\Key{APROP}, \Key{BPROP}, \Key{CPROP}]
Specify the operators $A$, $B$, and $C$, respectively.
The line following this
option should be the label of the operator as it appears in the file
AOPROPER.

\item[\Key{BFREQ}, \Key{CFREQ}]
The frequencies\index{frequency!cubic response single residue}
$\omega_b$ and $\omega_c$, respectively. Input as in
\Key{FREQUE}.

\item{\Key{FREQUE}}\\
\verb|READ *, NFREQ|\\
\verb|READ *, FREQ(1:NFREQ)|\\
Sets the frequencies\index{frequency!cubic response} whenever a optical process is specified.
Can also be used for the residue calculation and it does then set 
both $\omega_b$ and $\omega_c$ for the single residue and only
$\omega_b$ for the double residue.

\item{\Key{DIPLEN}}
Sets $A$, $B$, $C$, and $D$ to dipole operators\index{dipole length}.

\item{\Key{DIPLNX}}
Sets $A$, $B$, $C$, and $D$ to the $x$ dipole operator\index{dipole length}.

\item{\Key{DIPLNY}}
Sets $A$, $B$, $C$, and $D$ to the $y$ dipole operator\index{dipole length}.

\item{\Key{DIPLNZ}}
Sets $A$, $B$, $C$ and $D$ to the $z$ dipole operator\index{dipole length}.

\item{\Key{MAXIT}}
Maximum nuber of iterations for solving linear equations, default value is 20.

\item{\Key{MAXITO}}
Maximum number of ORPCTL-microiterations, default value is 10.

\item{\Key{PRINT}}
Print flag for output, default value is 2. Timer information is printed
out if printflag greater than 5. Response vectors printed out if
printflag greater than 10.

\item{\Key{THCLR}}
Threshold for convergence of response vectors, default value is $10^{-4}$.

\item{\Key{MAXITP}}
Maximum number of iteration for solving eigenvalue equation, default
value is 20.

\item{\Key{ROOTS}}
Number of roots (excited states) to converge. \\
\verb|READ (LUCMDS,*) (NTMCNV(J),J=1,NSYM)|\\

\item{\Key{THCPP}}
Threshold for convergence of eigenvector, default value is $10^{-6}$.

\end{description}


\subsection{Cubic response calculation of second order moments 
between excited states and excited state polarizabilities:
\Sec{CUBIC} with \Key{DOUBLE RESIDUE}}
Calculation of double residues\index{double residue!cubic response} of
cubic response functions\index{cubic response!double residue}\index{response!cubic, double residue}
\cite{pndjovhacpl242,djpnhajcp105,pndjhapdkrthhkcpl253}.
$A,B$,$C$, and $D$-named options refer to the operators in the cubic
response function 
$\langle\!\langle A;B,C,D \rangle\!\rangle_{\omega_b,\omega_c,\omega_d}$.
$C$ and $D$ refer to the left hand state and right hand state
after the double residue has been taken.

Excited state polarizabilites are only calculated if one or more of the keywords
\Key{DIPLEN}, \Key{DIPLNX}, \Key{DIPLNY}, and \Key{DIPLNZ}
are specified.
Only singlet excitations and singlet property operators are implemented.

\begin{description}

\item{\Key{DOUBLE}}
REQUIRED.
Computes the double\index{double residue} residue of the cubic
response function\index{cubic response}\index{response!cubic}.
In the case of dipole operators this corresponds to excited
state polarizabilities and two-photon transition
moments\index{two-photon!transition moment!excited states}\index{excited state!polarizability} 
between excited states \cite{djpnylhajcp105}.

\item{\Key{ROOTS}}
Number of roots (excited states) to converge for each spatial symmetry. \\
\verb|READ (LUCMDS,*) (NTPCNV(J),J=1,NSYM)|\\
Default: one of each symmetry.

\item[\Key{APROP}, \Key{BPROP}]
Specify the operators $A$ and $B$, respectively. The line following this
option should be the label of the operator as it appears in the file
AOPROPER. These two keywords can be repeated for different properties.

\item[\Key{BFREQ}]
The frequencies\index{frequency!cubic response}
$\omega_b$. Input as in \Key{FREQUE}.
Default only zero frequency (static).

\item{\Key{FREQUE}}\\
\verb|READ *, NFREQ|\\
\verb|READ *, FREQ(1:NFREQ)|\\
Sets the frequencies\index{frequency!cubic response} whenever a optical process is specified.
Can also be used for the residue calculation and it does then set 
both $\omega_b$ and $\omega_c$ for the single residue and only
$\omega_b$ for the double residue.
Default only zero frequency (static).

\item{\Key{DIPLEN}}
Sets $A$ and  $B$ to dipole operators\index{dipole length}.

\item{\Key{DIPLNX}}
Sets $A$ and $B$ to the $x$ dipole operator\index{dipole length}.

\item{\Key{DIPLNY}}
Sets $A$ and $B$ to the $y$ dipole operator\index{dipole length}.

\item{\Key{DIPLNZ}}
Sets $A$ and $B$ to the $z$ dipole operator\index{dipole length}.

\item{\Key{MAXIT}}
Maximum nuber of iterations for solving linear equations, default value is 60.

\item{\Key{MAXITO}}
Maximum number of ORPCTL-microiterations, default value is 10.

\item{\Key{PRINT}}
Print flag for output, default value is 2. Timer information is printed
out if printflag greater than 5. Response vectors printed out if
printflag greater than 10.

\item{\Key{THCLR}}
Threshold for convergence of response vectors, default value is $10^{-4}$.

\item{\Key{MAXITP}}
Maximum number of iteration for solving eigenvalue equation, default
value is 20.

\item{\Key{THCPP}}
Threshold for convergence of eigenvector, default value is $10^{-6}$.

\end{description}


\subsection{Spherical multipole moments: \Sec{C6}}\index{multipole moment}
%hjaaj: wrong name!

\begin{description}

\item{\Key{C6SPH}, \Key{C8SPH}, \Key{C10SPH}}
Specification of one of \Key{C6SPH}, \Key{C8SPH}, \Key{C10SPH}
calculates and writes to an interface file (LURSP7) the spherical multipole
moments in the specified/default grid points needed for C6, C8, and C10
coefficients, respectively $(L=1, L=1,2,$ or $L=1,2,3$; all for $M_L =
-L,...,0,...,L)$.

\item{\Key{C6ATM}, \Key{C8ATM}, \Key{C10ATM}}
\Key{C6ATM}, \Key{C8ATM}, \Key{C10ATM} do the same as \Key{C6SPH} etc. for
atoms. Only $M_L=0$ is
calculated and written to file (all $M_L$ vaules give same multipole moment 
for 
atoms).

\item{\Key{C6LMO}, \Key{C8LMO}, \Key{C10LMO}}
\Key{C6LMO}, \Key{C8LMO}, \Key{C10LMO} is \Key{C6SPH} etc. for linear
molecules\index{linear molecule}. Only
multipole moments\index{multipole moment} with zero or positive $M_L$
is calculated and written to 
file.

\end{description}

\subsection{Electron Spin Resonance: \Sec{ESR}}

Calculation of ESR parameters\index{ESR}

\subsubsection{Hyperfine coupling}

Default\index{hyperfine coupling}: hyperfine coupling tensors using 
the Restricted-Unrestricted Approach\index{restricted-unrestricted method}.

\begin{description}

\item{\Key{MAXIT}}      \\
\verb|READ (LUCMDS,'(I5)'),MAXESR |\\
   The line following gives the maximum number of iterations.  (Default = 20)

\item{\Key{PRINT}}     \\
\verb|READ (LUCMDS,'(I5)'),IPRESR |\\
   The line following gives the print level for ESR routines.

\item{\Key{SNGPRP}}    \\
\verb|READ (LUCMDS,'(A)'), LABEL|\\
   Singlet Operator. The line following is the label in the AOPROPER file.

\item{\Key{THCESR}}     \\
\verb|READ (LUCMDS,*),THCESR|\\
   The line following is the threshold for convergence (Default = 1.0D-5)

\item{\Key{TRPPRP}}    \\
\verb|READ (LUCMDS,'(A)'), LABEL |\\
   Triplet Operator. The line following is the label in the AOPROPER file.


\end{description}

\subsubsection{Zero-fieldl splitting: \Key{ZFS}}

Calculation of the spin-spin contribution to the zero-field splitting
tensor:

\begin{description}
  \item{\Key{ZFS}} \\
\end{description}

\subsubsection{Electronic g-tensors:  \Key{G-TENSOR}}
\label{sec:g-tensor}
Calculation of the electronic g-tensor:

\begin{description}
  \item{\Key{G-TENSOR}} \\
   Initializes input block for g-tensor related options
\end{description}
The default is to calculate all contributions. The following
options selects individual contributions
\begin{description}
   \item{\Key{RMC}}
   Relativistic mass correction
   \item{\Key{OZSO1}}
   Second-order (paramagnetic) orbital-Zeeman + 1-electron spin-orbit contributions
   \item{\Key{OZSO2}}
   Second-order (paramagnetic) orbital-Zeeman + 2-electron spin-orbit contributions
   \item{\Key{GC1}}
   1-electron gauge correction (diamagnetic) contributions
   \item{\Key{GC2}}
   2-electron gauge correction (diamagnetic) contributions
   \item{\Key{ECC}}
   Choose electron center of charge (ECC) as gauge origin.
\end{description}
The following are utility options for modifying the default calculational
procedure.
\begin{description}
   \item{\Key{ZERO}}
   \verb|READ(LUCMD,'(A80)')G_LINE |\\
   This option is mainly for linear molecules in a $\Sigma$ state.
   Specifying e.g. "ZZ" on the input line instructs the program
   to skip the calculation of the paramagnetic contribution to $g_{zz}$.
   \item{\Key{MEAN-FIELD}}
   Uses the approximate atomic mean field (AMFI) spin-orbit operator
   for evaluating the paramagnetic contributions.
   \item{\Key{SCALED}}
   Uses the approximate 1-electron spin-orbit operator with scaled nuclear
   charges for evaluating the paramagnetic contributions.
   \item{\Key{ADD-SO}}
   Adds the 1- and 2-electron spin-orbit operators. This 
   option may be used when one is not interested in the individual
   1- and 2-electron contribution to the paramagnetic g-tensor,
   since it reduces the number of response equations to be solved.
\end{description}


