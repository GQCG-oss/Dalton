\chapter{SOPPA and SOPPA(CCSD) calculations}\label{ch:soppa}

The Dalton program system can also be used to perform Second-Order
Polarization Propagator Approximation (SOPPA) \index{SOPPA}
\index{polarization propagator} calculations
\cite{esnpjjodjcp73,mjpekdtehjajjojcp,spascpl260,tejospastcan100} or
Second-Order Polarization Propagator Approximation with Coupled Cluster
Singles and Doubles Amplitudes [SOPPA(CCSD)] \index{SOPPA(CCSD)}
calculations of optical properties like singlet or triplet excitation
energies\index{electronic   excitation} and oscillator
strengths\index{transition moment} as well as the 
following list of electric and magnetic properties
\begin{center}
\begin{list}{}{}
\item polarizability\index{polarizability}
\item magnetizability\index{magnetizability}
\item rotational {\em g} tensor\index{rotational g tensor}
\item nuclear magnetic shielding constant\index{nuclear shielding}
\item nuclear spin--rotation constant\index{spin-rotation constant}
\item indirect nuclear spin--spin coupling constant\index{spin-spin coupling}
\end{list}
\end{center}
as well as all the linear response functions described in chapter
\ref{ch:rspchap}.


\section{General considerations}\label{sec:soppageneral}

The Second-Order Polarization Propagator Approximation is a generalization of
the SCF linear response function
\cite{esnpjjodjcp73,jopjdycpr2,mjpekdtehjajjojcp}. In SOPPA, the SCF reference
wave function in the linear response function or polarization propagator is
replaced by a M{\o}ller-Plesset wave function and all matrix elements in the
response function are then evaluated through second order in the fluctuation
potential. This implies that electronic excitation energies and oscillator
strengths as well as linear response functions are correct through second
order. Although it is a second-order method like MP2, the SOPPA equations
differ significantly from the expressions for second derivatives of an MP2
energy. 

In the Second Order Polarization Propagator Approximation with Coupled Cluster
Singles and Doubles Amplitudes [SOPPA(CCSD)], the M{\o}ller-Plesset
correlation coefficients are replaced by the corresponding coupled cluster
singles and doubles amplitudes
\cite{soppaccsd,ekdspasjpca102,tejospastcan100,ctocd}. SOPPA(CCSD) is not a
coupled cluster linear response function as they are implemented in the CC
modules of Dalton program. However, the equations are essentially the
same as for SOPPA.  


\section{Input description}\label{sec:soppainput}

\begin{center}
\fbox{
\parbox[h][\height][l]{12cm}{
\small
\noindent
{\bf Reference literature:}
\begin{list}{}{}
\item General reference : E.~S. Nielsen, Poul J{\o}rgensen, and Jens
  Oddershede. 
\newblock {\em J.~Chem.~Phys.}, {\bf 73},\hspace{0.25em}6238, (1980)
\item General reference : J. Oddershede, Poul J{\o}rgensen and Danny Yeager,
\newblock {\em Comput. Phys. Rep.}, {\bf 2},\hspace{0.25em}33, (1984)
\item Excitation energy : Martin J. Packer, Erik K. Dalskov, Thomas
  Enevoldsen, Hans J{\o}rgen Aagaard Jensen and Jens Oddershede,  
\newblock {\em J. Chem. Phys.}, {\bf 105}, \hspace{0.25em}5886, (1996)
\item Rotational {\em g} tensor : Stephan P.~A. Sauer,
\newblock {\em Chem. Phys. Lett.}  {\bf 260},\hspace{0.25em}271, (1996)
\item Polarizability : Erik K. Dalskov and Stephan P.~A. Sauer.
\newblock {\em J.~Phys.~Chem.~{\bf A}}, {\bf 102},\hspace{0.25em}5269, (1998)
\item  Spin-Spin Coupling Constants : Thomas Enevoldsen, Jens
  Oddershede, 
and Stephan P.~A. Sauer.
\newblock {\em Theor.~Chem.~Acc.}, {\bf 100},\hspace{0.25em}275, (1998)
\item CTOCD-DZ nuclear shieldings: A.Ligabue, S.P.A.Sauer, P.Lazzeretti.
\newblock {\em J.Chem.Phys.}, {\bf 118},\hspace{0.25em}6830, (2003).\end{list}
}}
\end{center}

A prerequisite for any SOPPA calculation is that the calculation of
the MP2 energy and wavefunction is invoked by the keyword \Key{MP2} in
the \Sec{*WAVE FUNCTIONS} input module. Furthermore in the
\Sec{*PROPERTIES} or \Sec{*RESPONSE} input modules it has to be specified 
by the keyword \Key{SOPPA} that a SOPPA calculation of the properties
should be carried out.

A typical input file for a SOPPA calculation of the indirect nuclear
spin-spin coupling constants of a molecule will be:

\begin{verbatim}
**DALTON INPUT
.RUN PROPERTIES
**WAVE FUNCTIONS
.HF
.MP2
**PROPERTIES
.SOPPA
.SPIN-S
**END OF DALTON INPUT
\end{verbatim}
whereas as typical input file for the calculation of triplet
excitation energies\index{electronic excitation} with the
\Sec{*RESPONSE} module will be: 
\begin{verbatim}
**DALTON INPUT
.RUN RESPONSE
**WAVE FUNCTIONS
.HF
.MP2
**RESPONSE
.TRPFLG
.NOITRA
.SOPPA
*LINEAR
.SINGLE RESIDUE
.ROOTS
 4
**END OF DALTON INPUT
\end{verbatim}
The {\tt .NOITRA} keyword has the effect that the transformation of the two 
electron integrals necessary for a MP2 and SOPPA calculation is only performed
once in the \Sec{*WAVE FUNCTIONS} module.

A prerequisite for any SOPPA(CCSD) calculation is that the calculation of
the CCSD amplitudes for the SOPPA program is invoked by the keyword \Key{CC}
in the \Sec{*WAVE FUNCTIONS} input module together with the \Key{SOPPA(CCSD)}
option in the \Sec{CC INPUT} section. Furthermore, in the \Sec{*PROPERTIES} or
\Sec{*RESPONSE} input modules it has to specified by the keyword \Key{SOPPA(CCSD)}
that a SOPPA(CCSD) calculation of the properties should be carried out. 

A typical input file for a SOPPA(CCSD) calculation of the indirect nuclear
spin-spin coupling constants of a molecule will be:

\begin{verbatim}
**DALTON INPUT
.RUN PROPERTIES
**WAVE FUNCTIONS
.HF
.CC
*CC INPUT
.SOPPA(CCSD)
**PROPERTIES
.SOPPA(CCSD)
.SPIN-S
**END OF DALTON INPUT
\end{verbatim}
whereas as typical input file for the calculation of triplet
excitation energies\index{electronic excitation} with the
\Sec{*RESPONSE} module will be: 
\begin{verbatim}
**DALTON INPUT
.RUN RESPONSE
**WAVE FUNCTIONS
.HF
.CC
*CC INPUT
.SOPPA(CCSD)
**RESPONSE
.TRPFLG
.SOPPA(CCSD)
*LINEAR
.SINGLE RESIDUE
.ROOTS
 4
**END OF DALTON INPUT
\end{verbatim}

